(function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}};t=function(){function t(){this.setProgress=e(this.setProgress,this),this.setCurrentTime=e(this.setCurrentTime,this),this.getEndTime=e(this.getEndTime,this),this.pause=e(this.pause,this),this.stop=e(this.stop,this),this.resume=e(this.resume,this),this.start=e(this.start,this);var t=this;this.design=new PianoKeyboardDesign,this.keyboard=new PianoKeyboard(this.design),this.rain=new NoteRain(this.design),this.player=MIDI.Player,this.player.addListener(function(e){var i,r,n,s;return i=128,r=144,s=e.note,n=e.message,notemsg=n,n===r?t.keyboard.press(s):n===i?t.keyboard.release(s):void 0}),this.player.setAnimation({delay:20,callback:function(e){var i,r;return r=e.now,i=e.end,"function"==typeof t.onprogress&&t.onprogress({current:r,total:i}),t.rain.update(1e3*r)}})}return t.prototype.initScene=function(){var t=this;return this.scene=new Scene("#canvas"),this.scene.add(this.keyboard.model),this.scene.add(this.rain.model),this.scene.animate(function(){t.keyboard.update()})},t.prototype.initMidi=function(t){return MIDI.loadPlugin(function(){return MIDI.channels[9].mute=!0,"function"==typeof t?t():void 0})},t.prototype.loadBuiltinPlaylist=function(t){var e=this;return $.getJSON("tttrakz/index2.json",function(i){return e.playlist=i,t(e.playlist)})},t.prototype.loadBuiltinMidi=function(t,e){var i=this;if(t>=0&&t<this.playlist.length)return $.ajax({url:"tttrakz/"+this.playlist[t],dataType:"text",success:function(r){var n;i.loadMidiFile(r,e);try{return"undefined"!=typeof localStorage&&null!==localStorage?localStorage[t]=r:void 0}catch(s){return n=s,"undefined"!=typeof console&&null!==console?console.error("localStorage quota limit reached"):void 0}}})},t.prototype.loadMidiFile=function(t,e){var i=this;return this.player.loadFile(t,function(){return i.rain.setMidiData(i.player.data,e)})},t.prototype.start=function(){return sourceb?(this.player.start(),buffAudio.play(),started?started=!1:started=!0,this.playing=!0):void 0},t.prototype.resume=function(){return pbackT=this.player.currentTime/1e3+1e-6,this.player.currentTime+=1e-6,this.player.resume(),buffAudio.play(),this.playing=!0},t.prototype.stop=function(){return this.player.stop(),pbackT=0,started&&(buffAudio.stop(),started=!1),this.playing=!1},t.prototype.pause=function(){return this.player.pause(),buffAudio.pause(),this.playing=!1},t.prototype.getEndTime=function(){return this.player.endTime},t.prototype.setCurrentTime=function(t){return this.player.pause(),this.player.currentTime=t,pbackT=t/1e3,buffAudio.seek(pbackT),this.playing?this.player.resume():void 0},t.prototype.setProgress=function(t){var e;return e=this.player.endTime*t,this.setCurrentTime(e)},t.prototype.on=function(t,e){return this["on"+t]=e},t}(),this.Euphony=t}).call(this);