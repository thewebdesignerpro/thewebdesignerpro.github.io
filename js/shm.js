/**
 * author Armstrong "Army" Chiu
 * URL: https://thewebdesignerpro.com/     
 */
 
import*as e from"three";import a from"three/addons/capabilities/WebGL.js";import{OBJLoader as t}from"three/addons/loaders/OBJLoader.js";import{FBXLoader as o}from"three/addons/loaders/FBXLoader.js";import{Reflector as r}from"three/addons/objects/Reflector.js";let idleTO=120,florY=-100,ceilY=140,camera,scene,renderer,clock,grups=[],isMobil=!1,mouseX=0,mouseY=-50,mixer,ui={},_={},x={},cubeCamera,cubeRenderTarget;if(!1===a.isWebGLAvailable()){let n=a.getWebGLErrorMessage();document.body.appendChild(n)}else window.addEventListener?window.addEventListener("load",init,!1):window.attachEvent?window.attachEvent("onload",init):window.onload=init;function eL(e,a,t,o){0==a?e.addEventListener(t,o,!1):e.removeEventListener(t,o,!1)}function cL(e,a,t){0==a?e.classList.contains(t)||e.classList.add(t):e.classList.contains(t)&&e.classList.remove(t)}function init(){function a(e){return document.getElementById(e)}ui.kontainer=a("kontainer"),ui.swtchKam=a("swtchKam"),ui.onAud=a("onAud"),ui.offAud=a("offAud"),ui.swtchKam.style.visibility="hidden",ui.loadr=a("loadr"),ui.fader=a("fader"),ui.fader.style.opacity=1;let t=document.createElement("div");if(t.setAttribute("id","dummy"),document.body.appendChild(t),(isMobil="9000px"!=window.getComputedStyle(t,null).getPropertyValue("left"))&&(document.addEventListener("gesturechange",function(e){e.preventDefault()},!1),ui.kontainer.addEventListener("gesturechange",function(e){e.preventDefault()},!1)),t.parentNode.removeChild(t),_.width=window.innerWidth,_.height=window.innerHeight,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",ui.kontainer.style.backgroundColor="#808486",_.cr=[],_.ej=[],_.ej[0]=0,_.ej[1]=-2,_.ej[2]=Math.PI,_.ej[3]=3e3,_.ej[4]=0,_.ej[5]=100,(renderer=new e.WebGLRenderer({antialias:!0,alpha:!1})).setPixelRatio(window.devicePixelRatio),renderer.setSize(_.width,_.height),renderer.setClearColor(8422534,1),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=e.PCFSoftShadowMap,renderer.outputColorSpace=e.LinearSRGBColorSpace,renderer.sortObjects=!1,ui.kontainer.appendChild(renderer.domElement),!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float"))throw alert("OES_texture_float not supported"),"missing webgl extension";if(!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float_linear"))throw alert("OES_texture_float_linear not supported"),"missing webgl extension";(scene=new e.Scene).fog=new e.FogExp2(8422534,6e-4),x.camGrup=new e.Group,(camera=new e.PerspectiveCamera(50,_.width/_.height,.1,1e4)).position.set(0,_.ej[5],-100),x.camGrup.add(camera),scene.add(new e.AmbientLight(3158064)),x.spotLcone=[],x.spotLight=[],x.spotLight[0]=new e.SpotLight(16777215,2e7,7e3,Math.PI/3.4,1),x.spotLight[0].position.set(0,3e3,1e3),x.spotLight[0].castShadow=!0,x.spotLight[0].shadow.camera.near=10,x.spotLight[0].shadow.camera.far=7e3,x.spotLight[0].shadow.camera.fov=40,x.camGrup.add(x.spotLight[0]),x.camGrup.position.set(0,0,_.ej[3]),scene.add(x.camGrup),eL(window,1,"load",init),eL(window,0,"resize",onWindowResize),(clock=new e.Clock).autoStart=!1,grups[0]=new e.Group,grups[1]=new e.Group,_.mouse=new e.Vector2,_.entro=!0,_.idleTimer=0,_.fokus=!0,_.pointer=new e.Vector2,_.ptrDown=!1,x.currGrup=0,x.targetO=new e.Object3D,x.targetO.position.set(0,60,x.camGrup.position.z-300),scene.add(x.targetO),addLamps(),addReflect(),addFloor(),addSidewalk(),addBldgs(),addTrees(),addTrash(),addClouds(),addFog(),onWindowResize()}function addReflect(){_.reflect=[];let a=new e.PlaneGeometry(1e3,3003);for(let t=0;t<1;t++)_.reflect[t]=new r(a,{clipBias:.003,textureWidth:_.width*window.devicePixelRatio,textureHeight:_.height*window.devicePixelRatio,color:9474192}),_.reflect[t].position.y=-104,_.reflect[t].position.z=-1500,_.reflect[t].rotateX(-Math.PI/2),x.camGrup.add(_.reflect[t]);let o=new e.PlaneGeometry(1e3,1e3),n=new e.MeshBasicMaterial({color:8422534,transparent:!0,fog:!1});n.depthWrite=!1,_.bw=new e.Mesh(o,n),_.bw.visible=!1,_.bw.position.set(0,-101,-2500),_.bw.rotateX(-Math.PI/2),x.camGrup.add(_.bw);let i=new e.PlaneGeometry(1e3,3003),s=new e.MeshBasicMaterial({color:8422534,fog:!1});_.bw2=new e.Mesh(i,s),_.bw2.position.set(0,-101,-4500),_.bw2.rotateX(-Math.PI/2),x.camGrup.add(_.bw2),new e.TextureLoader().load("img/bw1.jpg",function(e){_.bw.material.alphaMap=e,_.bw.material.needsUpdate=!0,_.bw.visible=!0})}function addFloor(){x.floor=[];let a=new e.PlaneGeometry(1e3,3003,1,1),t=new e.MeshStandardMaterial({color:13421772,roughness:.95,metalness:.1});t.transparent=!0,t.depthWrite=!1;for(let o=0;o<2;o++)x.floor[o]=new e.Mesh(a,t),x.floor[o].position.set(0,-100,0),x.floor[o].rotation.x=-(Math.PI/2),x.floor[o].receiveShadow=!0,grups[o].add(x.floor[o]);var r=new e.TextureLoader,n=new e.TextureLoader,i=new e.TextureLoader,s=new e.TextureLoader;r.load("img/asphalt/color2.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(2,6);for(let t=0;t<2;t++)x.floor[t].material.map=a,x.floor[t].material.needsUpdate=!0}),n.load("img/asphalt/rough1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(1,3);for(let t=0;t<2;t++)x.floor[t].material.bumpScale=1,x.floor[t].material.bumpMap=a,x.floor[t].material.needsUpdate=!0}),i.load("img/asphalt/rough1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(1,3);for(let t=0;t<2;t++)x.floor[t].material.metalnessMap=a,x.floor[t].material.roughnessMap=a,x.floor[t].material.needsUpdate=!0}),s.load("img/asphalt/alpha2.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(1,3);for(let t=0;t<2;t++)x.floor[t].material.alphaMap=a,x.floor[t].material.needsUpdate=!0}),grups[0].position.z=1500,grups[1].position.z=-1500,scene.add(grups[0]),scene.add(grups[1])}function addSidewalk(){x.sidewalk=[];let a=new t;a.load("obj/sh/sidewalk/model.obj",function(a){a.traverse(function(e){e.isMesh&&e.geometry.computeBoundingBox()});let t=new e.MeshStandardMaterial({color:13421772,roughness:1,metalness:0});for(let o=0;o<2;o++){x.sidewalk[o]=new e.Mesh(a.children[0].geometry,t),x.sidewalk[o].castShadow=!1,x.sidewalk[o].receiveShadow=!0;let r=-645;1==o&&(r=645),x.sidewalk[o].position.set(r,-104.5,0),x.sidewalk[o].rotation.set(0,Math.PI/2,0),x.sidewalk[o].scale.set(3.754,2.2,1.5),grups[0].add(x.sidewalk[o])}for(let n=2;n<4;n++){x.sidewalk[n]=new e.Mesh(a.children[0].geometry,t),x.sidewalk[n].castShadow=!1,x.sidewalk[n].receiveShadow=!0;let i=-645;3==n&&(i=645),x.sidewalk[n].position.set(i,-104.5,0),x.sidewalk[n].rotation.set(0,-(Math.PI/2),0),x.sidewalk[n].scale.set(3.754,2.2,1.5),grups[1].add(x.sidewalk[n])}let s=[],d=new e.PlaneGeometry(3003,600),l=new e.MeshStandardMaterial({color:12303291,roughness:1,metalness:0});for(let $=0;$<2;$++){s[$]=new e.Mesh(d,l);let p=-1090;1==$&&(p=1090),s[$].position.set(p,-92,0),s[$].rotation.set(-(Math.PI/2),0,-(Math.PI/2)),s[$].castShadow=!1,s[$].receiveShadow=!0,grups[0].add(s[$])}for(let c=2;c<4;c++){s[c]=new e.Mesh(d,l);let m=-1090;3==c&&(m=1090),s[c].position.set(m,-92,0),s[c].rotation.set(-(Math.PI/2),0,-(Math.PI/2)),s[c].castShadow=!1,s[c].receiveShadow=!0,grups[1].add(s[c])}let u=new e.TextureLoader,h=new e.TextureLoader,g=new e.TextureLoader,f=new e.TextureLoader;u.load("obj/sh/sidewalk/mat/color1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(3,1);for(let t=0;t<4;t++)x.sidewalk[t].material.map=a,x.sidewalk[t].material.needsUpdate=!0}),h.load("obj/sh/sidewalk/mat/rough1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(3,1);for(let t=0;t<4;t++)x.sidewalk[t].material.roughnessMap=s[t].material.roughnessMap=a,x.sidewalk[t].material.needsUpdate=s[t].material.needsUpdate=!0}),g.load("obj/sh/sidewalk/mat/normal1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(3,1);for(let t=0;t<4;t++)x.sidewalk[t].material.normalScale.set(12,12),x.sidewalk[t].material.normalMap=a,x.sidewalk[t].material.needsUpdate=!0}),f.load("obj/sh/sidewalk/mat/cement.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(3,1);for(let t=0;t<4;t++)s[t].material.map=s[t].material.bumpMap=a,s[t].material.bumpScale=6,s[t].material.needsUpdate=!0})})}function addBldgs(){x.bldg=[];let a=[],o=new t;o.load("obj/sh/facade/model.obj",function(t){t.traverse(function(e){e.isMesh&&(e.geometry.computeBoundingBox(),e.castShadow=!0,e.receiveShadow=!0)});let o=[.7,.84,.7,.84],r=[1,-.982,1,-1.15],n=[1520,-2350,-1600,1740],i=[-395,2350,-310,-1745],s=[0,Math.PI,0,Math.PI],d=[Math.PI,0,Math.PI,0],l=[800,800,800,800],$=[1350,2300,1450,2080],p=[1700,-1727,1774,-1874],c=[590,1060,640,952],m=[1480,1470,-430,40],u=[-1700,1727,-1774,1874],h=[590,1060,640,952],g=[1480,-83,-430,1440],f=new e.MeshStandardMaterial({color:7829367});for(let w=0;w<4;w++){let b=new e.MeshStandardMaterial({color:16777215,roughness:.9,metalness:.4});x.bldg[w]=new e.Mesh(t.children[w].geometry,b),x.bldg[w].castShadow=!0,x.bldg[w].receiveShadow=!0,x.bldg[w].position.set(1300*r[w],-88,n[w]),x.bldg[w].rotation.set(0,s[w],0),x.bldg[w].scale.set(o[w],o[w],o[w]),grups[0].add(x.bldg[w]);let L=new e.PlaneGeometry(l[w],$[w]);a[w]=new e.Mesh(L,f),a[w].position.set(p[w],c[w],m[w]),grups[0].add(a[w])}for(let j=0;j<4;j++){let M=new e.MeshStandardMaterial({color:16777215,roughness:.9,metalness:.4});x.bldg[j+4]=new e.Mesh(t.children[j].geometry,M),x.bldg[j+4].castShadow=!0,x.bldg[j+4].receiveShadow=!0,x.bldg[j+4].position.set(-(1300*r[j]*1),-88,i[j]),x.bldg[j+4].rotation.set(0,d[j],0),x.bldg[j+4].scale.set(o[j],o[j],o[j]),grups[1].add(x.bldg[j+4]);let S=new e.PlaneGeometry(l[j],$[j]);a[j+4]=new e.Mesh(S,f),a[j+4].position.set(u[j],h[j],g[j]),grups[1].add(a[j+4])}let y=new e.TextureLoader,T=new e.TextureLoader,k=new e.TextureLoader,v=new e.TextureLoader,U=new e.TextureLoader,P=new e.TextureLoader,I=new e.TextureLoader,W=new e.TextureLoader,G=new e.TextureLoader,R=new e.TextureLoader,B=new e.TextureLoader,z=new e.TextureLoader;y.load("obj/sh/facade/mat/color2b.jpg",function(e){x.bldg[0].material.map=x.bldg[4].material.map=e,x.bldg[0].material.needsUpdate=x.bldg[4].material.needsUpdate=!0}),T.load("obj/sh/facade/mat/color1b.jpg",function(e){x.bldg[1].material.map=x.bldg[5].material.map=e,x.bldg[1].material.needsUpdate=x.bldg[5].material.needsUpdate=!0}),k.load("obj/sh/facade/mat/color3b.jpg",function(e){x.bldg[2].material.map=x.bldg[6].material.map=e,x.bldg[2].material.needsUpdate=x.bldg[6].material.needsUpdate=!0}),v.load("obj/sh/facade/mat/color4b.jpg",function(e){x.bldg[3].material.map=x.bldg[7].material.map=e,x.bldg[3].material.needsUpdate=x.bldg[7].material.needsUpdate=!0}),U.load("obj/sh/facade/mat/metal2.jpg",function(e){x.bldg[0].material.metalnessMap=x.bldg[4].material.metalnessMap=e,x.bldg[0].material.needsUpdate=x.bldg[4].material.needsUpdate=!0}),P.load("obj/sh/facade/mat/metal1.jpg",function(e){x.bldg[1].material.metalnessMap=x.bldg[5].material.metalnessMap=e,x.bldg[1].material.needsUpdate=x.bldg[5].material.needsUpdate=!0}),I.load("obj/sh/facade/mat/metal3.jpg",function(e){x.bldg[2].material.metalnessMap=x.bldg[6].material.metalnessMap=e,x.bldg[2].material.needsUpdate=x.bldg[6].material.needsUpdate=!0}),W.load("obj/sh/facade/mat/metal4.jpg",function(e){x.bldg[3].material.metalnessMap=x.bldg[7].material.metalnessMap=e,x.bldg[3].material.needsUpdate=x.bldg[7].material.needsUpdate=!0}),G.load("obj/sh/facade/mat/rough2.jpg",function(e){x.bldg[0].material.roughnessMap=x.bldg[4].material.roughnessMap=e,x.bldg[0].material.needsUpdate=x.bldg[4].material.needsUpdate=!0}),R.load("obj/sh/facade/mat/rough1.jpg",function(e){x.bldg[1].material.roughnessMap=x.bldg[5].material.roughnessMap=e,x.bldg[1].material.needsUpdate=x.bldg[5].material.needsUpdate=!0}),B.load("obj/sh/facade/mat/rough3.jpg",function(e){x.bldg[2].material.roughnessMap=x.bldg[6].material.roughnessMap=e,x.bldg[2].material.needsUpdate=x.bldg[6].material.needsUpdate=!0}),z.load("obj/sh/facade/mat/rough4.jpg",function(e){x.bldg[3].material.roughnessMap=x.bldg[7].material.roughnessMap=e,x.bldg[3].material.needsUpdate=x.bldg[7].material.needsUpdate=!0})})}function addClouds(){let a=new e.SphereGeometry(4900,24,12,0,Math.PI),t=new e.MeshBasicMaterial({color:16777215,side:e.BackSide,fog:!1});t.transparent=!0;let o=new e.Mesh(a,t);o.rotation.set(-(Math.PI/2),0,-(Math.PI/2)),scene.add(o);let r=new e.TextureLoader,n=new e.TextureLoader;r.load("img/clouds1.jpg",function(e){o.material.map=e,o.material.needsUpdate=!0}),n.load("img/opac1.jpg",function(e){o.material.alphaMap=e,o.material.needsUpdate=!0})}function addLamps(){x.lamps=[],x.bulbs=[];let a=new t;a.load("obj/lamp/model.obj",function(a){a.traverse(function(e){e.isMesh&&e.geometry.computeBoundingBox()});let t=new e.MeshStandardMaterial({color:16777215,roughness:.4,metalness:.3}),o=new e.MeshStandardMaterial({color:16777215,roughness:0,metalness:.5,emissive:16774621});for(let r=0;r<2;r++){x.lamps[r]=new e.Mesh(a.children[0].geometry,t),x.lamps[r].castShadow=!0,x.lamps[r].receiveShadow=!0;let n=-570;1==r&&(n=570,x.lamps[r].rotation.set(0,Math.PI,0)),x.lamps[r].position.set(n,634,-150),x.lamps[r].scale.set(2.5,2.5,2.5),grups[0].add(x.lamps[r])}for(let i=2;i<4;i++){x.lamps[i]=new e.Mesh(a.children[0].geometry,t),x.lamps[i].castShadow=!0,x.lamps[i].receiveShadow=!0;let s=-570;3==i&&(s=570,x.lamps[i].rotation.set(0,Math.PI,0)),x.lamps[i].position.set(s,634,-150),x.lamps[i].scale.set(2.5,2.5,2.5),grups[1].add(x.lamps[i])}for(let d=0;d<2;d++){x.bulbs[d]=new e.Mesh(a.children[1].geometry,o);let l=-570;1==d&&(l=570,x.bulbs[d].rotation.set(0,Math.PI,0)),x.bulbs[d].position.set(l,634,-150),x.bulbs[d].scale.set(2.5,2.5,2.5),grups[0].add(x.bulbs[d])}for(let $=2;$<4;$++){x.bulbs[$]=new e.Mesh(a.children[1].geometry,o);let p=-570;3==$&&(p=570,x.bulbs[$].rotation.set(0,Math.PI,0)),x.bulbs[$].position.set(p,634,-150),x.bulbs[$].scale.set(2.5,2.5,2.5),grups[1].add(x.bulbs[$])}let c=new e.TextureLoader,m=new e.TextureLoader;c.load("obj/lamp/mat/color1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping;for(let t=0;t<4;t++)x.lamps[t].material.map=a,x.lamps[t].material.needsUpdate=!0}),m.load("obj/lamp/mat/normal1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping;for(let t=0;t<4;t++)x.lamps[t].material.normalScale.set(2,2),x.lamps[t].material.normalMap=a,x.lamps[t].material.needsUpdate=!0})});let o=[];for(let r=1;r<3;r++){x.spotLight[r]=new e.SpotLight(16774621,1e7,1200,Math.PI/8,1);let n=-375;2==r&&(n=375),x.spotLight[r].position.set(n,890,-150),x.spotLight[r].castShadow=!0,x.spotLight[r].shadow.camera.near=10,x.spotLight[r].shadow.camera.far=500,x.spotLight[r].shadow.camera.fov=30,grups[0].add(x.spotLight[r]),o[r]=new e.Object3D,o[r].position.set(n,-100,-150),grups[0].add(o[r]),x.spotLight[r].target=o[r]}for(let i=3;i<5;i++){x.spotLight[i]=new e.SpotLight(16774621,1e7,1200,Math.PI/8,1);let s=-375;4==i&&(s=375),x.spotLight[i].position.set(s,890,-150),x.spotLight[i].castShadow=!0,x.spotLight[i].shadow.camera.near=10,x.spotLight[i].shadow.camera.far=500,x.spotLight[i].shadow.camera.fov=30,grups[1].add(x.spotLight[i]),o[i]=new e.Object3D,o[i].position.set(s,-100,-150),grups[1].add(o[i]),x.spotLight[i].target=o[i]}let d=new e.PlaneGeometry(160,200),l=new e.MeshBasicMaterial({color:16777215,transparent:!0,opacity:.6,side:e.DoubleSide});l.depthWrite=!1;for(let $=1;$<3;$++){x.spotLcone[$]=new e.Mesh(d,l);let p=-375;2==$&&(p=375),x.spotLcone[$].position.set(p,215,-150),x.spotLcone[$].scale.set(7,7,1),x.spotLcone[$].visible=!1,grups[0].add(x.spotLcone[$])}for(let c=3;c<5;c++){x.spotLcone[c]=new e.Mesh(d,l);let m=-375;4==c&&(m=375),x.spotLcone[c].position.set(m,215,-150),x.spotLcone[c].scale.set(7,7,1),x.spotLcone[c].visible=!1,grups[1].add(x.spotLcone[c])}new e.TextureLoader().load("img/spotLconeA.png",function(e){for(let a=1;a<5;a++)x.spotLcone[a].material.map=x.spotLcone[a].material.alphaMap=e,x.spotLcone[a].material.needsUpdate=!0,x.spotLcone[a].visible=!0}),addCar1()}function addTrees(){x.trees=[];let a=new t;a.load("obj/trees/2/tree1.obj",function(a){a.traverse(function(e){e.isMesh&&(e.geometry.computeVertexNormals(),e.geometry.computeBoundingBox())});let t=new e.MeshStandardMaterial({color:16777215,roughness:.4,metalness:0,transparent:!0});t.depthWrite=!1,t.side=e.DoubleSide;for(let o=0;o<2;o++){x.trees[o]=new e.Mesh(a.children[0].geometry,t),x.trees[o].castShadow=!0,x.trees[o].receiveShadow=!0;let r=-650;1==o&&(r=650),x.trees[o].position.set(r,-65,1350),x.trees[o].rotation.set(-(Math.PI/2),0,Math.random()*Math.PI),x.trees[o].scale.set(.56,.56,.56),grups[0].add(x.trees[o])}for(let n=2;n<4;n++){x.trees[n]=new e.Mesh(a.children[0].geometry,t),x.trees[n].castShadow=!0,x.trees[n].receiveShadow=!0;let i=-650;3==n&&(i=650),x.trees[n].position.set(i,-65,1350),x.trees[n].rotation.set(-(Math.PI/2),0,-(Math.random()*Math.PI)),x.trees[n].scale.set(.56,.56,.56),grups[1].add(x.trees[n])}let s=new e.TextureLoader,d=new e.TextureLoader;s.load("obj/trees/2/mat/color1.png",function(a){a.wrapS=a.wrapT=e.RepeatWrapping;for(let t=0;t<4;t++)x.trees[t].material.map=a,x.trees[t].material.needsUpdate=!0}),d.load("obj/trees/2/mat/alpha1.png",function(a){a.wrapS=a.wrapT=e.RepeatWrapping;for(let t=0;t<4;t++)x.trees[t].material.alphaMap=a,x.trees[t].material.needsUpdate=!0})});let o=[],r=new e.BoxGeometry(140,20,140),n=new e.MeshStandardMaterial({color:12303291,roughness:.5});for(let i=0;i<2;i++){o[i]=new e.Mesh(r,n),o[i].castShadow=!0,o[i].receiveShadow=!0;let s=-650;1==i&&(s=650),o[i].position.set(s,-80,1350),grups[0].add(o[i])}for(let d=2;d<4;d++){o[d]=new e.Mesh(r,n),o[d].castShadow=!0,o[d].receiveShadow=!0;let l=-650;3==d&&(l=650),o[d].position.set(l,-80,1350),grups[1].add(o[d])}new e.TextureLoader().load("obj/trees/2/mat/cement2.jpg",function(e){for(let a=0;a<4;a++)o[a].material.map=o[a].material.bumpMap=e,o[a].material.bumpScale=6,o[a].material.needsUpdate=!0})}function addTrash(){x.trash=[];let a=new t;a.load("obj/trash/model.obj",function(a){a.traverse(function(e){e.isMesh&&(e.geometry.computeVertexNormals(),e.geometry.computeBoundingBox())});let t=new e.MeshStandardMaterial({color:16777215,roughness:.8,metalness:.1});for(let o=0;o<2;o++){x.trash[o]=new e.Mesh(a.children[0].geometry,t),x.trash[o].castShadow=!0,x.trash[o].receiveShadow=!0;let r=-1080,n=170,i=Math.PI;1==o&&(r=1080,n=-1230,i=0),x.trash[o].position.set(r,7,n),x.trash[o].rotation.set(0,i,0),x.trash[o].scale.set(98,98,98),grups[o].add(x.trash[o])}let s=new e.TextureLoader,d=new e.TextureLoader,l=new e.TextureLoader;s.load("obj/trash/mat/color1.jpg",function(e){for(let a=0;a<2;a++)x.trash[a].material.map=e,x.trash[a].material.needsUpdate=!0}),d.load("obj/trash/mat/normal1.jpg",function(e){for(let a=0;a<2;a++)x.trash[a].material.normalMap=e,x.trash[a].material.needsUpdate=!0}),l.load("obj/trash/mat/rough1.jpg",function(e){for(let a=0;a<2;a++)x.trash[a].material.roughnessMap=e,x.trash[a].material.needsUpdate=!0})})}function addCar1(){x.car=[];let a=new t;a.load("obj/car/1/model.obj",function(a){a.traverse(function(e){e.isMesh&&e.geometry.computeBoundingBox()});let t=new e.MeshStandardMaterial({color:16777215,roughness:.9,metalness:.7});x.car[0]=new e.Mesh(a.children[0].geometry,t),x.car[0].castShadow=!0,x.car[0].receiveShadow=!0,x.car[0].position.set(300,-101.5,-300),x.car[0].rotation.set(0,Math.PI,0),x.car[0].scale.set(3.1,3.1,3.1),grups[0].add(x.car[0]);let o=new e.TextureLoader,r=new e.TextureLoader,n=new e.TextureLoader,i=new e.TextureLoader;o.load("obj/car/1/mat/color1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.car[0].material.map=a,x.car[0].material.needsUpdate=!0}),r.load("obj/car/1/mat/normal1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.car[0].material.normalScale.set(-.5,-.5),x.car[0].material.normalMap=a,x.car[0].material.needsUpdate=!0}),n.load("obj/car/1/mat/rough1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.car[0].material.roughnessMap=a,x.car[0].material.needsUpdate=!0}),i.load("obj/car/1/mat/metal1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.car[0].material.metalnessMap=a,x.car[0].material.needsUpdate=!0}),addCar2()})}function addCar2(){let a=new t;a.load("obj/car/2/model.obj",function(a){a.traverse(function(e){e.isMesh&&e.geometry.computeBoundingBox()});let t=new e.MeshStandardMaterial({color:16777215,roughness:.9,metalness:.7});x.car[1]=new e.Mesh(a.children[0].geometry,t),x.car[1].castShadow=!0,x.car[1].receiveShadow=!0,x.car[1].position.set(-300,-5,-300),x.car[1].rotation.set(0,-(Math.PI/2),0),x.car[1].scale.set(4.3,4.3,4.3),grups[1].add(x.car[1]);let o=new e.TextureLoader,r=new e.TextureLoader,n=new e.TextureLoader,i=new e.TextureLoader;o.load("obj/car/2/mat/color1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.car[1].material.map=a,x.car[1].material.needsUpdate=!0}),r.load("obj/car/2/mat/normal1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.car[1].material.normalScale.set(1,1),x.car[1].material.normalMap=a,x.car[1].material.needsUpdate=!0}),n.load("obj/car/2/mat/rough1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.car[1].material.roughnessMap=a,x.car[1].material.needsUpdate=!0}),i.load("obj/car/2/mat/metal1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.car[1].material.metalnessMap=a,x.car[1].material.needsUpdate=!0}),animFBX()})}let randomizeMatrix=function(){let a=new e.Vector3,t=new e.Euler,o=new e.Quaternion,r=new e.Vector3;return function(e){a.x=1900*Math.random()-950,a.y=500*Math.random()+15,a.z=3e3*Math.random()-1500,t.x=Math.random()*(Math.PI/2.5),a.y<100&&(t.x*=-1),t.y=Math.random()*(Math.PI/2.5),a.x>0&&(t.y*=-1),t.z=2*Math.random()*Math.PI,o.setFromEuler(t),r.x=.3*Math.random()+1,r.y=.3*Math.random()+1,e.compose(a,o,r)}}();function addFog(){x.fog=[];let a=[],t=new e.PlaneGeometry(200,200),o=new e.MeshBasicMaterial({color:9475222,transparent:!0});o.depthWrite=!1;for(let r=0;r<2;r++){a[r]=new e.Matrix4,x.fog[r]=new e.InstancedMesh(t,o,300);for(let n=0;n<300;n++)randomizeMatrix(a[r]),x.fog[r].setMatrixAt(n,a[r]);x.fog[r].visible=!1,grups[r].add(x.fog[r])}new e.TextureLoader().load("img/ulap5.png",function(e){for(let a=0;a<2;a++)x.fog[a].material.map=e,x.fog[a].material.alphaMap=e,x.fog[a].material.needsUpdate=!0,x.fog[a].visible=!0})}function fadeScene(){onWindowResize(),function e(){let a=parseFloat(ui.fader.style.opacity);(a-=.05)<0?(ui.fader.style.opacity=0,ui.fader.style.display="none",ui.fader.parentNode.removeChild(ui.fader),onWindowResize(),eL(ui.kontainer,0,"pointerdown",onPointerDown),eL(ui.kontainer,0,"pointermove",onPointerMove),animate(),theOptions(),cL(ui.loadr,0,"paus"),ui.loadr.style.display="none",ui.loadr.parentNode.removeChild(ui.loadr)):(ui.fader.style.opacity=a,requestAnimationFrame(e))}()}function theOptions(){ui.swtchKam.style.visibility="visible",isMobil?(eL(ui.swtchKam,0,"touchstart",swtchKamClick),eL(ui.onAud,0,"touchstart",audClick),eL(ui.offAud,0,"touchstart",audClick)):(eL(ui.swtchKam,0,"click",swtchKamClick),eL(ui.onAud,0,"click",audClick),eL(ui.offAud,0,"click",audClick))}function swtchKamClick(e){e&&e.preventDefault(),0==_.ej[2]?(_.ej[0]=0,_.ej[1]=-2,_.ej[2]=Math.PI,_.ej[3]=3e3):(_.ej[0]=3e3,_.ej[1]=2,_.ej[2]=0,_.ej[3]=0),x.char1.rotation.y=_.ej[2],_.idleTimer=0}function audClick(e){e&&e.preventDefault(),x.sound?x.sound.isPlaying?(cL(ui.offAud,0,"noneIt2"),cL(ui.onAud,1,"noneIt2"),x.sound.pause()):(cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2"),x.sound.play()):addAud(),_.idleTimer=0}function onPointerDown(e){e&&e.preventDefault();let a={};e.clientX?(a.x=e.clientX/_.width*2-1,a.y=-(2*(e.clientY/_.height))+1):(a.x=e.x/_.width*2-1,a.y=-(2*(e.y/_.height))+1),_.ptrDown=!0,_.pointer.x=a.x,_.pointer.y=a.y,_.idleTimer=0}function onPointerMove(e){e&&e.preventDefault();let a={};e.clientX?(a.x=e.clientX/_.width*2-1,a.y=-(2*(e.clientY/_.height))+1):(a.x=e.x/_.width*2-1,a.y=-(2*(e.y/_.height))+1),_.pointer.x=a.x,_.pointer.y=a.y,_.idleTimer=0}function wheelE(e){e&&e.preventDefault(),_.idleTimer=0}function onWindowResize(){_.width=window.innerWidth,_.height=window.innerHeight,_.widthH=_.width/2,_.heightH=_.height/2,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",camera.aspect=_.width/_.height,camera.updateProjectionMatrix(),renderer.setSize(_.width,_.height),isMobil?(_.cr[1]=-.0006,_.cr[0]=4e-4):(_.cr[1]=-.00024,_.cr[0]=48e-5),_.width>_.height?cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.022+"px":cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.028+"px",_.idleTimer=0}function animWalk(){let e=x.camGrup.position.z,a=x.targetO.position.z,t=0;t=_.ej[1]>0?1:0,e==_.ej[0]?(x.currGrup==t?(x.car[0].position.x*=-1,x.car[0].position.z=2e3*Math.random()-1e3,x.car[0].rotation.y=0==x.car[0].rotation.y?Math.PI:0):(x.car[1].position.x*=-1,x.car[1].position.z=2e3*Math.random()-1e3,x.car[1].rotation.y*=-1),x.camGrup.position.z=_.ej[3],x.targetO.position.z=_.ej[3]-300,grups[0].position.z*=-1,grups[1].position.z*=-1,x.currGrup=0==x.currGrup?1:0):(x.camGrup.position.z=e+_.ej[1],x.targetO.position.z=a+_.ej[1])}function animFBX(){let a="teenb1/char1";a+=".fbx";let t=new o;t.load("obj/"+a,function(a){a.traverse(function(e){e.isMesh&&(e.geometry.computeBoundingBox(),e.castShadow=!0,e.receiveShadow=!0,("Hatsmesh"==e.geometry.name||"Shoesmesh"==e.geometry.name)&&(e.frustumCulled=!1))}),x.char1=a;let t=[],o="obj/teenb1/mat/";for(let r=0;r<7;r++)t[r]=new e.MeshStandardMaterial({color:16777215,roughness:.73,metalness:0}),x.char1.children[r].material=t[r];t[1].transparent=!0,t[1].opacity=0;let n=new e.TextureLoader,i=new e.TextureLoader,s=new e.TextureLoader,d=new e.TextureLoader,l=new e.TextureLoader;new e.TextureLoader;let $=new e.TextureLoader,p=new e.TextureLoader,c=new e.TextureLoader,m=new e.TextureLoader,u=new e.TextureLoader;new e.TextureLoader,n.load(o+"bottomd.jpg",function(e){t[2].map=e,t[2].needsUpdate=!0}),i.load(o+"bodyd.jpg",function(e){t[0].map=t[3].map=e,t[0].needsUpdate=t[3].needsUpdate=!0}),s.load(o+"hatd.jpg",function(e){t[4].map=e,t[4].needsUpdate=!0}),d.load(o+"shoesd.jpg",function(e){t[5].map=e,t[5].needsUpdate=!0}),l.load(o+"topd.jpg",function(e){t[6].map=e,t[6].needsUpdate=!0}),$.load(o+"bottomn.jpg",function(a){t[2].normalScale=new e.Vector2(-1,-1),t[2].normalMap=a,t[2].needsUpdate=!0}),p.load(o+"bodyn.jpg",function(a){t[3].normalScale=new e.Vector2(-1,-1),t[3].normalMap=a,t[3].needsUpdate=!0}),c.load(o+"hatn.jpg",function(a){t[4].normalScale=new e.Vector2(-1,-1),t[4].normalMap=a,t[4].needsUpdate=!0}),m.load(o+"shoesn.jpg",function(a){t[5].roughness=.5,t[5].normalScale=new e.Vector2(-1,-1),t[5].normalMap=a,t[5].needsUpdate=!0}),u.load(o+"topn.jpg",function(a){t[6].normalScale=new e.Vector2(-.8,-.8),t[6].normalMap=a,t[6].needsUpdate=!0}),x.char1.scale.set(1.48,1.48,1.48),x.char1.position.set(0,-100,-300),x.char1.rotation.set(0,_.ej[2],0),x.camGrup.add(x.char1),x.spotLight[0].target=x.char1,anim8()})}function anim8(){x.actions=[];let a="teenb1/walkswag";a+=".fbx";let t=new o;t.load("obj/"+a,function(a){mixer=new e.AnimationMixer(x.char1),x.actions[0]=mixer.clipAction(a.animations[0]),x.actions[0].play(),fadeScene()})}function animate(){if(requestAnimationFrame(animate),_.idleTimer<120){clock.running||clock.start();let e=.003*Date.now(),a=.6*clock.getDelta();mixer&&mixer.update(a),animWalk(),camera.position.x=2*Math.cos(e),camera.position.y=2*Math.sin(2*e)+_.ej[5],isMobil?(camera.position.x+=100*Math.cos(.1*e),camera.position.y+=100*Math.sin(.05*e)):(camera.position.x+=200*_.pointer.x,camera.position.y+=200*_.pointer.y),_.idleTimer+=.01,render()}else clock.running&&clock.stop(),x.sound&&x.sound.isPlaying&&x.sound.pause();document.hasFocus()?_.fokus||(_.idleTimer=0,_.fokus=!0,x.sound&&!x.sound.isPlaying&&x.sound.play()):(_.idleTimer=120,_.fokus=!1,x.sound&&x.sound.isPlaying&&x.sound.pause())}function render(){camera.lookAt(x.targetO.position);for(let e=1;e<5;e++)x.spotLcone[e].lookAt(camera.position),x.spotLcone[e].rotation.x=x.spotLcone[e].rotation.z=0;renderer.render(scene,camera)}function addAud(){if(!x.sound){let a="sh";a+=".mp3";let t=new e.AudioListener;camera.add(t),x.sound=new e.Audio(t);let o=new e.AudioLoader;o.load("aud/"+a,function(e){x.sound.setBuffer(e),x.sound.setLoop(!0),x.sound.setVolume(.9),x.sound.play(),cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2")})}} 

	
