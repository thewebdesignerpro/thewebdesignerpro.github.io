/**
 * author Armstrong "Army" Chiu
 * URL: https://thewebdesignerpro.com/     
 */
 
 
import*as e from"three";import t from"three/addons/capabilities/WebGL.js";import{OBJLoader as n}from"three/addons/loaders/OBJLoader.js";import{OrbitControls as a}from"three/addons/controls/OrbitControls.js";let idleTO=120,florY=-1,ceilY=140,camera,scene,renderer,clock,grups=[],isMobil=!1,mouseX=0,mouseY=-50,mixer,ui={},_={},x={},controls;if(t.isWebGL2Available())window.addEventListener?window.addEventListener("load",init,!1):window.attachEvent?window.attachEvent("onload",init):window.onload=init;else{let o=t.getWebGL2ErrorMessage();kontainer.appendChild(o),kontainer.style.background="url('img/carvizl.jpg') center top no-repeat",kontainer.style.backgroundSize="cover",fader.style.opacity=0,fader.style.display="none",fader.parentNode.removeChild(fader),cL(loadr,0,"paus"),loadr.style.display="none",loadr.parentNode.removeChild(loadr)}function eL(e,t,n,a){0==t?e.addEventListener(n,a,!1):e.removeEventListener(n,a,!1)}function cL(e,t,n){0==t?e.classList.contains(n)||e.classList.add(n):e.classList.contains(n)&&e.classList.remove(n)}function init(){function t(e){return document.getElementById(e)}ui.kontainer=t("kontainer"),ui.colPick=t("colPick"),ui.onAud=t("onAud"),ui.offAud=t("offAud"),ui.colPick.style.visibility="hidden",ui.fcp=t("fcp"),ui.loadr=t("loadr"),ui.fader=t("fader"),ui.fader.style.opacity=1;let n=document.createElement("div");if(n.setAttribute("id","dummy"),document.body.appendChild(n),(isMobil="9000px"!=window.getComputedStyle(n,null).getPropertyValue("left"))&&(document.addEventListener("gesturechange",function(e){e.preventDefault()},!1),ui.kontainer.addEventListener("gesturechange",function(e){e.preventDefault()},!1),_.prevW=_.prevH=0),n.parentNode.removeChild(n),_.width=window.innerWidth,_.height=window.innerHeight,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",ui.kontainer.style.backgroundColor="#eaeff2",_.ej=[],_.ej[0]=0,_.ej[1]=-1,_.ej[2]=Math.PI,_.ej[3]=0,_.ej[4]=0,_.ej[5]=10,x.zz=450,(renderer=new e.WebGLRenderer({antialias:!0,alpha:!1})).setPixelRatio(window.devicePixelRatio),renderer.setSize(_.width,_.height),renderer.setClearColor(15396850,1),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=e.PCFSoftShadowMap,renderer.toneMapping=e.ACESFilmicToneMapping,renderer.outputColorSpace=e.LinearSRGBColorSpace,renderer.sortObjects=!1,ui.kontainer.appendChild(renderer.domElement),!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float"))throw alert("OES_texture_float not supported"),"missing webgl extension";if(!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float_linear"))throw alert("OES_texture_float_linear not supported"),"missing webgl extension";scene=new e.Scene,x.camGrup=new e.Group,grups[0]=new e.Group,grups[1]=new e.Group,(camera=new e.PerspectiveCamera(50,_.width/_.height,.5,1e4)).position.set(0,_.ej[5],37),x.camGrup.add(camera),scene.add(new e.AmbientLight(15658734)),x.spotLight=[],x.spotLight[0]=new e.SpotLight(16777215,5e6,1500,Math.PI/8,1),x.spotLight[0].position.set(700,700,400),x.spotLight[0].castShadow=!0,x.spotLight[0].shadow.mapSize.width=2048,x.spotLight[0].shadow.mapSize.height=2048,x.spotLight[0].shadow.camera.near=1,x.spotLight[0].shadow.camera.far=1500,x.spotLight[0].shadow.camera.fov=50,x.spotLight[0].shadow.bias=-.00000015,x.spotLight[0].shadow.intensity=.7,scene.add(x.spotLight[0]),x.camGrup.position.set(0,0,_.ej[3]),scene.add(x.camGrup),eL(window,1,"load",init),eL(window,0,"resize",onWindowResize),(controls=new a(camera,renderer.domElement)).enableDamping=!0,controls.dampingFactor=.1,controls.autoRotateSpeed=1.5,controls.autoRotate=!0,controls.minDistance=30,controls.maxDistance=80,controls.minPolarAngle=Math.PI/3,controls.maxPolarAngle=Math.PI/1.97,controls.rotateSpeed=.2,controls.zoomSpeed=1,controls.enablePan=!1,controls.panSpeed=8,(clock=new e.Clock).autoStart=!1,_.mouse=new e.Vector2,_.entro=!0,_.idleTimer=0,_.fokus=!0,_.pointer=new e.Vector2,_.ptrDown=!1,x.currGrup=0,x.target0=new e.Object3D,x.target0.position.set(0,_.ej[5]-5,0),scene.add(x.target0),x.spotLight[0].target=x.target0,controls.target=x.target0.position,x.rotCam=!1,addSkybox(),addSkybox2(),onWindowResize()}function addSkybox(){let t=".png",n=new e.CubeTextureLoader;n.setPath("img/skybox/2/"),n.load(["posx"+t,"negx"+t,"posy"+t,"negy"+t,"posz"+t,"negz"+t],function(e){x.skybox=e,addCar(),addStage()})}function addSkybox2(){let t=".png",n=new e.CubeTextureLoader;n.setPath("img/skybox/3/"),n.load(["posx"+t,"negx"+t,"posy"+t,"negy"+t,"posz"+t,"negz"+t],function(e){scene.backgroundRotation.set(0,Math.PI/2,0),scene.background=e})}function addStage(){let t=0,a=new n;a.load("obj/stage/0/stage.obj",function(n){n.traverse(function(e){e.isMesh&&(e.geometry.computeBoundingBox(),t+=1)}),x.stage=n,x.stage.rotation.set(-(Math.PI/2),0,0);let a=[],o="obj/stage/0/mat/",i=[16777215];for(let r=0;r<t;r++)a[r]=new e.MeshBasicMaterial({color:i[0]}),a[r].wireframe=!0,x.stage.children[r].material=a[r];grups[0].add(x.stage),scene.add(grups[0]);let d=new e.TextureLoader,s=new e.TextureLoader,l=new e.TextureLoader;d.load(o+"color2b.jpg",function(e){a[0].map=e,a[0].needsUpdate=!0,a[0].wireframe=!1,fadeScene()}),s.load(o+"color1b.jpg",function(e){a[1].map=e,a[1].needsUpdate=!0,a[1].wireframe=!1}),l.load(o+"color0b.jpg",function(e){a[2].map=e,a[2].needsUpdate=!0,a[2].wireframe=!1});let c=new e.PlaneGeometry(35,50),p=new e.ShadowMaterial;p.opacity=.7;let $=new e.Mesh(c,p);$.position.set(-6,.05,-2.5),$.rotation.set(-(Math.PI/2),0,0),$.receiveShadow=!0,scene.add($)})}function addCar(){let t=0,a=new n;a.load("obj/car/7/car.obj",function(n){n.traverse(function(e){e.isMesh&&(0!=t&&5!=t&&(e.castShadow=!0),e.receiveShadow=!0,t+=1)}),x.car=n,x.car.position.set(0,.1,0),x.car.scale.set(.1,.1,.1);let a=[],o="obj/car/7/mat/",i=[16777215,8947848,15658734,12303291,12303291,15658734,10066329,12303291,7368816],r=[0,.6,.8,.8,0,0,.8,0,1],d=[.9,.1,.4,.4,.4,.9,.8,.4,0];for(let s=0;s<t;s++)a[s]=new e.MeshStandardMaterial({color:i[s],roughness:r[s],metalness:d[s]}),a[s].wireframe=!0,0==s&&(a[s].transparent=!0,a[s].opacity=.6,a[s].envMap=x.skybox,a[s].wireframe=!1),1==s&&(a[s].wireframe=!1),3==s&&(a[s].envMap=x.skybox),(4==s||7==s)&&(a[s].envMap=x.skybox,a[s].wireframe=!1),5==s&&(a[s].transparent=!0,a[s].opacity=.7,a[s].envMap=x.skybox,a[s].wireframe=!1),x.car.children[s].material=a[s];grups[0].add(x.car);let l=new e.TextureLoader,c=new e.TextureLoader,p=new e.TextureLoader,$=new e.TextureLoader,u=new e.TextureLoader,f=new e.TextureLoader,h=new e.TextureLoader,m=new e.TextureLoader,g=new e.TextureLoader;new e.TextureLoader,l.load(o+"kz1oemcolor2.jpg",function(e){a[2].map=e,a[2].needsUpdate=!0,a[2].wireframe=!1}),c.load(o+"kz1oemmetal.jpg",function(e){a[2].metalnessMap=a[6].metalnessMap=e,a[2].needsUpdate=a[6].needsUpdate=!0}),p.load(o+"kz1oemnormal.jpg",function(e){a[2].normalScale.set(.5,.5),a[6].normalScale.set(.5,.5),a[2].normalMap=a[6].normalMap=e,a[2].needsUpdate=a[6].needsUpdate=!0}),$.load(o+"kz1oemrough.jpg",function(e){a[2].roughnessMap=a[6].roughnessMap=e,a[2].needsUpdate=a[6].needsUpdate=!0}),u.load(o+"wheelcolor2.jpg",function(e){a[3].map=a[8].map=e,a[3].needsUpdate=a[8].needsUpdate=!0,a[3].wireframe=a[8].wireframe=!1}),f.load(o+"wheelmetal.jpg",function(e){a[3].metalnessMap=e,a[3].needsUpdate=!0}),h.load(o+"wheelnormal.jpg",function(e){a[3].normalScale.set(.5,.5),a[3].normalMap=e,a[3].needsUpdate=!0}),m.load(o+"wheelrough.jpg",function(e){a[3].roughnessMap=e,a[3].needsUpdate=!0}),g.load(o+"kz1oemcolorb.jpg",function(e){a[6].alphaTest=.5,a[6].map=a[6].alphaMap=e,a[6].needsUpdate=!0,a[6].wireframe=!1});let w=[],y=[],L=new e.PlaneGeometry(.77,.77,8,8);y[0]=new e.MeshStandardMaterial({color:16777215,transparent:!0,opacity:.8}),y[0].wireframe=!0,w[0]=new e.Mesh(L,y[0]),w[0].position.set(-5.2,3.37,20.28),grups[0].add(w[0]);let b=new e.PlaneGeometry(.87,.87,6,6);y[2]=new e.MeshStandardMaterial({color:16777215,transparent:!0,opacity:.9}),y[2].wireframe=!0,y[2].side=1,w[2]=new e.Mesh(b,y[2]),w[2].position.set(-6.84,8.15,-19.2),grups[0].add(w[2]);let k=new e.PlaneGeometry(.89,.89,6,6);y[3]=new e.MeshStandardMaterial({color:16777215,transparent:!0,opacity:.9}),y[3].wireframe=!0,y[3].side=1,w[3]=new e.Mesh(k,y[3]),w[3].position.set(-5.28,8.31,-19.68),grups[0].add(w[3]);let M=new e.PlaneGeometry(2.2,.6,6,2);y[4]=new e.MeshStandardMaterial({color:16777215,transparent:!0,opacity:.95}),y[4].wireframe=!0,y[4].side=1,w[4]=new e.Mesh(M,y[4]),w[4].position.set(-6.97,2.757,-18.95),w[4].rotation.set(0,.55,.02),grups[0].add(w[4]);let S=new e.PlaneGeometry(.86,.83);y[5]=new e.MeshBasicMaterial({color:0,transparent:!0}),y[5].wireframe=!0,y[5].side=1,w[5]=new e.Mesh(S,y[5]),w[5].position.set(-5,3.44,-20.25),grups[0].add(w[5]);let v=new e.PlaneGeometry(1.5,1);y[6]=new e.MeshStandardMaterial({color:15658734,roughness:0,metalness:.7,alphaTest:.5}),y[6].wireframe=!0,w[6]=new e.Mesh(v,y[6]),w[6].position.set(10.161,9.179,3.964),w[6].rotation.set(0,-(Math.PI/180*142.8),0),grups[0].add(w[6]),y[7]=new e.MeshStandardMaterial({color:15658734,roughness:0,metalness:.7,alphaTest:.5}),y[7].wireframe=!0,y[7].side=1,w[7]=new e.Mesh(v,y[7]),w[7].position.set(-10.161,9.179,3.964),w[7].rotation.set(0,-.649,0),grups[0].add(w[7]);let P=new e.TextureLoader,j=new e.TextureLoader,T=new e.TextureLoader,z=new e.TextureLoader,C=new e.TextureLoader,A=new e.TextureLoader,U=new e.TextureLoader;P.load(o+"light1.jpg",function(e){y[0].map=y[0].alphaMap=e,y[0].needsUpdate=!0,y[0].wireframe=!1}),j.load(o+"light3.jpg",function(e){y[2].map=y[2].alphaMap=y[3].alphaMap=e,y[2].needsUpdate=y[3].needsUpdate=!0,y[2].wireframe=!1}),T.load(o+"light4.jpg",function(e){y[3].map=e,y[3].needsUpdate=!0,y[3].wireframe=!1}),z.load(o+"light5.jpg",function(e){y[4].map=e,y[4].needsUpdate=!0,y[4].wireframe=!1}),C.load(o+"light5a.jpg",function(e){y[4].alphaMap=e,y[4].needsUpdate=!0}),A.load(o+"sidemirror.jpg",function(e){y[6].alphaMap=y[7].alphaMap=e,y[6].envMap=y[7].envMap=x.skybox,y[6].needsUpdate=y[7].needsUpdate=!0,y[6].wireframe=y[7].wireframe=!1}),U.load("img/opac2t.jpg",function(e){y[0].displacementScale=.1,y[2].displacementScale=y[3].displacementScale=-.08,y[4].displacementScale=-.1;for(let t=0;t<5;t++)1!=t&&(y[t].displacementMap=e,y[t].needsUpdate=!0);y[5].alphaMap=e,y[5].wireframe=!1,y[5].needsUpdate=!0})})}function fadeScene(){onWindowResize(),function t(){let n=parseFloat(ui.fader.style.opacity);(n-=.05)<0?(ui.fader.style.opacity=0,ui.fader.style.display="none",ui.fader.parentNode.removeChild(ui.fader),onWindowResize(),eL(ui.kontainer,0,"pointerdown",onPointerDown),eL(ui.kontainer,0,"pointermove",onPointerMove),eL(ui.kontainer,0,"click",kontainerClick),eL(ui.kontainer,0,"wheel",wheelE),x.camV3=new e.Vector3,animate(),theOptions(),cL(ui.loadr,0,"paus"),ui.loadr.style.display="none",ui.loadr.parentNode.removeChild(ui.loadr),x.fogIdx=0,x.fogInc=1,ColorPicker(document.getElementById("fcpSlide"),document.getElementById("fcpPick"),function(e,t,n){let a=n.r/255,o=n.g/255,i=n.b/255;x.car.children[3].material.color.setRGB(a,o,i),x.car.children[4].material.color.setRGB(a,o,i),x.car.children[7].material.color.setRGB(a,o,i)})):(ui.fader.style.opacity=n,requestAnimationFrame(t))}()}function theOptions(){ui.colPick.style.visibility="visible",isMobil?(eL(ui.colPick,0,"touchstart",colPickClick),eL(ui.onAud,0,"touchstart",audClick),eL(ui.offAud,0,"touchstart",audClick)):(eL(ui.colPick,0,"click",colPickClick),eL(ui.onAud,0,"click",audClick),eL(ui.offAud,0,"click",audClick))}function colPickClick(e){e&&e.preventDefault(),cL(ui.fcp,0,"scale1"),_.idleTimer=0}function audClick(e){e&&e.preventDefault(),x.sound?x.sound.isPlaying?(cL(ui.offAud,0,"noneIt2"),cL(ui.onAud,1,"noneIt2"),x.sound.pause()):(cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2"),x.sound.play()):addAud(),_.idleTimer=0}function onPointerDown(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-(2*(e.clientY/_.height))+1):(t.x=e.x/_.width*2-1,t.y=-(2*(e.y/_.height))+1),_.ptrDown=!0,_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function onPointerMove(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-(2*(e.clientY/_.height))+1):(t.x=e.x/_.width*2-1,t.y=-(2*(e.y/_.height))+1),_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function kontainerClick(e){e&&e.preventDefault(),cL(ui.fcp,1,"scale1"),_.idleTimer=0}function wheelE(e){e&&e.preventDefault(),_.idleTimer=0}function onWindowResize(){_.width=window.innerWidth,_.height=window.innerHeight,isMobil&&(_.width==_.prevW&&(_.width=_.prevH,_.height=_.prevW),_.prevW=_.width,_.prevH=_.height,x.rotCam=!0),_.widthH=_.width/2,_.heightH=_.height/2,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",camera.aspect=_.width/_.height,camera.updateProjectionMatrix(),renderer.setSize(_.width,_.height),x.zz=450,_.width>_.height?(cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.022+"px",camera.position.z=37,x.zz=450):(cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.028+"px",camera.position.z=51,x.zz=600),_.idleTimer=0}function animate(){requestAnimationFrame(animate),_.idleTimer<120?(clock.running||clock.start(),Date.now(),_.idleTimer+=.01,render()):(clock.running&&clock.stop(),x.sound&&x.sound.isPlaying&&x.sound.pause()),document.hasFocus()?_.fokus||(_.idleTimer=0,_.fokus=!0,x.sound&&!x.sound.isPlaying&&x.sound.play()):(_.idleTimer=120,_.fokus=!1,x.sound&&x.sound.isPlaying&&x.sound.pause())}function render(){camera.lookAt(x.target0.position),controls.update(),renderer.render(scene,camera)}function addAud(){if(!x.sound){let t="crvz";t+=".mp3";let n=new e.AudioListener;camera.add(n),x.sound=new e.Audio(n);let a=new e.AudioLoader;a.load("aud/"+t,function(e){x.sound.setBuffer(e),x.sound.setLoop(!0),x.sound.setVolume(.9),x.sound.play(),cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2")})}}

	