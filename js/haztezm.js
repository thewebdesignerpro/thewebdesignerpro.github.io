/**
 * author Armstrong "Army" Chiu
 * URL: https://thewebdesignerpro.com/     
 */
 
import*as e from"three";import i from"three/addons/capabilities/WebGL.js";import{FBXLoader as t}from"three/addons/loaders/FBXLoader.js";import n from"three/addons/libs/tween.module.js";let idleTO=120,florY=-100,ceilY=140,camera,scene,renderer,clock,grups=[],isMobil=!1,mouseX=0,mouseY=-50,mixer,ui={},win={},x={};if(!1===i.isWebGLAvailable()){let o=i.getWebGLErrorMessage();document.body.appendChild(o)}else window.addEventListener?window.addEventListener("load",init,!1):window.attachEvent?window.attachEvent("onload",init):window.onload=init;function init(){ui.kontainer=document.getElementById("kontainer");let i=document.createElement("div");if(i.setAttribute("id","dummy"),document.body.appendChild(i),(isMobil="9000px"!=window.getComputedStyle(i,null).getPropertyValue("left"))&&(document.addEventListener("gesturechange",function(e){e.preventDefault()},!1),ui.kontainer.addEventListener("gesturechange",function(e){e.preventDefault()},!1)),i.parentNode.removeChild(i),win.width=window.innerWidth,win.height=window.innerHeight,document.body.style.width=win.width+"px",document.body.style.height=win.height+"px",ui.kontainer.style.width=win.width+"px",ui.kontainer.style.height=win.height+"px",ui.kontainer.style.opacity=0,ui.kontainer.style.backgroundColor="#0x000000",win.cr=[],win.ej=[],win.ej[0]=950,win.ej[1]=1150,win.ej[2]=150,win.ej[3]=-1,win.ej[4]=Math.PI,(renderer=new e.WebGLRenderer({antialias:!0,alpha:!1})).setPixelRatio(window.devicePixelRatio),renderer.setSize(win.width,win.height),renderer.setClearColor(0,1),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=e.PCFSoftShadowMap,renderer.sortObjects=!1,ui.kontainer.appendChild(renderer.domElement),!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float"))throw alert("OES_texture_float not supported"),"missing webgl extension";if(!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float_linear"))throw alert("OES_texture_float_linear not supported"),"missing webgl extension";(scene=new e.Scene).fog=new e.FogExp2(0,.001),(camera=new e.PerspectiveCamera(45,win.width/win.height,1,1e4)).position.set(0,-35,win.ej[1]),scene.add(camera),scene.add(new e.AmbientLight(3158064)),x.spotLight=[],x.spotLight[0]=new e.SpotLight(16777215,1e5,470,Math.PI/2.5,1),x.spotLight[0].position.set(0,196,0),x.spotLight[1]=new e.SpotLight(16777215,1e5,470,Math.PI/2.5,1),x.spotLight[1].position.set(0,196,0),x.spotLight[2]=new e.SpotLight(16777215,1e5,470,Math.PI/2.5,1),x.spotLight[2].position.set(0,196,0),x.spotLight[0].castShadow=x.spotLight[1].castShadow=x.spotLight[2].castShadow=!0,x.spotLight[0].shadow.camera.near=x.spotLight[1].shadow.camera.near=x.spotLight[2].shadow.camera.near=10,x.spotLight[0].shadow.camera.far=x.spotLight[1].shadow.camera.far=x.spotLight[2].shadow.camera.far=500,x.spotLight[0].shadow.camera.fov=x.spotLight[1].shadow.camera.fov=x.spotLight[2].shadow.camera.fov=30,onWindowResize(),window.removeEventListener("load",init,!1),window.addEventListener("resize",onWindowResize,!1),(clock=new e.Clock).autoStart=!1,grups[0]=new e.Group,grups[1]=new e.Group,grups[2]=new e.Group,grups[0].add(x.spotLight[0]),grups[1].add(x.spotLight[1]),grups[2].add(x.spotLight[2]),addFloor(),addCeiling(),addWalls(),animFBX(),win.mouse=new e.Vector2,win.entro=!0,win.idleTimer=0,win.fokus=!0,win.pointer=new e.Vector2}function entro(){ui.tempDiv=document.createElement("div"),ui.tempDiv.setAttribute("id","noAud"),ui.tempDiv.innerHTML="ENTER",ui.tempDiv.style.display="block",ui.tempDiv.style.position="absolute",ui.tempDiv.style.margin="auto",ui.tempDiv.style.top="40%",ui.tempDiv.style.bottom=ui.tempDiv.style.left=ui.tempDiv.style.right="0",ui.tempDiv.style.width="160px",ui.tempDiv.style.height="48px",ui.tempDiv.style.lineHeight="48px",ui.tempDiv.style.fontFamily="sans-serif",ui.tempDiv.style.fontSize="24px",ui.tempDiv.style.textAlign="center",ui.tempDiv.style.color="rgba(255, 255, 255, 0.5)",ui.tempDiv.style.backgroundColor="rgba(255, 255, 255, 0.15)",ui.tempDiv.style.border="2px solid rgba(255, 255, 255, 0.5)",ui.tempDiv.style.cursor="pointer",ui.kontainer.appendChild(ui.tempDiv)}function theOptions(){ui.swtchKam=document.getElementById("swtchKam"),ui.onAud=document.getElementById("onAud"),ui.offAud=document.getElementById("offAud"),isMobil?(ui.swtchKam.addEventListener("touchstart",swtchKamClick,!1),ui.onAud.addEventListener("touchstart",audClick,!1),ui.offAud.addEventListener("touchstart",audClick,!1)):(ui.swtchKam.addEventListener("click",swtchKamClick,!1),ui.onAud.addEventListener("click",audClick,!1),ui.offAud.addEventListener("click",audClick,!1))}function swtchKamClick(e){e.preventDefault(),950==win.ej[0]?(win.ej[0]=150,win.ej[1]=350,win.ej[2]=950,win.ej[3]=1,win.ej[4]=0):(win.ej[0]=950,win.ej[1]=1150,win.ej[2]=150,win.ej[3]=-1,win.ej[4]=Math.PI),x.char1.rotation.y=win.ej[4],win.idleTimer=0}function audClick(e){e.preventDefault(),x.sound?x.sound.isPlaying?(ui.offAud.classList.add("noneIt2"),ui.onAud.classList.remove("noneIt2"),x.sound.pause()):(ui.onAud.classList.add("noneIt2"),ui.offAud.classList.remove("noneIt2"),x.sound.play()):addAud(),win.idleTimer=0}function addFloor(){x.floor=[];let i=new e.PlaneGeometry(800,801),t=new e.MeshStandardMaterial({color:16637389,roughness:.5,metalness:0});for(let n=0;n<3;n++){let o=-800+800*n;x.floor[n]=new e.Mesh(i,t),x.floor[n].position.set(0,-100,0),x.floor[n].rotation.x=-.5*Math.PI,x.floor[n].receiveShadow=!0,grups[n].add(x.floor[n]),grups[n].position.z=o,x.spotLight[n].target=x.floor[n]}var a=new e.TextureLoader,r=new e.TextureLoader;a.load("img/bakrum/carpetc.jpg",function(i){i.wrapS=i.wrapT=e.RepeatWrapping,i.repeat.set(20,20);for(let t=0;t<3;t++)x.floor[t].material.map=i,x.floor[t].material.needsUpdate=!0}),r.load("img/bakrum/carpetd.jpg",function(i){i.wrapS=i.wrapT=e.RepeatWrapping,i.repeat.set(20,20);for(let t=0;t<3;t++)x.floor[t].material.bumpScale=25,x.floor[t].material.bumpMap=i,x.floor[t].material.needsUpdate=!0})}function addCeiling(){x.ceiling=[];let i=new e.PlaneGeometry(800,801),t=new e.MeshStandardMaterial({color:7829367,roughness:.3,metalness:.15,side:e.BackSide});for(let n=0;n<3;n++){let o=-800+800*n;x.ceiling[n]=new e.Mesh(i,t),x.ceiling[n].position.set(0,140,0),x.ceiling[n].rotation.x=-.5*Math.PI,x.ceiling[n].receiveShadow=!0,grups[n].add(x.ceiling[n]),grups[n].position.z=o}var a=new e.TextureLoader,r=new e.TextureLoader,s=new e.TextureLoader;a.load("img/bakrum/ceilingc2.jpg",function(e){for(let i=0;i<3;i++)x.ceiling[i].material.map=e,x.ceiling[i].material.needsUpdate=!0}),r.load("img/bakrum/ceilinge2.jpg",function(e){for(let i=0;i<3;i++)x.ceiling[i].material.lightMapIntensity=14,x.ceiling[i].material.lightMap=e,x.ceiling[i].material.needsUpdate=!0}),s.load("img/bakrum/ceilingd.jpg",function(e){for(let i=0;i<3;i++)x.ceiling[i].material.bumpScale=-17,x.ceiling[i].material.bumpMap=e,x.ceiling[i].material.needsUpdate=!0})}function addWalls(){x.walls=[];let i=20,t=new e.PlaneGeometry(700,240),n=new e.PlaneGeometry(280,240),o=new e.MeshStandardMaterial({color:15657392,roughness:.2,metalness:0});for(let a=0;a<12;a+=4)x.walls[a]=new e.Mesh(t,o),x.walls[a+1]=new e.Mesh(t,o),x.walls[a+2]=new e.Mesh(n,o),x.walls[a+3]=new e.Mesh(n,o),x.walls[a].position.set(-120,i,0),x.walls[a+1].position.set(120,i,0),x.walls[a+2].position.set(-260,i,350),x.walls[a+3].position.set(260,i,350),x.walls[a].rotation.y=.5*Math.PI,x.walls[a+1].rotation.y=-.5*Math.PI,x.walls[a].receiveShadow=x.walls[a+1].receiveShadow=x.walls[a+2].receiveShadow=x.walls[a+3].receiveShadow=!0,grups[a/4].add(x.walls[a]),grups[a/4].add(x.walls[a+1]),grups[a/4].add(x.walls[a+2]),grups[a/4].add(x.walls[a+3]);var r=new e.TextureLoader,s=(new e.TextureLoader,new e.TextureLoader);r.load("img/bakrum/wallpaperc2.jpg",function(i){i.wrapS=i.wrapT=e.RepeatWrapping,i.repeat.set(5.1,1.7);for(let t=0;t<12;t++)x.walls[t].material.map=i,x.walls[t].material.needsUpdate=!0}),s.load("img/bakrum/wallpaperr.jpg",function(i){i.wrapS=i.wrapT=e.RepeatWrapping,i.repeat.set(5.1,1.7);for(let t=0;t<12;t++)x.walls[t].material.bumpScale=1,x.walls[t].material.bumpMap=i,x.walls[t].material.needsUpdate=!0}),scene.add(grups[0]),scene.add(grups[1]),scene.add(grups[2])}function fadeScene(){onWindowResize(),function e(){let i=parseFloat(ui.kontainer.style.opacity);(i+=.1)>1?(ui.kontainer.style.opacity=1,onWindowResize(),isMobil?(ui.kontainer.addEventListener("touchstart",onDocumentTouchStart,!1),ui.kontainer.addEventListener("touchmove",onDocumentTouchMove,!1)):(ui.kontainer.addEventListener("mousemove",onMouseMove,!1),ui.kontainer.addEventListener("click",kontainerClick,!1)),ui.kontainer.addEventListener("pointermove",onMouseMove,!1),ui.kontainer.addEventListener("wheel",wheelE,!1),animate(),animWalk2(),theOptions()):(ui.kontainer.style.opacity=i,requestAnimationFrame(e))}()}function animWalk2(){!function e(){let i=x.char1.position.z,t=camera.position.z;i==win.ej[2]?(x.char1.position.z=win.ej[0],camera.position.z=win.ej[1]):(x.char1.position.z=i+win.ej[3],camera.position.z=t+win.ej[3]),requestAnimationFrame(e)}()}function onMouseMove(e){e&&e.preventDefault(),mouseX=e.clientX-win.widthH,mouseY=e.clientY-win.heightH,isMobil?(win.pointer.x=e.touches[0].pageX/win.width*2-1,win.pointer.y=-(2*(e.touches[0].pageY/win.height))+1):(win.pointer.x=e.clientX/win.width*2-1,win.pointer.y=-(2*(e.clientY/win.height))+1),mouseY-=50,win.idleTimer=0}function onMouseWheel(e){e.preventDefault(),win.idleTimer=0}function wheelE(e){e.preventDefault(),win.idleTimer=0}function onDocumentTouchStart(e){1===e.touches.length&&(mouseX=e.touches[0].pageX-win.widthH,mouseY=e.touches[0].pageY-win.heightH,win.pointer.x=e.touches[0].pageX/win.width*2-1,win.pointer.y=-(2*(e.touches[0].pageY/win.height))+1,win.idleTimer=0)}function onDocumentTouchMove(e){1===e.touches.length&&(mouseX=e.touches[0].pageX-win.widthH,mouseY=e.touches[0].pageY-win.heightH)}function onDocumentTouchEnd(e){1===e.touches.length&&(win.pointer.x=e.touches[0].pageX/win.width*2-1,win.pointer.y=-(2*(e.touches[0].pageY/win.height))+1,ui.kontainer.removeEventListener("touchmove",onDocumentTouchMove,!1),ui.kontainer.removeEventListener("touchend",onDocumentTouchEnd,!1),win.idleTimer=0)}function kontainerClick(e){e.preventDefault(),win.idleTimer=0}function onWindowResize(){if(win.width=window.innerWidth,win.height=window.innerHeight,isMobil){let e=document.documentElement.getBoundingClientRect(),i=document.documentElement.clientWidth,t=document.documentElement.clientHeight;if(e)win.width=e.width,win.height=e.height;else if(i)win.width=i,win.height=t;else{let n=win.width;win.width=win.height,win.height=n}}win.widthH=win.width/2,win.heightH=win.height/2,document.body.style.width=ui.kontainer.style.width=win.width+"px",document.body.style.height=ui.kontainer.style.height=win.height+"px",camera.aspect=win.width/win.height,camera.updateProjectionMatrix(),renderer.setSize(win.width,win.height),isMobil?(win.cr[1]=-.0006,win.cr[0]=4e-4):(win.cr[1]=-.0004,win.cr[0]=6e-4),win.width>win.height?cntnt.style.fontSize=cntnt2.style.fontSize=(win.width+win.height)/2*.022+"px":cntnt.style.fontSize=cntnt2.style.fontSize=(win.width+win.height)/2*.028+"px",win.idleTimer=0}function animate(){if(requestAnimationFrame(animate),win.idleTimer<120){clock.running||clock.start();let e=.7*clock.getDelta();mixer&&mixer.update(e),win.idleTimer+=.01,render()}else clock.running&&clock.stop(),x.sound&&x.sound.isPlaying&&x.sound.pause();document.hasFocus()?win.fokus||(win.idleTimer=0,win.fokus=!0,x.sound&&!x.sound.isPlaying&&x.sound.play()):(win.idleTimer=120,win.fokus=!1,x.sound&&x.sound.isPlaying&&x.sound.pause()),n.update()}function render(){camera.rotation.y=(mouseX-camera.position.x)*win.cr[1],camera.rotation.x=(-mouseY-camera.position.y)*win.cr[0],renderer.render(scene,camera)}function animFBX(){let i="haztez/haztez";i+=".fbx";let n=0,o=new t;o.load("obj/"+i,function(i){i.traverse(function(e){e.isMesh&&(e.geometry.computeBoundingBox(),e.castShadow=!0,e.receiveShadow=!0,n+=1)}),x.char1=i;let t=[],o=[12303291,16777215,12303291,12303291,10066329,10592673,10592673,16775402,11184827,3355443,13417335,13417335,3355443,3355443,13417335,13417335,3355443,14540253,11184827];for(let a=0;a<n;a++)t[a]=new e.MeshStandardMaterial({color:o[a],roughness:.3,metalness:.1}),x.char1.children[a].material=t[a];new e.TextureLoader().load("obj/haztez/mat/hazc.jpg",function(e){for(let i=0;i<n;i++)t[i].map=e,t[i].needsUpdate=!0}),t[17].transparent=!0,t[17].opacity=.55,t[17].roughness=0,x.char1.scale.set(.44,.44,.44),x.char1.position.set(0,-100,win.ej[0]),x.char1.rotation.set(0,win.ej[4],0),scene.add(x.char1),anim8()})}function anim8(){x.actions=[];let i="haztez/walking";i+=".fbx";let n=new t;n.load("obj/"+i,function(i){mixer=new e.AnimationMixer(x.char1),x.actions[0]=mixer.clipAction(i.animations[0]),x.actions[0].play(),fadeScene()})}function addAud(){if(!x.sound){let i="tbckrms2";i+=".mp3";let t=new e.AudioListener;camera.add(t),x.sound=new e.Audio(t);let n=new e.AudioLoader;n.load("aud/"+i,function(e){x.sound.setBuffer(e),x.sound.setLoop(!0),x.sound.setVolume(.8),x.sound.play(),ui.onAud.classList.add("noneIt2"),ui.offAud.classList.remove("noneIt2")})}} 

