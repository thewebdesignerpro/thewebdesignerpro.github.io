/**
 * author Armstrong "Army" Chiu
 * URL: https://thewebdesignerpro.com/     
 */
 
 
import*as THREE from"three";import WebGL from"three/addons/capabilities/WebGL.js";import{OBJLoader}from"three/addons/loaders/OBJLoader.js";import{FBXLoader}from"three/addons/loaders/FBXLoader.js";import{Water}from"three/addons/objects/Water.js";const idleTO=120,florY=0,ceilY=140;let camera,scene,renderer,clock;const grups=[];let mixer,isMobil=!1,mouseX=0,mouseY=-50;const ui={},_={},x={};if(WebGL.isWebGL2Available())window.addEventListener?window.addEventListener("load",init,!1):window.attachEvent?window.attachEvent("onload",init):window.onload=init;else{const e=WebGL.getWebGL2ErrorMessage();kontainer.appendChild(e),kontainer.style.background="url('img/mooncatl.jpg') center top no-repeat",kontainer.style.backgroundSize="cover",fader.style.opacity=0,fader.style.display="none",fader.parentNode.removeChild(fader),cL(loadr,0,"paus"),loadr.style.display="none",loadr.parentNode.removeChild(loadr)}function eL(e,t,n,o){0==t?e.addEventListener(n,o,!1):e.removeEventListener(n,o,!1)}function cL(e,t,n){0==t?e.classList.contains(n)||e.classList.add(n):e.classList.contains(n)&&e.classList.remove(n)}function init(){function e(e){return document.getElementById(e)}ui.kontainer=e("kontainer"),ui.onAud=e("onAud"),ui.offAud=e("offAud"),ui.loadr=e("loadr"),ui.fader=e("fader"),ui.fader.style.opacity=1;let t=document.createElement("div");t.setAttribute("id","dummy"),document.body.appendChild(t),isMobil="9000px"!=window.getComputedStyle(t,null).getPropertyValue("left"),isMobil&&(document.addEventListener("gesturechange",(function(e){e.preventDefault()}),!1),ui.kontainer.addEventListener("gesturechange",(function(e){e.preventDefault()}),!1),_.prevW=_.prevH=0),t.parentNode.removeChild(t),_.width=window.innerWidth,_.height=window.innerHeight,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",ui.kontainer.style.backgroundColor="#000000";if(_.ej=[],_.ej[0]=0,_.ej[1]=-1,_.ej[2]=Math.PI,_.ej[3]=0,_.ej[4]=0,_.ej[5]=30,x.zz=350,renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!1}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(_.width,_.height),renderer.setClearColor(0,1),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,renderer.outputColorSpace=THREE.LinearSRGBColorSpace,renderer.sortObjects=!1,ui.kontainer.appendChild(renderer.domElement),!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float"))throw alert("OES_texture_float not supported"),"missing webgl extension";if(!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float_linear"))throw alert("OES_texture_float_linear not supported"),"missing webgl extension";scene=new THREE.Scene,x.camGrup=new THREE.Group,grups[0]=new THREE.Group,camera=new THREE.PerspectiveCamera(50,_.width/_.height,1,1e4),camera.position.set(0,_.ej[5],x.zz),x.camGrup.add(camera),scene.add(new THREE.AmbientLight(13487565)),x.spotLight=[],x.spotLight[0]=new THREE.SpotLight(16775913,3,260,Math.PI/7,1,0),x.spotLight[0].position.set(-128.5,81.8-80,-2),scene.add(x.spotLight[0]),x.spotLight[1]=new THREE.SpotLight(16775913,3,260,Math.PI/7,1,0),x.spotLight[1].position.set(144.5,188.8,-2),scene.add(x.spotLight[1]),x.spotLight[2]=new THREE.SpotLight(16775913,3,220,Math.PI/7,1,0),x.spotLight[2].position.set(158,-48.2,-2),scene.add(x.spotLight[2]),x.spotTarget=new THREE.Object3D,x.spotTarget.position.set(21.5,81.8,-2),scene.add(x.spotTarget),x.spotLight[0].target=x.spotTarget,x.spotLight[1].target=x.spotTarget,x.spotLight[2].target=x.spotTarget,x.camGrup.position.set(0,0,_.ej[3]),scene.add(x.camGrup);eL(window,1,"load",init),eL(window,0,"resize",onWindowResize),x.rotCam=!1,clock=new THREE.Clock,clock.autoStart=!1,grups[0]=new THREE.Group,grups[1]=new THREE.Group,_.mouse=new THREE.Vector2,_.entro=!0,_.idleTimer=0,_.fokus=!0,_.pointer=new THREE.Vector2,_.ptrDown=!1,x.currGrup=0,x.target0=new THREE.Object3D,x.target0.position.set(0,30,0),scene.add(x.target0),addClouds(),addMoon(),onWindowResize()}function addSkybox(){const e=".png",t=new THREE.CubeTextureLoader;t.setPath("img/skybox/14/"),t.load(["left"+e,"right"+e,"top"+e,"bottom"+e,"back"+e,"front"+e],(function(e){e.colorSpace=THREE.LinearSRGBColorSpace,x.skybox=e,scene.backgroundRotation.set(0,1.55,0),addRoads(),addSea()}))}function addClouds(){const e=new THREE.SphereGeometry(1500,32,16,0,2*Math.PI,0,Math.PI/2),t=new THREE.MeshBasicMaterial({color:16777215,side:THREE.BackSide,fog:!1}),n=new THREE.Mesh(e,t);n.position.y=-20,n.rotation.y=Math.PI-.5,x.camGrup.add(n);let o=new THREE.TextureLoader;new THREE.TextureLoader;o.load("img/skybox/0/mway3.jpg",(function(e){n.material.map=e,n.material.needsUpdate=!0})),addMountains(),addSea()}function addMountains(){const e=new THREE.CylinderGeometry(1480,1480,200,32,1,!0,Math.PI/2-.25,Math.PI+.5),t=new THREE.MeshBasicMaterial({color:2236962,side:1,alphaTest:.5}),n=new THREE.Mesh(e,t);n.position.set(0,70,0),scene.add(n),(new THREE.TextureLoader).load("img/mountainsil.jpg",(function(e){e.wrapS=e.wrapT=THREE.MirroredRepeatWrapping,e.repeat.set(5,1),t.alphaMap=e,t.needsUpdate=!0}))}function addSea(){const e=new THREE.PlaneGeometry(3e3,3e3);x.sea=new Water(e,{textureWidth:1024,textureHeight:1024,waterNormals:(new THREE.TextureLoader).load("img/water/waternormals.jpg",(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping})),sunDirection:new THREE.Vector3,sunColor:16777215,waterColor:1122864,distortionScale:8,fog:void 0!==scene.fog}),x.sea.position.set(0,-20,0),x.sea.rotation.x=-Math.PI/2,scene.add(x.sea);x.sea.material.uniforms.size.value=.02}function addMoon(){let e=0;(new OBJLoader).load("obj/moon/0/moon.obj",(function(t){t.traverse((function(t){t.isMesh&&(t.geometry.computeBoundingBox(),e+=1)})),x.moon=t;const n=[];for(let t=0;t<e;t++)n[t]=new THREE.MeshStandardMaterial({color:16775913,roughness:0}),n[t].emissive.setHex(16775913),n[t].emissiveIntensity=.5,x.moon.children[t].material=n[t];x.moon.scale.set(70,70,70),x.moon.position.set(21.5,81.8,-2),x.moon.rotation.set(0,-Math.PI,-.4),grups[0].add(x.moon),scene.add(grups[0]);const o=new THREE.PlaneGeometry(209,209),i=new THREE.MeshBasicMaterial({color:16775913,depthWrite:!1,side:2});i.transparent=!0,i.opacity=.67,i.wireframe=!0,x.moonGlow=new THREE.Mesh(o,i),x.moonGlow.position.set(15.3,85.1,-2),scene.add(x.moonGlow);(new THREE.TextureLoader).load("obj/moon/0/mat/alfa.jpg",(function(e){i.alphaMap=e,i.needsUpdate=!0,i.wireframe=!1,animCat1()}))}))}function addSun(){let e=new THREE.TextureLoader;const t=(new THREE.TextureLoader).load("img/sun/flare3.jpg",(function(e){}));e.load("img/sun/alfa2.jpg",(function(e){const n=new Lensflare;n.addElement(new LensflareElement(e,700,0,x.directionalLight.color)),n.addElement(new LensflareElement(t,50,.4)),n.addElement(new LensflareElement(t,80,.5)),n.addElement(new LensflareElement(t,120,.6)),n.addElement(new LensflareElement(t,70,.7)),n.position.set(0,650,-2500),x.camGrup.add(n)}))}function fadeScene(){onWindowResize(),function e(){let t=parseFloat(ui.fader.style.opacity);(t-=.05)<0?(ui.fader.style.opacity=0,ui.fader.style.display="none",ui.fader.parentNode.removeChild(ui.fader),onWindowResize(),eL(ui.kontainer,0,"pointerdown",onPointerDown),eL(ui.kontainer,0,"pointermove",onPointerMove),animate(),theOptions(),cL(ui.loadr,0,"paus"),ui.loadr.style.display="none",ui.loadr.parentNode.removeChild(ui.loadr)):(ui.fader.style.opacity=t,requestAnimationFrame(e))}()}function theOptions(){isMobil?(eL(ui.onAud,0,"touchstart",audClick),eL(ui.offAud,0,"touchstart",audClick)):(eL(ui.onAud,0,"click",audClick),eL(ui.offAud,0,"click",audClick))}function audClick(e){e&&e.preventDefault(),x.sound?x.sound.isPlaying?(cL(ui.offAud,0,"noneIt2"),cL(ui.onAud,1,"noneIt2"),x.sound.pause()):(cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2"),x.sound.play()):addAud(),_.idleTimer=0}function onPointerDown(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-e.clientY/_.height*2+1):(t.x=e.x/_.width*2-1,t.y=-e.y/_.height*2+1),_.ptrDown=!0,_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function onPointerMove(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-e.clientY/_.height*2+1):(t.x=e.x/_.width*2-1,t.y=-e.y/_.height*2+1),_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function wheelE(e){e&&e.preventDefault(),_.idleTimer=0}function onWindowResize(){_.width=window.innerWidth,_.height=window.innerHeight,isMobil&&(_.width==_.prevW&&(_.width=_.prevH,_.height=_.prevW),_.prevW=_.width,_.prevH=_.height),_.widthH=_.width/2,_.heightH=_.height/2,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",camera.aspect=_.width/_.height,camera.updateProjectionMatrix(),renderer.setSize(_.width,_.height),_.width>_.height?(cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.022+"px",x.zz=350):(cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.028+"px",x.zz=450),camera.position.z=x.zz,_.idleTimer=0}function animate(){if(requestAnimationFrame(animate),_.idleTimer<idleTO){clock.running||clock.start();const e=5e-4*Date.now();let t=.3*clock.getDelta();if(isMobil?(camera.position.x=240*Math.sin(.7*e),camera.position.y=60*Math.cos(.5*e)+45):(camera.position.x=240*_.pointer.x,camera.position.y=60*_.pointer.y+45),x.sea.material.uniforms.time.value-=.0015,x.sound)if(x.sound.isPlaying){let e=x.analyser.getAverageFrequency()/35;e>0?(x.moon.children[0].material.emissiveIntensity=e/1.65,x.moonGlow.material.opacity=.8*e,x.spotLight[0].intensity=x.spotLight[1].intensity=x.spotLight[2].intensity=3.55*e,t*=1.5*e):(x.moon.children[0].material.emissiveIntensity=x.moonGlow.material.opacity=0,x.spotLight[0].intensity=x.spotLight[1].intensity=x.spotLight[2].intensity=0,t=0)}else x.moon.children[0].material.emissiveIntensity=.5,x.moonGlow.material.opacity=.67,x.spotLight[0].intensity=x.spotLight[1].intensity=x.spotLight[2].intensity=3;mixer.update(t),_.idleTimer+=.01,render()}else clock.running&&clock.stop(),x.sound&&x.sound.isPlaying&&x.sound.pause();document.hasFocus()?_.fokus||(_.idleTimer=0,_.fokus=!0,x.sound&&(x.sound.isPlaying||x.sound.play())):(_.idleTimer=idleTO,_.fokus=!1,x.sound&&x.sound.isPlaying&&x.sound.pause())}function render(){camera.lookAt(x.target0.position),renderer.render(scene,camera)}function animCat1(){let e=0,t="cat/1/cat";t+=".fbx";(new FBXLoader).load("obj/cat/1/cat.fbx",(function(t){t.traverse((function(t){t.isMesh&&(t.geometry.computeBoundingBox(),1==e&&(t.castShadow=!0),e+=1)})),x.cat=t;const n=[],o="obj/cat/1/mat/",i=[16777215,16772852,11412053,16777215,16777215,16777215,11184810,16772852,15649979,16777215],a=[1,.5,0,0,1,1,1,.5,1,0];for(let t=0;t<e;t++)n[t]=new THREE.MeshStandardMaterial({color:i[t],roughness:a[t],metalness:0}),0!=t&&6!=t||(n[t].wireframe=!0),x.cat.children[t].material=n[t];x.cat.position.set(0,20,0),scene.add(x.cat);const r=new THREE.TextureLoader,d=new THREE.TextureLoader,s=(new THREE.TextureLoader,new THREE.TextureLoader,new THREE.TextureLoader,new THREE.TextureLoader,new THREE.TextureLoader);new THREE.TextureLoader,new THREE.TextureLoader,new THREE.TextureLoader,new THREE.TextureLoader;r.load(o+"clothes.jpg",(function(e){n[0].map=e,n[0].needsUpdate=!0,n[0].wireframe=!1})),s.load(o+"brow.jpg",(function(e){n[6].map=e,n[6].needsUpdate=!0,n[6].wireframe=!1})),d.load(o+"clothesn.jpg",(function(e){n[0].normalMap=e,n[0].needsUpdate=!0})),anim8()}))}function anim8(){x.actions=[];let e="cat/1/Sitting";e+=".fbx";(new FBXLoader).load("obj/cat/1/Sitting.fbx",(function(e){mixer=new THREE.AnimationMixer(x.cat),x.actions[0]=mixer.clipAction(e.animations[0]),x.actions[0].play(),mixer.update(0),fadeScene()}))}function addAud(){if(!x.sound){let e="mnct";e+=".mp3";const t=new THREE.AudioListener;camera.add(t),x.sound=new THREE.Audio(t);(new THREE.AudioLoader).load("aud/"+e,(function(e){x.sound.setBuffer(e),x.sound.setLoop(!0),x.sound.setVolume(1),x.sound.play(),cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2")})),x.analyser=new THREE.AudioAnalyser(x.sound,64)}}
	
	