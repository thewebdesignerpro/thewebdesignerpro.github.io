/**
 * author Armstrong "Army" Chiu
 * URL: https://thewebdesignerpro.com/     
 */
 
 
import*as THREE from"three";import WebGL from"three/addons/capabilities/WebGL.js";import{reflector,uv,texture,color}from"three/tsl";import{OBJLoader}from"three/addons/loaders/OBJLoader.js";import*as BufferGeometryUtils from"three/addons/utils/BufferGeometryUtils.js";const idleTO=120,florY=-50,ceilY=140;let camera,scene,renderer,clock;const grups=[];let mixer,isMobil=!1,mouseX=0,mouseY=-50;const ui={},_={},x={};let postProcessing,volumetricMesh,pointLight,controls,isAvailable="undefined"!=typeof navigator&&void 0!==navigator.gpu;if(WebGL.isWebGL2Available()&&isAvailable)window.addEventListener?window.addEventListener("load",init,!1):window.attachEvent?window.attachEvent("onload",init):window.onload=init;else{const e='Your browser does not support <a href="https://gpuweb.github.io/gpuweb/" style="color:blue">WebGPU</a> yet';kontainer.appendChild(e),kontainer.style.background="url('img/cyberpunkl.jpg') center top no-repeat",kontainer.style.backgroundSize="cover",fader.style.opacity=0,fader.style.display="none",fader.parentNode.removeChild(fader),cL(loadr,0,"paus"),loadr.style.display="none",loadr.parentNode.removeChild(loadr)}function eL(e,t,o,a){0==t?e.addEventListener(o,a,!1):e.removeEventListener(o,a,!1)}function cL(e,t,o){0==t?e.classList.contains(o)||e.classList.add(o):e.classList.contains(o)&&e.classList.remove(o)}function init(){function e(e){return document.getElementById(e)}ui.kontainer=e("kontainer"),ui.onAud=e("onAud"),ui.offAud=e("offAud"),ui.loadr=e("loadr"),ui.fader=e("fader"),ui.fader.style.opacity=1;let t=document.createElement("div");t.setAttribute("id","dummy"),document.body.appendChild(t),isMobil="9000px"!=window.getComputedStyle(t,null).getPropertyValue("left"),isMobil&&(document.addEventListener("gesturechange",(function(e){e.preventDefault()}),!1),ui.kontainer.addEventListener("gesturechange",(function(e){e.preventDefault()}),!1),_.prevW=_.prevH=0),t.parentNode.removeChild(t),_.width=window.innerWidth,_.height=window.innerHeight,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",ui.kontainer.style.backgroundColor="#404755";_.ej=[],_.ej[0]=1500,_.ej[1]=3,_.ej[2]=Math.PI,_.ej[3]=-1500,_.ej[4]=0,_.ej[5]=70,x.zz=300,scene=new THREE.Scene,x.camGrup=new THREE.Group,grups[0]=new THREE.Group,grups[1]=new THREE.Group,scene.add(grups[0]),scene.add(grups[1]),camera=new THREE.PerspectiveCamera(50,_.width/_.height,1,12e3),camera.position.set(0,_.ej[5],x.zz),x.camGrup.add(camera),scene.add(x.camGrup),scene.add(new THREE.AmbientLight(11184810)),clock=new THREE.Clock,clock.autoStart=!1,_.mouse=new THREE.Vector2,_.entro=!0,_.idleTimer=0,_.fokus=!0,_.pointer=new THREE.Vector2,_.ptrDown=!1,renderer=new THREE.WebGPURenderer({antialias:!0}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(_.width,_.height),renderer.setClearColor(4212565,1),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,renderer.outputColorSpace=THREE.LinearSRGBColorSpace,renderer.sortObjects=!1,ui.kontainer.appendChild(renderer.domElement);const o=new THREE.DirectionalLight(16777215,2.2);o.castShadow=!0,o.shadow.mapSize.width=1792,o.shadow.mapSize.height=1792,o.shadow.camera.far=3e3,o.shadow.camera.left=-4e3,o.shadow.camera.bottom=-1e3,o.shadow.camera.right=4e3,o.shadow.camera.top=1e3,o.position.set(0,1e3,-1e3),o.shadow.intensity=.75,scene.add(o),eL(window,1,"load",init),eL(window,0,"resize",onWindowResize),x.currGrup=0,x.target0=new THREE.Object3D,x.target0.position.set(0,_.ej[5],0),scene.add(x.target0),x.rotCam=!1,x.inCar=!0,addSkybox(),addSidewalk(),addRailings(),addLamps(),onWindowResize()}function addSkybox(){const e=".jpg",t=new THREE.CubeTextureLoader;t.setPath("img/skybox/11/"),t.load(["posx"+e,"negx"+e,"posy"+e,"negy"+e,"posz"+e,"negz"+e],(function(e){x.skybox=e,addBg(),addCar()}))}function addBg(){x.skyMater=[0];const e=new THREE.PlaneGeometry(9e3,1876);x.skyMater[0]=new THREE.MeshBasicMaterial({color:16777215,fog:!1}),x.skyMater[0].transparent=!0,x.skyMater[0].opacity=.5,x.skyMater[0].blending=THREE.AdditiveBlending,x.skyMater[1]=new THREE.MeshBasicMaterial({color:16777215,fog:!1}),x.skyMater[0].wireframe=x.skyMater[1].wireframe=!0,x.skyBg=new THREE.Mesh(e,x.skyMater[0]),x.skyBg.position.y=670,x.skyBg.position.z=-1098,scene.add(x.skyBg);const t=new THREE.Mesh(e,x.skyMater[1]);t.position.y=670,t.position.z=-1100,scene.add(t),(new THREE.TextureLoader).load("img/skybox/11/cyber3b.jpg",(function(e){e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.MirroredRepeatWrapping,e.offset.set(.5,0),e.repeat.set(3,1.66),x.skyMater[0].map=x.skyMater[1].map=e,x.skyMater[0].needsUpdate=x.skyMater[1].needsUpdate=!0,addWetGround()}))}function addRoads(e,t){x.road=[];const o=new THREE.PlaneGeometry(1e3,3e3),a=new THREE.MeshStandardMaterial({color:16777215,roughness:.9,metalness:.2});a.transparent=!0,a.opacity=.88,a.wireframe=!0;for(let e=0;e<2;e++)x.road[e]=new THREE.Mesh(o,a),x.road[e].position.set(0,florY+.2,0),x.road[e].rotateX(-Math.PI/2),x.road[e].rotateZ(-Math.PI/2),x.road[e].receiveShadow=!0,grups[e].add(x.road[e]);a.normalMap=e,a.map=t;const n=new THREE.TextureLoader,r=new THREE.TextureLoader,i="img/road/0/mat/";n.load(i+"rough012c.jpg",(function(e){a.roughnessMap=e,a.needsUpdate=!0})),r.load(i+"alfa012c.jpg",(function(e){a.alphaMap=e,a.needsUpdate=!0,a.wireframe=x.skyMater[0].wireframe=x.skyMater[1].wireframe=!1,addLights()}))}function addWetGround(){(new THREE.TextureLoader).load("img/road/0/mat/normal012c.jpg",(function(e){addWetGround2(e)}))}function addWetGround2(e){(new THREE.TextureLoader).load("img/road/0/mat/color012c.jpg",(function(t){const o=uv().mul(1),a=texture(e,o).xy.mul(2).sub(1).mul(.04),n=reflector({resolution:.5});n.target.position.y=florY+.21,n.target.rotateX(-Math.PI/2),n.uvNode=n.uvNode.add(a),grups[0].add(n.target);const r=new THREE.MeshPhongNodeMaterial;r.colorNode=texture(t,o).add(n);const i=new THREE.PlaneGeometry(1e3,3e3);x.mirror01=new THREE.Mesh(i,r),x.mirror01.receiveShadow=!0,x.mirror01.position.set(0,florY,0),x.mirror01.rotateX(-Math.PI/2),x.mirror01.rotateZ(-Math.PI/2),grups[0].add(x.mirror01);const s=reflector({resolution:.5});s.target.position.y=florY+.21,s.target.rotateX(-Math.PI/2),s.uvNode=s.uvNode.add(a),grups[1].add(s.target);const d=new THREE.PlaneGeometry(1e3,3e3);x.mirror23=new THREE.Mesh(d,r),x.mirror23.receiveShadow=!0,x.mirror23.position.set(0,florY,0),x.mirror23.rotateX(-Math.PI/2),x.mirror23.rotateZ(-Math.PI/2),grups[1].add(x.mirror23),grups[0].position.set(-1500,50,0),grups[1].position.set(1500,50,0),addRoads(e,t)}))}function addSidewalk(){const e=[],t=12303291,o=new THREE.PlaneGeometry(3e3,60),a=new THREE.MeshStandardMaterial({color:t,roughness:1,metalness:0});for(let n=0;n<2;n++){a[n]=new THREE.MeshStandardMaterial({color:t,roughness:1,metalness:0}),e[n]=new THREE.Mesh(o,a),e[n].position.set(0,florY+8,-500);const r=Math.PI/-2;e[n].rotation.x=r,e[n].receiveShadow=!0,grups[n].add(e[n])}const n=new THREE.PlaneGeometry(3e3,8);for(let t=2;t<4;t++)e[t]=new THREE.Mesh(n,a),e[t].position.set(0,florY+4,-470),e[t].receiveShadow=!0,grups[t-2].add(e[t]);const r=new THREE.TextureLoader,i=new THREE.TextureLoader,s=new THREE.TextureLoader,d="img/ground/7/";r.load(d+"color1.jpg",(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.repeat.set(5,.1),a.map=e,a.needsUpdate=!0,a.wireframe=!1})),i.load(d+"rough1.jpg",(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.repeat.set(5,.1),a.roughnessMap=e,a.needsUpdate=!0})),s.load(d+"normal1.jpg",(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.repeat.set(5,.1),a.normalScale.set(5,5),a.normalMap=e,a.needsUpdate=!0}))}function randomizeMatrix(e,t){const o=new THREE.Vector3,a=new THREE.Euler,n=new THREE.Quaternion,r=new THREE.Vector3;return o.x=150*t-2925,o.y=40,o.z=-475,n.setFromEuler(a),r.x=150,r.y=r.z=30,e.compose(o,n,r)}function addRailings(){const e=[],t=[];(new OBJLoader).load("obj/street/2/railing.obj",(function(o){o.traverse((function(e){e.isMesh&&e.geometry.computeBoundingBox()})),e[0]=new THREE.MeshStandardMaterial({color:16777215,roughness:.25,metalness:.1});for(let a=0;a<1;a++){const n=o.children[0].geometry.attributes.position.array.length,r=40;t[a]=new THREE.BatchedMesh(r,n,2*n,e[0]),t[a].frustumCulled=!0,t[a].castShadow=!0,t[a].receiveShadow=!0;const i=t[a].addGeometry(o.children[0].geometry);let s=new THREE.Matrix4;for(let e=0;e<r;e++){const o=t[a].addInstance(i);s=randomizeMatrix(s,e),t[a].setMatrixAt(o,s)}scene.add(t[a]),t[a].visible=!1}(new THREE.TextureLoader).load("obj/street/2/mat/color1.jpg",(function(o){o.wrapS=o.wrapT=THREE.RepeatWrapping,o.repeat.set(6,6),e[0].map=o,e[0].needsUpdate=!0,t[0].visible=!0}))}))}function randomizeMatrix2(e,t){const o=new THREE.Vector3,a=new THREE.Euler,n=new THREE.Quaternion,r=new THREE.Vector3;return o.x=[-2250,-1500,-750,0,750,1500,2250][t],o.y=florY+318,o.z=-467,a.y=Math.PI/-2,n.setFromEuler(a),r.x=r.y=r.z=.9,e.compose(o,n,r)}function addLamps(){x.lamps=[],x.bulbs=[];(new OBJLoader).load("obj/lamp/model.obj",(function(e){e.traverse((function(e){e.isMesh&&e.geometry.computeBoundingBox()}));const t=new THREE.MeshStandardMaterial({color:16777215,roughness:.2,metalness:.8}),o=new THREE.MeshBasicMaterial({color:15066075});for(let a=0;a<1;a++){const n=e.children[0].geometry.attributes.position.array.length,r=e.children[1].geometry.attributes.position.array.length,i=7;x.lamps[a]=new THREE.BatchedMesh(i,n,2*n,t),x.lamps[a].frustumCulled=!0,x.lamps[a].castShadow=!0,x.bulbs[a]=new THREE.BatchedMesh(i,r,2*r,o),x.bulbs[a].frustumCulled=!0;const s=x.lamps[a].addGeometry(e.children[0].geometry),d=x.bulbs[a].addGeometry(e.children[1].geometry);let l=new THREE.Matrix4;for(let e=0;e<i;e++){const t=x.lamps[a].addInstance(s),o=x.bulbs[a].addInstance(d);l=randomizeMatrix2(l,e),x.lamps[a].setMatrixAt(t,l),x.bulbs[a].setMatrixAt(o,l)}scene.add(x.lamps[a]),scene.add(x.bulbs[a]),x.lamps[a].visible=x.bulbs[a].visible=!1}const a=new THREE.TextureLoader,n=new THREE.TextureLoader,r="obj/lamp/mat/";a.load(r+"color1.jpg",(function(e){t.map=e,t.needsUpdate=!0;for(let e=0;e<1;e++)x.lamps[e].visible=x.bulbs[e].visible=!0})),n.load(r+"normal1.jpg",(function(e){t.normalMap=e,t.needsUpdate=!0;for(let e=0;e<1;e++)x.lamps[e].visible=x.bulbs[e].visible=!0}))}))}function addLights(){x.spotLight=[],x.spotLcone=[],x.target=[];const e=[-750,0,750];for(let t=0;t<3;t++)x.spotLight[t]=new THREE.SpotLight(16776693,2e6,450,Math.PI/5,1),x.spotLight[t].position.set(e[t],361,-394),x.spotLight[t].castShadow=!0,x.spotLight[t].shadow.camera.near=1,x.spotLight[t].shadow.camera.far=450,x.spotLight[t].shadow.camera.fov=40,scene.add(x.spotLight[t]),x.target[t]=new THREE.Object3D,x.target[t].position.set(e[t],florY,-394),scene.add(x.target[t]),x.spotLight[t].target=x.target[t];const t=new THREE.PlaneGeometry(260,260),o=new THREE.MeshBasicMaterial({color:16776693,transparent:!0,opacity:.5,side:2});o.depthWrite=!1;const a=[0,Math.PI/2,Math.PI/4,Math.PI/-4,Math.PI/6,Math.PI/-6,Math.PI/8,Math.PI/-8];for(let n=0;n<3;n++)x.spotLcone[n]=new THREE.Mesh(t,o),x.spotLcone[n].position.set(e[n],235,-394),x.spotLcone[n].rotateY(a[n]),x.spotLcone[n].visible=!1,scene.add(x.spotLcone[n]);x.targetCam=new THREE.Object3D,x.targetCam.position.set(camera.position.x,235,camera.position.z),scene.add(x.targetCam);(new THREE.TextureLoader).load("img/spotLconeA.png",(function(e){o.alphaMap=e,o.needsUpdate=!0;for(let e=0;e<3;e++)x.spotLcone[e].visible=!0;addCarLights()}))}function addCar(){let e=0,t=[];(new OBJLoader).load("obj/outrun/lowpolycar.obj",(function(o){o.traverse((function(t){t.isMesh&&(0!=e&&1!=e&&3!=e||(t.geometry=BufferGeometryUtils.toCreasedNormals(t.geometry,40/180*Math.PI)),t.geometry.computeBoundingBox(),e+=1)})),_.envMrotY=0,t[0]=new THREE.MeshStandardMaterial({color:6184542,roughness:.2,metalness:.2,envMap:x.skybox,side:2}),t[1]=new THREE.MeshStandardMaterial({color:6184542,roughness:.2,metalness:.22,envMap:x.skybox,side:0}),t[2]=new THREE.MeshBasicMaterial({color:4671303}),t[3]=new THREE.MeshBasicMaterial({color:11202303,transparent:!0,opacity:.9,envMap:x.skybox}),t[4]=new THREE.MeshBasicMaterial({color:10411517}),t[5]=new THREE.MeshBasicMaterial({color:10411517}),t[0].envMapIntensity=10,t[1].envMapIntensity=40,x.car=new THREE.Mesh(o.children[0].geometry,t),x.car.scale.set(30,30,30),x.car.position.set(0,florY+90,-200),x.car.castShadow=!0,x.car.receiveShadow=!0,x.camGrup.add(x.car),x.car.rotation.y=Math.PI/-2}))}function addCarLights(){x.hLights1=[];const e=new THREE.PlaneGeometry(87,107),t=new THREE.MeshBasicMaterial({color:10343925,transparent:!0,opacity:.4,side:THREE.DoubleSide,depthWrite:!1});x.hLights1[0]=new THREE.Mesh(e,t),x.hLights1[1]=new THREE.Mesh(e,t),x.hLights1[0].position.set(134,39,-137),x.hLights1[1].position.set(134,39,-262),x.hLights1[0].rotateX(Math.PI/-2+.14),x.hLights1[0].rotateY(.34),x.hLights1[1].rotateX(Math.PI/2-.14),x.hLights1[1].rotateY(-.34),x.camGrup.add(x.hLights1[0]),x.camGrup.add(x.hLights1[1]);let o=new THREE.TextureLoader,a=new THREE.TextureLoader;o.load("img/outrun/glow3.png",(function(e){for(let t=0;t<2;t++)x.hLights1[t].material.alphaMap=e,x.hLights1[t].material.needsUpdate=!0}));const n=new THREE.PlaneGeometry(100,72);x.lConeMater=new THREE.MeshBasicMaterial({color:10343925,transparent:!0,opacity:.5,side:THREE.DoubleSide,depthWrite:!1}),x.lCones=[],x.lCones[0]=new THREE.Mesh(n,x.lConeMater),x.lCones[1]=new THREE.Mesh(n,x.lConeMater),x.lCones[0].position.set(-191,57,-147),x.lCones[1].position.set(-191,57,-252),x.lCones[0].rotateX(Math.PI/-2),x.lCones[1].rotateX(Math.PI/-2),a.load("img/outrun/tGlow3.png",(function(e){x.lConeMater.alphaMap=e,x.lConeMater.needsUpdate=!0,x.camGrup.add(x.lCones[0]),x.camGrup.add(x.lCones[1]),addTires()}))}function addTires(){let e=[];x.fTire=[],x.rTire=[],e[0]=new THREE.MeshStandardMaterial({color:11189196,roughness:.1,metalness:.25,envMap:x.skybox}),e[1]=new THREE.MeshBasicMaterial({color:2263193}),e[2]=new THREE.MeshStandardMaterial({color:8947848});const t=new OBJLoader;new OBJLoader;t.load("obj/outrun/wheelfront2.obj",(function(t){t.traverse((function(e){e.isMesh&&e.geometry.computeBoundingBox()}));for(let o=0;o<2;o++)x.fTire[o]=new THREE.Mesh(t.children[0].geometry,e),x.fTire[o].scale.set(28,28,28),1==o&&(x.fTire[o].castShadow=!0),0==o&&(x.fTire[o].receiveShadow=!0),x.camGrup.add(x.fTire[o]);for(let o=2;o<4;o++)x.fTire[o]=new THREE.Mesh(t.children[0].geometry,e),x.fTire[o].scale.set(36.2,36.2,36.2),3==o&&(x.fTire[o].castShadow=!0),2==o&&(x.fTire[o].receiveShadow=!0),x.camGrup.add(x.fTire[o]);x.fTire[0].position.set(86,florY+72,-135),x.fTire[1].position.set(86,florY+72,-264),x.fTire[2].position.set(-93.7,florY+77,-135),x.fTire[3].position.set(-93.7,florY+77,-264),x.fTire[0].rotateY(Math.PI/-2),x.fTire[1].rotateY(Math.PI/2),x.fTire[2].rotateY(Math.PI/-2),x.fTire[3].rotateY(Math.PI/2),fadeScene()}))}function fadeScene(){onWindowResize(),function e(){let t=parseFloat(ui.fader.style.opacity);(t-=.1)<0?(ui.fader.style.opacity=0,ui.fader.style.display="none",ui.fader.parentNode.removeChild(ui.fader),onWindowResize(),eL(ui.kontainer,0,"pointerdown",onPointerDown),eL(ui.kontainer,0,"pointermove",onPointerMove),eL(ui.kontainer,0,"click",kontainerClick),eL(ui.kontainer,0,"wheel",wheelE),x.camV3=new THREE.Vector3,theOptions(),cL(ui.loadr,0,"paus"),ui.loadr.style.display="none",ui.loadr.parentNode.removeChild(ui.loadr),renderer.setAnimationLoop(animate)):(ui.fader.style.opacity=t,requestAnimationFrame(e))}()}function theOptions(){isMobil?(eL(ui.onAud,0,"touchstart",audClick),eL(ui.offAud,0,"touchstart",audClick)):(eL(ui.onAud,0,"click",audClick),eL(ui.offAud,0,"click",audClick))}function audClick(e){e&&e.preventDefault(),x.sound?x.sound.isPlaying?(cL(ui.offAud,0,"noneIt2"),cL(ui.onAud,1,"noneIt2"),x.sound.pause()):(cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2"),x.sound.play()):addAud(),_.idleTimer=0}function onPointerDown(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-e.clientY/_.height*2+1):(t.x=e.x/_.width*2-1,t.y=-e.y/_.height*2+1),_.ptrDown=!0,_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function onPointerMove(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-e.clientY/_.height*2+1):(t.x=e.x/_.width*2-1,t.y=-e.y/_.height*2+1),_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function kontainerClick(e){e&&e.preventDefault(),_.idleTimer=0}function wheelE(e){e&&e.preventDefault(),_.idleTimer=0}function onWindowResize(){_.width=window.innerWidth,_.height=window.innerHeight,isMobil&&(_.width==_.prevW&&(_.width=_.prevH,_.height=_.prevW),_.prevW=_.width,_.prevH=_.height),_.widthH=_.width/2,_.heightH=_.height/2,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",camera.aspect=_.width/_.height,camera.updateProjectionMatrix(),renderer.setSize(_.width,_.height),x.zz=300,_.width>_.height?(cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.022+"px",x.zz=_.height/_.width<.44?200:300):(cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.028+"px",x.zz=_.width/_.height<.5?550:400),camera.position.z=x.zz,_.idleTimer=0}function animWalk(){let e=x.camGrup.position.x,t=x.target0.position.x;switch(e){case-1497:x.spotLight[1].position.x=x.spotLcone[1].position.x=x.target[1].position.x=0;break;case-750:x.spotLight[2].position.x=x.spotLcone[2].position.x=x.target[2].position.x=750;break;case 0:x.spotLight[0].position.x=x.spotLcone[0].position.x=x.target[0].position.x=1500;break;case 750:x.spotLight[1].position.x=x.spotLcone[1].position.x=x.target[1].position.x=2250;break;case 1500:x.spotLight[2].position.x=x.spotLcone[2].position.x=x.target[2].position.x=-1500,x.spotLight[0].position.x=x.spotLcone[0].position.x=x.target[0].position.x=-750}e<_.ej[0]?(x.camGrup.position.x=e+_.ej[1],x.target0.position.x=t+_.ej[1]):(x.camGrup.position.x=_.ej[3],x.target0.position.x=_.ej[3],x.currGrup=0==x.currGrup?1:0)}function animate(){if(_.idleTimer<idleTO){clock.running||clock.start();const e=.001*Date.now();animWalk(),x.skyBg.position.z=7*Math.sin(10*e)-1090,_.envMrotY-=.005,x.car.material[0].envMapRotation.y=x.car.material[1].envMapRotation.y=_.envMrotY,x.car.material[3].envMapRotation.y=-_.envMrotY,x.lConeMater.opacity=.25*Math.sin(5*e)+.5,x.fTire[0].rotateX(-.005),x.fTire[2].rotateX(-.005);const t=.05*Math.sin(5*e);x.car.position.y+=t;for(let e=0;e<2;e++)x.hLights1[e].position.y+=t,x.lCones[e].position.y+=t;isMobil?(camera.position.x=40*Math.sin(.5*e),camera.position.y=30*Math.cos(.4*e)+_.ej[5]+10,camera.position.z=x.zz-Math.abs(20*Math.sin(.5*e))):(camera.position.x=60*_.pointer.x,camera.position.y=40*_.pointer.y+_.ej[5]+10,camera.position.z=x.zz-Math.abs(40*_.pointer.x)),_.idleTimer+=.01,render()}else clock.running&&clock.stop(),x.sound&&x.sound.isPlaying&&x.sound.pause();document.hasFocus()?_.fokus||(_.idleTimer=0,_.fokus=!0,x.sound&&(x.sound.isPlaying||x.sound.play())):(_.idleTimer=idleTO,_.fokus=!1,x.sound&&x.sound.isPlaying&&x.sound.pause())}function render(){camera.lookAt(x.target0.position),camera.getWorldPosition(x.targetCam.position),x.targetCam.position.y=235;for(let e=0;e<3;e++)x.spotLcone[e].lookAt(x.targetCam.position);renderer.render(scene,camera)}function addAud(){if(!x.sound){let e="cybrpnk";e+=".mp3";const t=new THREE.AudioListener;camera.add(t),x.sound=new THREE.Audio(t);(new THREE.AudioLoader).load("aud/"+e,(function(e){x.sound.setBuffer(e),x.sound.setLoop(!0),x.sound.setVolume(.85),x.sound.play(),cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2")}))}}
	