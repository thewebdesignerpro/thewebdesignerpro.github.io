/**
 * author Armstrong "Army" Chiu
 * URL: https://thewebdesignerpro.com/     
 */
 
import*as e from"three";import i from"three/addons/capabilities/WebGL.js";import{OBJLoader as t}from"three/addons/loaders/OBJLoader.js";let idleTO=120,florY=0,ceilY=140,camera,scene,renderer,clock,grups=[],isMobil=!1,mouseX=0,mouseY=-50,mixer,ui={},win={},x={};if(!1===i.isWebGLAvailable()){let n=i.getWebGLErrorMessage();document.body.appendChild(n)}else window.addEventListener?window.addEventListener("load",init,!1):window.attachEvent?window.attachEvent("onload",init):window.onload=init;function init(){ui.kontainer=document.getElementById("kontainer");let i=document.createElement("div");if(i.setAttribute("id","dummy"),document.body.appendChild(i),(isMobil="9000px"!=window.getComputedStyle(i,null).getPropertyValue("left"))&&(document.addEventListener("gesturechange",function(e){e.preventDefault()},!1),ui.kontainer.addEventListener("gesturechange",function(e){e.preventDefault()},!1)),i.parentNode.removeChild(i),win.width=window.innerWidth,win.height=window.innerHeight,document.body.style.width=win.width+"px",document.body.style.height=win.height+"px",ui.kontainer.style.width=win.width+"px",ui.kontainer.style.height=win.height+"px",ui.kontainer.style.opacity=0,ui.kontainer.style.backgroundColor="#d6053f",win.cr=[],win.ej=[],win.ej[0]=!1,win.ej[1]=.1,(renderer=new e.WebGLRenderer({antialias:!0,alpha:!1})).setPixelRatio(window.devicePixelRatio),renderer.setSize(win.width,win.height),renderer.setClearColor(14026047,1),renderer.shadowMap.enabled=!1,renderer.outputColorSpace=e.SRGBColorSpace,ui.kontainer.appendChild(renderer.domElement),!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float"))throw alert("OES_texture_float not supported"),"missing webgl extension";if(!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float_linear"))throw alert("OES_texture_float_linear not supported"),"missing webgl extension";(scene=new e.Scene).fog=new e.FogExp2(14026047,.002),(camera=new e.PerspectiveCamera(50,win.width/win.height,1,1e5)).position.set(0,30,150),onWindowResize(),window.removeEventListener("load",init,!1),window.addEventListener("resize",onWindowResize,!1),(clock=new e.Clock).autoStart=!1,grups[0]=new e.Group,grups[1]=new e.Group,grups[2]=new e.Group,addSky(),addCar(),win.mouse=new e.Vector2,win.entro=!0,win.idleTimer=0,win.fokus=!0,win.pointer=new e.Vector2}function entro(){ui.tempDiv=document.createElement("div"),ui.tempDiv.setAttribute("id","noAud"),ui.tempDiv.innerHTML="ENTER",ui.tempDiv.style.display="block",ui.tempDiv.style.position="absolute",ui.tempDiv.style.margin="auto",ui.tempDiv.style.top="40%",ui.tempDiv.style.bottom=ui.tempDiv.style.left=ui.tempDiv.style.right="0",ui.tempDiv.style.width="160px",ui.tempDiv.style.height="48px",ui.tempDiv.style.lineHeight="48px",ui.tempDiv.style.fontFamily="sans-serif",ui.tempDiv.style.fontSize="24px",ui.tempDiv.style.textAlign="center",ui.tempDiv.style.color="rgba(255, 255, 255, 0.5)",ui.tempDiv.style.backgroundColor="rgba(255, 255, 255, 0.15)",ui.tempDiv.style.border="2px solid rgba(255, 255, 255, 0.5)",ui.tempDiv.style.cursor="pointer",ui.kontainer.appendChild(ui.tempDiv)}function theOptions(){ui.swtchKam=document.getElementById("swtchKam"),ui.onAud=document.getElementById("onAud"),ui.offAud=document.getElementById("offAud"),isMobil?(ui.swtchKam.addEventListener("touchstart",swtchKamClick,!1),ui.onAud.addEventListener("touchstart",audClick,!1),ui.offAud.addEventListener("touchstart",audClick,!1)):(ui.swtchKam.addEventListener("click",swtchKamClick,!1),ui.onAud.addEventListener("click",audClick,!1),ui.offAud.addEventListener("click",audClick,!1))}function swtchKamClick(e){e.preventDefault(),win.ej[0]?(camera.position.set(0,30,150),grups[2].rotation.y=0,win.ej[0]=!1):win.ej[0]=!0,win.idleTimer=0}function audClick(e){e.preventDefault(),x.sound?x.sound.isPlaying?(ui.offAud.classList.add("noneIt2"),ui.onAud.classList.remove("noneIt2"),x.sound.pause()):(ui.onAud.classList.add("noneIt2"),ui.offAud.classList.remove("noneIt2"),x.sound.play()):addAud(),win.idleTimer=0}function addSky(){let i=new e.CubeTextureLoader;i.setPath("img/outrun/map/"),x.skybox=i.load(["posx.jpg","negx.jpg","posy.jpg","negy.jpg","posz.jpg","negz.jpg"]),scene.background=x.skybox,addFloor()}function addFloor(){x.floor=[];let i=new e.PlaneGeometry(2e4,2e4),t=new e.MeshBasicMaterial({color:11189196,transparent:!0,opacity:.75});for(let n=0;n<3;n++){let o=2e4-2e4*n;x.floor[n]=new e.Mesh(i,t),x.floor[n].position.set(0,0,o),x.floor[n].rotation.x=-.5*Math.PI,grups[1].add(x.floor[n])}grups[1].position.z=0;var r=new e.TextureLoader;new e.TextureLoader,r.load("img/outrun/grid4.png",function(i){i.wrapS=i.wrapT=e.RepeatWrapping,i.repeat.set(300,300);for(let t=0;t<3;t++)x.floor[t].material.map=i,x.floor[t].material.needsUpdate=!0}),grups[2].add(camera),grups[2].position.z=1e4}function addCar(){let i=0,n=[],o=new t;o.load("obj/outrun/lowpolycar.obj",function(t){t.traverse(function(e){e.isMesh&&(e.geometry.computeBoundingBox(),i+=1)}),n[0]=new e.MeshStandardMaterial({color:1118481,roughness:0,metalness:.25,envMap:x.skybox}),n[1]=new e.MeshBasicMaterial({color:3158064,envMap:x.skybox}),n[2]=new e.MeshStandardMaterial({color:8917401,roughness:.2,metalness:.4,envMap:x.skybox}),n[3]=new e.MeshBasicMaterial({color:12369084,transparent:!0,opacity:.9,envMap:x.skybox}),n[4]=new e.MeshBasicMaterial({color:16742348}),n[5]=new e.MeshBasicMaterial({color:16742348}),x.car=new e.Mesh(t.children[0].geometry,n),x.car2=new e.Mesh(t.children[0].geometry,n),x.car.scale.set(10,10,10),x.car2.scale.set(10,10,10),x.car.position.set(0,13,0),x.car2.position.set(0,-13,0),x.car2.rotation.set(0,0,Math.PI),grups[0].add(x.car),grups[0].add(x.car2),grups[0].position.z=1e4}),addCarLights(),addTires()}function addCarLights(){let i=[],t=[],n=new e.PlaneGeometry(33,35),o=new e.MeshBasicMaterial({color:16740544,transparent:!0,opacity:.65,side:e.DoubleSide,depthWrite:!1});i[0]=new e.Mesh(n,o),i[1]=new e.Mesh(n,o),i[0].position.set(-20.6,12.88,-45.1),i[1].position.set(20.6,12.88,-45.1),i[0].rotation.x=1.28,i[1].rotation.x=1.28,i[0].rotation.y=.1,i[1].rotation.y=-.1,i[1].rotation.y+=Math.PI,grups[0].add(i[0]),grups[0].add(i[1]);let r=new e.PlaneGeometry(28,4.8),a=new e.MeshBasicMaterial({color:16740544,transparent:!0,opacity:.75,side:e.DoubleSide,depthWrite:!1});t[0]=new e.Mesh(r,a),t[1]=new e.Mesh(r,a),t[0].position.set(-18.7,18.6,47.75),t[1].position.set(18.7,18.6,47.75),t[0].rotation.y=-.17,t[1].rotation.y=.17,grups[0].add(t[0]),grups[0].add(t[1]);let s=new e.TextureLoader,d=new e.TextureLoader,u=new e.TextureLoader;s.load("img/outrun/glow2b.png",function(e){for(let t=0;t<2;t++)i[t].material.map=e,i[t].material.alphaMap=e,i[t].material.needsUpdate=!0}),d.load("img/outrun/glow1.png",function(e){for(let i=0;i<2;i++)t[i].material.map=e,t[i].material.alphaMap=e,t[i].material.needsUpdate=!0});let l=new e.ConeGeometry(5.8,50,4,1,!0),$=new e.MeshBasicMaterial({color:16740544,transparent:!0,opacity:.3,side:e.DoubleSide,depthWrite:!1}),c=[];c[0]=new e.Mesh(l,$),c[1]=new e.Mesh(l,$),c[0].position.set(-18.6,18.6,71),c[1].position.set(18.6,18.6,71),c[0].rotation.x=Math.PI/2,c[1].rotation.x=Math.PI/2,c[1].rotation.y=Math.PI,c[0].scale.z=.068,c[1].scale.z=.068,u.load("img/outrun/tGlow2.png",function(e){for(let i=0;i<2;i++)c[i].material.alphaMap=e,c[i].material.needsUpdate=!0,grups[0].add(c[i])})}function addTires(){let i=[];x.fTire=[],x.rTire=[],i[0]=new e.MeshStandardMaterial({color:5575014,roughness:.1,metalness:.35,envMap:x.skybox}),i[1]=new e.MeshBasicMaterial({color:16777215,envMap:x.skybox}),i[2]=new e.MeshBasicMaterial({color:789516});let n=new t,o=new t;n.load("obj/outrun/wheelfront2.obj",function(t){t.traverse(function(e){e.isMesh&&e.geometry.computeBoundingBox()});for(let n=0;n<4;n++)x.fTire[n]=new e.Mesh(t.children[0].geometry,i),x.fTire[n].scale.set(10,10,10),grups[0].add(x.fTire[n]);x.fTire[0].position.set(24.4,7.35,-28.9),x.fTire[1].position.set(24.4,-7.35,-28.9),x.fTire[2].position.set(-24.4,7.35,-28.9),x.fTire[3].position.set(-24.4,-7.35,-28.9),x.fTire[2].rotation.set(0,Math.PI,0),x.fTire[3].rotation.set(0,Math.PI,0)}),o.load("obj/outrun/wheelback2.obj",function(t){t.traverse(function(e){e.isMesh&&e.geometry.computeBoundingBox()});for(let n=0;n<4;n++)x.rTire[n]=new e.Mesh(t.children[0].geometry,i),x.rTire[n].scale.set(10,10,10),grups[0].add(x.rTire[n]);x.rTire[0].position.set(23.08,9.23,31.23),x.rTire[1].position.set(23.08,-9.23,31.23),x.rTire[2].position.set(-23.08,9.23,31.23),x.rTire[3].position.set(-23.08,-9.23,31.23),x.rTire[2].rotation.set(0,Math.PI,0),x.rTire[3].rotation.set(0,Math.PI,0),fadeScene()}),scene.add(grups[0]),scene.add(grups[1]),scene.add(grups[2])}function fadeScene(){onWindowResize(),function e(){let i=parseFloat(ui.kontainer.style.opacity);(i+=.05)>1?(ui.kontainer.style.opacity=1,onWindowResize(),isMobil?(ui.kontainer.addEventListener("touchstart",onDocumentTouchStart,!1),ui.kontainer.addEventListener("touchmove",onDocumentTouchMove,!1)):(ui.kontainer.addEventListener("mousemove",onMouseMove,!1),ui.kontainer.addEventListener("click",kontainerClick,!1)),ui.kontainer.addEventListener("pointermove",onMouseMove,!1),ui.kontainer.addEventListener("wheel",wheelE,!1),animate(),theOptions()):(ui.kontainer.style.opacity=i,requestAnimationFrame(e))}()}function animWalk3(){let e=grups[1].position.z,i=grups[2].rotation.y;if(2e4==e?grups[1].position.z=0:grups[1].position.z=e+5,win.ej[0]&&(grups[2].rotation.y=i<6.28?i+.005:0),x.fTire[3]){let t=x.fTire[0].rotation.x;x.rTire[0].rotation.x,x.fTire[0].rotation.x=t>-6.28?t-.02:0,x.fTire[2].rotation.x=x.rTire[0].rotation.x=x.rTire[2].rotation.x=x.fTire[0].rotation.x,x.fTire[1].rotation.x=x.fTire[3].rotation.x=x.rTire[1].rotation.x=x.rTire[3].rotation.x=-1*x.fTire[0].rotation.x}}function onMouseMove(e){e&&e.preventDefault(),mouseX=e.clientX-win.widthH,mouseY=e.clientY-win.heightH,isMobil?(win.pointer.x=e.touches[0].pageX/win.width*2-1,win.pointer.y=-(2*(e.touches[0].pageY/win.height))+1):(win.pointer.x=e.clientX/win.width*2-1,win.pointer.y=-(2*(e.clientY/win.height))+1),mouseY-=50,win.idleTimer=0}function onMouseWheel(e){e.preventDefault(),win.idleTimer=0}function wheelE(e){e.preventDefault(),x.prevCamZ=camera.position.z,camera.position.z+=.1*e.deltaY,(camera.position.z<110||camera.position.z>200)&&(camera.position.z=x.prevCamZ),win.idleTimer=0}function onDocumentTouchStart(e){1===e.touches.length&&(mouseX=e.touches[0].pageX-win.widthH,mouseY=e.touches[0].pageY-win.heightH,win.pointer.x=e.touches[0].pageX/win.width*2-1,win.pointer.y=-(2*(e.touches[0].pageY/win.height))+1,win.idleTimer=0)}function onDocumentTouchMove(e){1===e.touches.length&&(mouseX=e.touches[0].pageX-win.widthH,mouseY=e.touches[0].pageY-win.heightH)}function onDocumentTouchEnd(e){1===e.touches.length&&(win.pointer.x=e.touches[0].pageX/win.width*2-1,win.pointer.y=-(2*(e.touches[0].pageY/win.height))+1,ui.kontainer.removeEventListener("touchmove",onDocumentTouchMove,!1),ui.kontainer.removeEventListener("touchend",onDocumentTouchEnd,!1),win.idleTimer=0)}function kontainerClick(e){e.preventDefault(),win.idleTimer=0}function onWindowResize(){if(win.width=window.innerWidth,win.height=window.innerHeight,isMobil){let e=document.documentElement.getBoundingClientRect(),i=document.documentElement.clientWidth,t=document.documentElement.clientHeight;if(e)win.width=e.width,win.height=e.height;else if(i)win.width=i,win.height=t;else{let n=win.width;win.width=win.height,win.height=n}}win.widthH=win.width/2,win.heightH=win.height/2,document.body.style.width=ui.kontainer.style.width=win.width+"px",document.body.style.height=ui.kontainer.style.height=win.height+"px",camera.aspect=win.width/win.height,camera.updateProjectionMatrix(),renderer.setSize(win.width,win.height),isMobil?(win.cr[1]=-.0006,win.cr[0]=4e-4):(win.cr[1]=-.0004,win.cr[0]=6e-4),win.width>win.height?(cntnt.style.fontSize=cntnt2.style.fontSize=(win.width+win.height)/2*.022+"px",win.ej[1]=.1):(cntnt.style.fontSize=cntnt2.style.fontSize=(win.width+win.height)/2*.028+"px",win.ej[1]=.2),win.idleTimer=0}function animate(){if(requestAnimationFrame(animate),win.idleTimer<120){if(clock.running||clock.start(),animWalk3(),isMobil){let e=15e-5*Date.now();win.ej[0]||(camera.position.x=70*Math.sin(3*e)),camera.position.y=20*Math.cos(e)+24,camera.position.z=40*Math.sin(e)+150}else if(win.ej[0]){let i=15e-5*Date.now();camera.position.y=20*Math.cos(i)+24,camera.position.z=40*Math.sin(i)+150}else camera.position.x=mouseX*win.ej[1],camera.position.y=-.04*mouseY+25;win.idleTimer+=.01,render()}else clock.running&&clock.stop(),x.sound&&x.sound.isPlaying&&x.sound.pause();document.hasFocus()?win.fokus||(win.idleTimer=0,win.fokus=!0,x.sound&&!x.sound.isPlaying&&x.sound.play()):(win.idleTimer=120,win.fokus=!1,x.sound&&x.sound.isPlaying&&x.sound.pause())}function render(){win.ej[0]?camera.lookAt(grups[0].position):camera.lookAt(scene.position),renderer.render(scene,camera)}function addAud(){if(!x.sound){let i="otrnstfe";i+=".mp3";let t=new e.AudioListener;camera.add(t),x.sound=new e.Audio(t);let n=new e.AudioLoader;n.load("aud/"+i,function(e){x.sound.setBuffer(e),x.sound.setLoop(!0),x.sound.setVolume(.7),x.sound.play(),ui.onAud.classList.add("noneIt2"),ui.offAud.classList.remove("noneIt2")})}} 




	