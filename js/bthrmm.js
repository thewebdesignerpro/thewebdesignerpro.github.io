/**
 * author Armstrong "Army" Chiu
 * URL: https://thewebdesignerpro.com/     
 */
 
 
import*as THREE from"three";import WebGL from"three/addons/capabilities/WebGL.js";import{OBJLoader}from"three/addons/loaders/OBJLoader.js";import{Reflector}from"three/addons/objects/Reflector.js";import*as BufferGeometryUtils from"three/addons/utils/BufferGeometryUtils.js";const idleTO=120,florY=-10,ceilY=140;let camera,scene,renderer,clock;const grups=[];let mixer,isMobil=!1,mouseX=0,mouseY=-50;const ui={},_={},x={};if(WebGL.isWebGL2Available())window.addEventListener?window.addEventListener("load",init,!1):window.attachEvent?window.attachEvent("onload",init):window.onload=init;else{const e=WebGL.getWebGL2ErrorMessage();kontainer.appendChild(e),kontainer.style.background="url('img/bathrooml.jpg') center top no-repeat",kontainer.style.backgroundSize="cover",fader.style.opacity=0,fader.style.display="none",fader.parentNode.removeChild(fader),cL(loadr,0,"paus"),loadr.style.display="none",loadr.parentNode.removeChild(loadr)}function eL(e,t,o,a){0==t?e.addEventListener(o,a,!1):e.removeEventListener(o,a,!1)}function cL(e,t,o){0==t?e.classList.contains(o)||e.classList.add(o):e.classList.contains(o)&&e.classList.remove(o)}function init(){function e(e){return document.getElementById(e)}ui.kontainer=e("kontainer"),ui.swtchKam=e("swtchKam"),ui.onAud=e("onAud"),ui.offAud=e("offAud"),ui.swtchKam.style.visibility="hidden",ui.loadr=e("loadr"),ui.fader=e("fader"),ui.fader.style.opacity=1;let t=document.createElement("div");t.setAttribute("id","dummy"),document.body.appendChild(t),isMobil="9000px"!=window.getComputedStyle(t,null).getPropertyValue("left"),isMobil&&(document.addEventListener("gesturechange",(function(e){e.preventDefault()}),!1),ui.kontainer.addEventListener("gesturechange",(function(e){e.preventDefault()}),!1),_.prevW=_.prevH=0),t.parentNode.removeChild(t),_.width=window.innerWidth,_.height=window.innerHeight,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",ui.kontainer.style.backgroundColor="#909496";if(_.ej=[],_.ej[0]=0,_.ej[1]=-2,_.ej[2]=Math.PI,_.ej[3]=0,_.ej[4]=0,_.ej[5]=0,renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!1}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(_.width,_.height),renderer.setClearColor(9475222,1),renderer.shadowMap.enabled=!1,renderer.shadowMap.type=THREE.PCFSoftShadowMap,renderer.toneMapping=THREE.NeutralToneMapping,renderer.toneMappingExposure=1.5,renderer.outputColorSpace=THREE.LinearSRGBColorSpace,renderer.sortObjects=!1,ui.kontainer.appendChild(renderer.domElement),!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float"))throw alert("OES_texture_float not supported"),"missing webgl extension";if(!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float_linear"))throw alert("OES_texture_float_linear not supported"),"missing webgl extension";scene=new THREE.Scene,x.camGrup=new THREE.Group,grups[0]=new THREE.Group,camera=new THREE.PerspectiveCamera(50,_.width/_.height,1,1e3),camera.position.set(0,_.ej[5],4),x.camGrup.add(camera),scene.add(new THREE.AmbientLight(10066329)),x.spotLcone=[],x.spotLight=[],x.spotLight[0]=new THREE.SpotLight(16777215,4e3,50,Math.PI/12,1),x.spotLight[0].position.set(0,14,-26),x.spotLight[0].shadow.camera.near=1,x.spotLight[0].shadow.camera.far=50,x.spotLight[0].shadow.camera.fov=40,scene.add(x.spotLight[0]),scene.add(x.camGrup),eL(window,1,"load",init),eL(window,0,"resize",onWindowResize),x.rotCam=!1,clock=new THREE.Clock,clock.autoStart=!1,_.mouse=new THREE.Vector2,_.entro=!0,_.idleTimer=0,_.fokus=!0,_.pointer=new THREE.Vector2,_.ptrDown=!1,x.currGrup=0,x.target0=new THREE.Object3D,scene.add(x.target0),addSkybox(),onWindowResize()}function addSkybox(){const e=".jpg",t=new THREE.CubeTextureLoader;t.setPath("img/skybox/2/"),t.load(["posx"+e,"negx"+e,"posy"+e,"negy"+e,"posz"+e,"negz"+e],(function(e){x.skybox=e,addBathroom()}))}function addBg(){const e=new THREE.SphereGeometry(10,8,4,0,Math.PI/1.5,Math.PI/4,Math.PI/2),t=new THREE.MeshBasicMaterial({color:16777215,side:1}),o=new THREE.Mesh(e,t);o.position.set(0,0,-3),o.rotation.y=Math.PI/-1.2,scene.add(o);(new THREE.TextureLoader).load("img/bg/bg1.jpg",(function(e){t.map=e,t.needsUpdate=!0}))}function addBathroom(){let e=0;x.bathroom=[],x.material=[];(new OBJLoader).load("obj/bathroom/1/bathroom1.obj",(function(t){t.traverse((function(t){t.isMesh&&(6!=e&&8!=e||(t.geometry=BufferGeometryUtils.toCreasedNormals(t.geometry,40/180*Math.PI)),t.geometry.computeBoundingBox(),e+=1)}));const o=[],a=[.1,.3,.2,.8,.1,.3,.25,.25,.25,.5,.5,.2,.1];for(let n=0;n<e;n++)o[n]=new THREE.MeshBasicMaterial({color:16777215}),1!=n&&5!=n?o[n].wireframe=!0:(o[n].transparent=!0,o[n].opacity=.5,1==n?o[n].color.setHex(12500670):o[n].color.setHex(8947848)),0!=n&&12!=n&&(o[n].reflectivity=a[n],o[n].envMapRotation.set(0,1.35,0),o[n].envMap=x.skybox),x.bathroom[n]=new THREE.Mesh(t.children[n].geometry,o[n]),x.bathroom[n].position.set(.5,0,1.5),x.bathroom[n].rotation.set(Math.PI/-2,0,0),grups[0].add(x.bathroom[n]);const n=new THREE.TextureLoader,r=(new THREE.TextureLoader,new THREE.TextureLoader),i=new THREE.TextureLoader,d=new THREE.TextureLoader,s=new THREE.TextureLoader,l=new THREE.TextureLoader,c=(new THREE.TextureLoader,new THREE.TextureLoader),m=new THREE.TextureLoader,u=new THREE.TextureLoader,p=new THREE.TextureLoader,h=new THREE.TextureLoader,w=new THREE.TextureLoader,f=new THREE.TextureLoader,E=new THREE.TextureLoader,g="obj/bathroom/1/mat/";n.load(g+"color0.jpg",(function(e){x.bathroom[0].material.map=e,x.bathroom[0].material.needsUpdate=!0,x.bathroom[0].material.wireframe=!1})),r.load(g+"color2.jpg",(function(e){x.bathroom[2].material.map=e,x.bathroom[2].material.needsUpdate=!0,x.bathroom[2].material.wireframe=!1})),i.load(g+"color3b.jpg",(function(e){x.bathroom[3].material.map=e,x.bathroom[3].material.needsUpdate=!0,x.bathroom[3].material.wireframe=!1})),d.load(g+"rough3b.jpg",(function(e){x.bathroom[3].material.specularMap=e,x.bathroom[3].material.needsUpdate=!0})),s.load(g+"color4b.jpg",(function(e){x.bathroom[4].material.map=e,x.bathroom[4].material.needsUpdate=!0,x.bathroom[4].material.wireframe=!1,scene.add(grups[0]),addBg()})),l.load(g+"rough4.jpg",(function(e){x.bathroom[4].material.specularMap=e,x.bathroom[4].material.needsUpdate=!0})),c.load(g+"color6b.jpg",(function(e){x.bathroom[6].material.map=e,x.bathroom[6].material.needsUpdate=!0,x.bathroom[6].material.wireframe=!1})),m.load(g+"rough6.jpg",(function(e){x.bathroom[6].material.specularMap=e,x.bathroom[6].material.needsUpdate=!0})),u.load(g+"color7.jpg",(function(e){x.bathroom[7].material.map=x.bathroom[7].material.specularMap=e,x.bathroom[7].material.needsUpdate=!0,x.bathroom[7].material.wireframe=!1})),p.load(g+"color8.jpg",(function(e){x.bathroom[8].material.map=e,x.bathroom[8].material.needsUpdate=!0,x.bathroom[8].material.wireframe=!1})),h.load(g+"color9.jpg",(function(e){x.bathroom[9].material.map=e,x.bathroom[9].material.needsUpdate=!0,x.bathroom[9].material.wireframe=!1})),w.load(g+"color10.jpg",(function(e){x.bathroom[10].material.map=e,x.bathroom[10].material.needsUpdate=!0,x.bathroom[10].material.wireframe=!1})),f.load(g+"color11.jpg",(function(e){x.bathroom[11].material.map=e,x.bathroom[11].material.needsUpdate=!0,x.bathroom[11].material.wireframe=!1})),E.load(g+"color12.jpg",(function(e){x.bathroom[12].material.map=e,x.bathroom[12].material.needsUpdate=!0,x.bathroom[12].material.wireframe=!1}));const b=new THREE.PlaneGeometry(5,6.2),T=new THREE.MeshBasicMaterial({color:16777215,side:THREE.BackSide});T.reflectivity=.02,T.envMapRotation.set(0,1.35,0),T.envMap=x.skybox;const y=new THREE.Mesh(b,T);y.position.set(1.62,.3,9.435),scene.add(y);const M=new THREE.PlaneGeometry(3.2,6.2),_=new THREE.MeshBasicMaterial({color:16777215,side:THREE.BackSide});_.wireframe=!0,_.reflectivity=.25,_.envMapRotation.set(0,1.35,0),_.envMap=x.skybox;const L=new THREE.Mesh(M,_);L.position.set(-2.48,.3,9.435),scene.add(L);const R=new THREE.TextureLoader,H=new THREE.TextureLoader;R.load(g+"wall1.jpg",(function(e){T.map=e,T.needsUpdate=!0,T.wireframe=!1})),H.load(g+"showerwall.jpg",(function(e){_.map=e,_.needsUpdate=!0,_.wireframe=!1})),addPlants(),addSwitches(),addFan(),addLamps(),addMirror()})),addDoor()}function addDoor(){let e=0;x.door=[];(new OBJLoader).load("obj/door/0/door.obj",(function(t){t.traverse((function(t){t.isMesh&&(t.geometry.computeBoundingBox(),e+=1)}));const o=t.children[0].geometry,a=new THREE.MeshStandardMaterial({color:16777215,roughness:.35,metalness:0});a.emissive.setHex(2236962),a.reflectivity=.23,a.envMapRotation.set(0,1.35,0),a.envMap=x.skybox;for(let e=0;e<1;e++)x.door[e]=new THREE.Mesh(o,a),x.door[e].scale.set(2.1,2.1,2.1),x.door[e].position.set(2.4,-.123,9.5),x.door[e].rotation.y=Math.PI/-2,grups[0].add(x.door[e]);(new THREE.TextureLoader).load("obj/door/0/mat/color1.jpg",(function(e){a.map=e,a.needsUpdate=!0}))}))}function addPlants(){let e=0;x.plant=[];(new OBJLoader).load("obj/plants/0/plants.obj",(function(t){t.traverse((function(t){t.isMesh&&(0==e&&(t.geometry=BufferGeometryUtils.toCreasedNormals(t.geometry,40/180*Math.PI)),t.geometry.computeBoundingBox(),e+=1)}));const o="obj/plants/0/mat/",a=[3.37,-3.37],n=t.children[0].geometry,r=new THREE.MeshStandardMaterial({color:16777215,roughness:.57,metalness:0});r.side=2,r.shadowSide=1,r.alphaTest=.6;for(let e=0;e<2;e++)x.plant[e]=new THREE.Mesh(n,r),x.plant[e].scale.set(1.1,1.1,1.1),x.plant[e].position.set(a[e],-1.4,-6.75),x.plant[e].rotation.y=Math.PI/-4,grups[0].add(x.plant[e]);const i=new THREE.TextureLoader,d=new THREE.TextureLoader;i.load(o+"color3.jpg",(function(e){r.map=e,r.needsUpdate=!0})),d.load(o+"alfa2.jpg",(function(e){r.alphaMap=e,r.needsUpdate=!0})),fadeScene()}))}function addSwitches(){let e=0;x.switch=[];(new OBJLoader).load("obj/socket/0/switch.obj",(function(t){t.traverse((function(t){t.isMesh&&(t.geometry.computeBoundingBox(),e+=1)}));const o=[.62,.52],a=[.62,.47],n=[.8,4],r=[.65,.65],i=[9.4,.147],d=t.children[0].geometry,s=new THREE.MeshStandardMaterial({color:16777215,roughness:.1,metalness:0});s.envMap=x.skybox,s.wireframe=!0;for(let e=0;e<2;e++)x.switch[e]=new THREE.Mesh(d,s),x.switch[e].material=s,x.switch[e].scale.set(o[e],o[e],a[e]),x.switch[e].position.set(n[e],r[e],i[e]),0==e&&(x.switch[e].rotation.y=Math.PI/-2),grups[0].add(x.switch[e]);(new THREE.TextureLoader).load("obj/socket/0/mat/color1.jpg",(function(e){s.map=e,s.needsUpdate=!0,s.wireframe=!1}))}))}function addFan(){let e=0;x.fan=[];(new OBJLoader).load("obj/fan/0/fan.obj",(function(t){t.traverse((function(t){t.isMesh&&(t.geometry.computeBoundingBox(),e+=1)}));const o="obj/fan/0/mat/",a=[4.165,-2.425],n=t.children[0].geometry,r=new THREE.MeshStandardMaterial({color:16777215,roughness:1,metalness:0});r.emissive.setHex(16777215),r.envMap=x.skybox,r.wireframe=!0;for(let e=0;e<2;e++)x.fan[e]=new THREE.Mesh(n,r),x.fan[e].scale.set(.1,.1,.1),x.fan[e].position.set(-2.4,3.35,a[e]),x.fan[e].rotation.y=Math.PI,grups[0].add(x.fan[e]);const i=new THREE.TextureLoader,d=new THREE.TextureLoader,s=new THREE.TextureLoader,l=new THREE.TextureLoader;i.load(o+"color1.jpg",(function(e){r.map=e,r.needsUpdate=!0,r.wireframe=!1})),d.load(o+"emissive1b.jpg",(function(e){r.emissiveMap=e,r.needsUpdate=!0})),s.load(o+"rough1.jpg",(function(e){r.roughnessMap=e,r.needsUpdate=!0})),l.load(o+"normal1.jpg",(function(e){r.normalScale.set(5,5,5),r.normalMap=e,r.needsUpdate=!0}))}))}function addLamps(){let e=0;x.lamp=[];(new OBJLoader).load("obj/lamp/3/lamp.obj",(function(t){t.traverse((function(t){t.isMesh&&(t.geometry.computeBoundingBox(),e+=1)}));const o="obj/lamp/3/mat/",a=[-2.4,-2.4,-2.4,2.37,2.37],n=[7.46,.87,-5.72,7.46,-5.72],r=t.children[0].geometry,i=new THREE.MeshStandardMaterial({color:16777215,roughness:.3,metalness:0});i.emissive.setHex(11447982),i.wireframe=!0;for(let e=0;e<5;e++)x.lamp[e]=new THREE.Mesh(r,i),x.lamp[e].scale.set(1.4,1.4,1.4),x.lamp[e].position.set(a[e],3.38,n[e]),x.lamp[e].rotation.x=Math.PI/-2,grups[0].add(x.lamp[e]);const d=new THREE.TextureLoader,s=new THREE.TextureLoader;d.load(o+"color1.jpg",(function(e){i.map=e,i.needsUpdate=!0,i.wireframe=!1})),s.load(o+"emissive1b.jpg",(function(e){i.emissiveMap=e,i.needsUpdate=!0}))}))}function addMirror(){const e=new THREE.PlaneGeometry(2.4,4.32);x.mirror=new Reflector(e,{clipBias:.003,textureWidth:_.width*window.devicePixelRatio,textureHeight:_.height*window.devicePixelRatio,color:11645875}),x.mirror.position.set(3.97,1.215,1.86),x.mirror.rotation.y=Math.PI/-2,grups[0].add(x.mirror)}function fadeScene(){onWindowResize(),function e(){let t=parseFloat(ui.fader.style.opacity);(t-=.05)<0?(ui.fader.style.opacity=0,ui.fader.style.display="none",ui.fader.parentNode.removeChild(ui.fader),onWindowResize(),eL(ui.kontainer,0,"pointerdown",onPointerDown),eL(ui.kontainer,0,"pointermove",onPointerMove),animate(),theOptions(),cL(ui.loadr,0,"paus"),ui.loadr.style.display="none",ui.loadr.parentNode.removeChild(ui.loadr)):(ui.fader.style.opacity=t,requestAnimationFrame(e))}()}function theOptions(){ui.swtchKam.style.visibility="visible",isMobil?(eL(ui.swtchKam,0,"touchstart",swtchKamClick),eL(ui.onAud,0,"touchstart",audClick),eL(ui.offAud,0,"touchstart",audClick)):(eL(ui.swtchKam,0,"click",swtchKamClick),eL(ui.onAud,0,"click",audClick),eL(ui.offAud,0,"click",audClick))}function swtchKamClick(e){e&&e.preventDefault(),x.rotCam=!x.rotCam,camera.rotation.x=x.camGrup.rotation.y=0,x.target0.position.set(0,0,0),camera.position.set(0,0,4),camera.lookAt(x.target0.position),_.idleTimer=0}function audClick(e){e&&e.preventDefault(),x.sound?x.sound.isPlaying?(cL(ui.offAud,0,"noneIt2"),cL(ui.onAud,1,"noneIt2"),x.sound.pause()):(cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2"),x.sound.play()):addAud(),_.idleTimer=0}function onPointerDown(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-e.clientY/_.height*2+1):(t.x=e.x/_.width*2-1,t.y=-e.y/_.height*2+1),_.ptrDown=!0,_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function onPointerMove(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-e.clientY/_.height*2+1):(t.x=e.x/_.width*2-1,t.y=-e.y/_.height*2+1),_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function wheelE(e){e&&e.preventDefault(),_.idleTimer=0}function onWindowResize(){_.width=window.innerWidth,_.height=window.innerHeight,isMobil&&(_.width==_.prevW&&(_.width=_.prevH,_.height=_.prevW),_.prevW=_.width,_.prevH=_.height),_.widthH=_.width/2,_.heightH=_.height/2,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",camera.aspect=_.width/_.height,camera.updateProjectionMatrix(),renderer.setSize(_.width,_.height),_.width>_.height?cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.022+"px":cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.028+"px",x.mirror&&x.mirror.getRenderTarget().setSize(_.width*window.devicePixelRatio,_.height*window.devicePixelRatio),_.idleTimer=0}function animate(){if(requestAnimationFrame(animate),_.idleTimer<idleTO){clock.running||clock.start();const e=1e-4*Date.now();clock.getDelta();if(x.rotCam){const t=2*e;x.target0.position.set(2.5*Math.cos(t+.1),.05*Math.sin(.8*t),4.8*Math.sin(t+.1)),camera.position.set(2.5*Math.cos(t),0,4.8*Math.sin(t))}else isMobil?(camera.rotation.x=Math.cos(2*e)*(Math.PI/24),x.camGrup.rotation.y=Math.sin(e)*Math.PI):(camera.rotation.x=_.pointer.y*(Math.PI/24),x.camGrup.rotation.y=_.pointer.x*-Math.PI);_.idleTimer+=.01,render()}else clock.running&&clock.stop(),x.sound&&x.sound.isPlaying&&x.sound.pause();document.hasFocus()?_.fokus||(_.idleTimer=0,_.fokus=!0,x.sound&&(x.sound.isPlaying||x.sound.play())):(_.idleTimer=idleTO,_.fokus=!1,x.sound&&x.sound.isPlaying&&x.sound.pause())}function render(){x.rotCam&&camera.lookAt(x.target0.position),renderer.render(scene,camera)}function addAud(){if(!x.sound){let e="bthrm";e+=".mp3";const t=new THREE.AudioListener;camera.add(t),x.sound=new THREE.Audio(t);(new THREE.AudioLoader).load("aud/"+e,(function(e){x.sound.setBuffer(e),x.sound.setLoop(!0),x.sound.setVolume(.9),x.sound.play(),cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2")}))}}	
	