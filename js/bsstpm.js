/**
 * author Armstrong "Army" Chiu
 * URL: https://thewebdesignerpro.com/     
 */
 
import*as e from"three";import a from"three/addons/capabilities/WebGL.js";import{OBJLoader as t}from"three/addons/loaders/OBJLoader.js";import{FBXLoader as o}from"three/addons/loaders/FBXLoader.js";let idleTO=120,florY=-10,ceilY=140,camera,scene,renderer,clock,grups=[],isMobil=!1,mouseX=0,mouseY=-50,mixer,ui={},_={},x={};if(a.isWebGL2Available())window.addEventListener?window.addEventListener("load",init,!1):window.attachEvent?window.attachEvent("onload",init):window.onload=init;else{let r=a.getWebGL2ErrorMessage();kontainer.appendChild(r),kontainer.style.background="url('img/busstopl.jpg') center top no-repeat",kontainer.style.backgroundSize="cover",fader.style.opacity=0,fader.style.display="none",fader.parentNode.removeChild(fader),cL(loadr,0,"paus"),loadr.style.display="none",loadr.parentNode.removeChild(loadr)}function eL(e,a,t,o){0==a?e.addEventListener(t,o,!1):e.removeEventListener(t,o,!1)}function cL(e,a,t){0==a?e.classList.contains(t)||e.classList.add(t):e.classList.contains(t)&&e.classList.remove(t)}function init(){function a(e){return document.getElementById(e)}ui.kontainer=a("kontainer"),ui.onAud=a("onAud"),ui.offAud=a("offAud"),ui.loadr=a("loadr"),ui.fader=a("fader"),ui.fader.style.opacity=1;let t=document.createElement("div");if(t.setAttribute("id","dummy"),document.body.appendChild(t),(isMobil="9000px"!=window.getComputedStyle(t,null).getPropertyValue("left"))&&(document.addEventListener("gesturechange",function(e){e.preventDefault()},!1),ui.kontainer.addEventListener("gesturechange",function(e){e.preventDefault()},!1),_.prevW=_.prevH=0),t.parentNode.removeChild(t),_.width=window.innerWidth,_.height=window.innerHeight,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",ui.kontainer.style.backgroundColor="#707476",_.ej=[],_.ej[0]=0,_.ej[1]=-2,_.ej[2]=Math.PI,_.ej[3]=0,_.ej[4]=0,_.ej[5]=0,x.xx=20,(renderer=new e.WebGLRenderer({antialias:!0,alpha:!1})).setPixelRatio(window.devicePixelRatio),renderer.setSize(_.width,_.height),renderer.setClearColor(7369846,1),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=e.PCFSoftShadowMap,renderer.outputColorSpace=e.LinearSRGBColorSpace,renderer.sortObjects=!1,ui.kontainer.appendChild(renderer.domElement),!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float"))throw alert("OES_texture_float not supported"),"missing webgl extension";if(!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float_linear"))throw alert("OES_texture_float_linear not supported"),"missing webgl extension";(scene=new e.Scene).fog=new e.FogExp2(7369846,.01),x.camGrup=new e.Group,grups[0]=new e.Group,(camera=new e.PerspectiveCamera(50,_.width/_.height,.5,1e4)).position.set(0,_.ej[5],50),x.camGrup.add(camera),scene.add(new e.AmbientLight(7829367)),x.spotLight=[],x.spotLight[0]=new e.SpotLight(16777215,1e5,250,Math.PI/10,1),x.spotLight[0].position.set(0,100,100),x.spotLight[0].castShadow=!0,x.spotLight[0].shadow.camera.near=1,x.spotLight[0].shadow.camera.far=250,x.spotLight[0].shadow.camera.fov=40,x.spotLight[0].shadow.intensity=.7,scene.add(x.spotLight[0]),x.spotLight[1]=new e.SpotLight(16772812,1500,28,Math.PI/5.8,1),x.spotLight[1].position.set(0,10.65,0),x.spotLight[1].castShadow=!0,x.spotLight[1].shadow.mapSize.width=64,x.spotLight[1].shadow.mapSize.height=64,x.spotLight[1].shadow.camera.near=1,x.spotLight[1].shadow.camera.far=28,x.spotLight[1].shadow.camera.fov=40,x.spotLight[1].shadow.intensity=.5,scene.add(x.spotLight[1]),scene.add(x.camGrup),eL(window,1,"load",init),eL(window,0,"resize",onWindowResize),(clock=new e.Clock).autoStart=!1,_.mouse=new e.Vector2,_.entro=!0,_.idleTimer=0,_.fokus=!0,_.pointer=new e.Vector2,_.ptrDown=!1,x.currGrup=0,x.targetO=new e.Object3D,x.targetO.position.set(0,0,x.camGrup.position.z+20),scene.add(x.targetO),x.spotLight[0].target=x.targetO,x.target1=new e.Object3D,x.target1.position.set(0,0,x.camGrup.position.z),scene.add(x.target1),x.spotLight[1].target=x.target1,addSkybox(),addClouds(),addGround(),addWall(),addSidewalk(),addTrash(),addHydrant(),addDrain(),addManhole(),onWindowResize()}function addSkybox(){let a=".png",t=new e.CubeTextureLoader;t.setPath("img/skybox/2/"),t.load(["posx"+a,"negx"+a,"posy"+a,"negy"+a,"posz"+a,"negz"+a],function(e){x.skybox=e,addFog()})}function addClouds(){let a=new e.SphereGeometry(4900,24,12,0,Math.PI),t=new e.MeshBasicMaterial({color:14738662,side:e.BackSide,fog:!1});t.transparent=!0;let o=new e.Mesh(a,t);o.rotation.set(-(Math.PI/2),0,-(Math.PI/2)),scene.add(o);let r=new e.TextureLoader,n=new e.TextureLoader;r.load("img/clouds1.jpg",function(e){o.material.map=e,o.material.needsUpdate=!0}),n.load("img/opac1.jpg",function(e){o.material.alphaMap=e,o.material.needsUpdate=!0})}function randMatrix(a){let t=new e.Vector3,o=new e.Euler,r=new e.Quaternion,n=new e.Vector3;return t.x=400*Math.random()-200,t.y=4*Math.random()+13,t.z=-30*Math.random()+25,o.z=2*Math.random()*Math.PI,r.setFromEuler(o),n.x=n.y=.1*Math.random()+1,a.compose(t,r,n)}function addFog(){let a=[];x.batchedMesh=[],x.material=[];let t=[];t[0]=new e.PlaneGeometry(40,40),t[1]=new e.PlaneGeometry(40,40),x.material[0]=new e.MeshBasicMaterial({color:9475222,transparent:!0,fog:!0}),x.material[1]=new e.MeshBasicMaterial({color:8422534,transparent:!0,fog:!0}),x.material[0].depthWrite=x.material[1].depthWrite=!1,x.material[0].opacity=x.material[1].opacity=.9;for(let o=0;o<2;o++){let r=t[o].attributes.position.array.length;x.batchedMesh[o]=new e.BatchedMesh(150,r,2*r,x.material[o]),x.batchedMesh[o].frustumCulled=!0;let n=x.batchedMesh[o].addGeometry(t[o]);a[o]=new e.Matrix4;for(let i=0;i<150;i++){let d=x.batchedMesh[o].addInstance(n);x.batchedMesh[o].setMatrixAt(d,randMatrix(a[o]))}x.batchedMesh[o].position.x=200,grups[0].add(x.batchedMesh[o])}new e.TextureLoader().load("img/ulap5.png",function(e){x.material[0].map=x.material[1].map=e,x.material[0].alphaMap=x.material[1].alphaMap=e,x.material[0].needsUpdate=x.material[1].needsUpdate=!0,addBusStop()})}function addBusStop(){let a=0;x.busstop=[];let o=new t;o.load("obj/busstop/1/busstop.obj",function(t){t.traverse(function(e){e.isMesh&&(e.geometry.computeBoundingBox(),a+=1)});let o=[],r=[];r[0]=r[2]=16777215,r[1]=12303291;for(let n=0;n<a;n++)o[n]=new e.MeshStandardMaterial({color:16777215,roughness:1,metalness:.7}),o[n].transparent=!0,o[n].envMap=x.skybox,o[n].envMapIntensity=.5,x.busstop[n]=new e.Mesh(t.children[n].geometry,o[n]),x.busstop[n].castShadow=!0,x.busstop[n].receiveShadow=!0,x.busstop[n].position.set(-1.79,1.5,0),x.busstop[n].rotation.set(-(Math.PI/2.12),0,0),x.busstop[n].scale.set(4,2.4,1),grups[0].add(x.busstop[n]);let i=new e.PlaneGeometry(9.3,16.5),d=new e.MeshStandardMaterial({color:15066597,roughness:.15,metalness:.1,transparent:!0,opacity:.7});d.envMap=x.skybox,d.envMapIntensity=.88;let s=new e.Mesh(i,d);s.position.set(-16.3,1.885,-1.7),s.rotation.y=-(Math.PI/2),s.receiveShadow=!0,grups[0].add(s);let l=new e.PlaneGeometry(32.4,16.5),p=new e.Mesh(l,d);p.position.set(.06,1.885,-6.75),p.rotation.y=Math.PI,grups[0].add(p);let $=new e.PlaneGeometry(6,6),u=new e.MeshBasicMaterial({color:16774356,transparent:!0,fog:!1,depthWrite:!1});x.spot=new e.Mesh($,u),x.spot.position.set(0,10.7,0),x.spot.rotation.x=Math.PI/2,grups[0].add(x.spot);let m=new e.TextureLoader,h=new e.TextureLoader,w=new e.TextureLoader,c=new e.TextureLoader,g=new e.TextureLoader,f=new e.TextureLoader,b=new e.TextureLoader;m.load("obj/busstop/1/mat/color2.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.busstop[0].material.map=a,x.busstop[0].material.needsUpdate=!0}),h.load("obj/busstop/1/mat/rough4.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.busstop[0].material.roughnessMap=a,x.busstop[0].material.needsUpdate=!0}),w.load("obj/busstop/1/mat/normal2.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.busstop[0].material.normalMap=a,x.busstop[0].material.needsUpdate=!0}),c.load("obj/busstop/1/mat/metal3.jpg",function(e){x.busstop[0].material.metalnessMap=e,x.busstop[0].material.needsUpdate=!0}),g.load("obj/busstop/1/mat/alpha3.jpg",function(e){x.busstop[0].material.alphaMap=e,x.busstop[0].material.needsUpdate=!0}),f.load("obj/busstop/1/mat/light1.jpg",function(e){x.busstop[0].material.lightMapIntensity=1,x.busstop[0].material.lightMap=e,x.busstop[0].material.needsUpdate=!0}),b.load("img/spotL1.jpg",function(e){x.spot.material.map=x.spot.material.alphaMap=e,x.spot.material.needsUpdate=!0}),addTrees()}),scene.add(grups[0])}function addGround(){x.floor=[],x.floorShadow=[];let a=new e.PlaneGeometry(350,175),t=new e.PlaneGeometry(350,175),o=new e.MeshStandardMaterial({color:12632256,roughness:.82,metalness:.5,transparent:!0}),r=new e.ShadowMaterial({color:0,transparent:!0,opacity:.75});for(let n=0;n<1;n++)x.floor[n]=new e.Mesh(a,o),x.floorShadow[n]=new e.Mesh(t,r),x.floor[n].position.set(0,-10,99.8),x.floorShadow[n].position.set(0,-9.9,99.8),x.floor[n].rotation.x=-.5*Math.PI,x.floor[n].rotation.z=Math.PI,x.floorShadow[n].rotation.x=-.5*Math.PI,x.floorShadow[n].receiveShadow=!0,grups[0].add(x.floor[n]),grups[0].add(x.floorShadow[n]);var i=new e.TextureLoader,d=new e.TextureLoader,s=new e.TextureLoader,l=new e.TextureLoader,p=new e.TextureLoader;i.load("img/asphalt/1/color1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(8,4);for(let t=0;t<1;t++)x.floor[t].material.map=a,x.floor[t].material.needsUpdate=!0}),d.load("img/asphalt/1/rough1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(8,4),x.floor[0].material.roughnessMap=a,x.floor[0].material.needsUpdate=!0}),s.load("img/asphalt/1/normal1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(8,4);for(let t=0;t<1;t++)x.floor[t].material.normalMap=a,x.floor[t].material.needsUpdate=!0}),l.load("img/asphalt/1/metal1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(8,4),x.floor[0].material.metalnessMap=a,x.floor[0].material.needsUpdate=!0}),p.load("img/opactop.png",function(a){a.wrapS=a.wrapT=e.MirroredRepeatWrapping,a.repeat.set(1,2),a.flipY=!1,x.floor[0].material.alphaMap=a,x.floor[0].material.needsUpdate=!0})}function addWall(){x.wall=[],x.wallShadow=[];let a=new e.PlaneGeometry(350,28),t=new e.PlaneGeometry(350,4),o=new e.PlaneGeometry(350,28),r=new e.MeshStandardMaterial({color:14869218,roughness:.75,metalness:0,transparent:!0}),n=new e.MeshStandardMaterial({color:14869218,roughness:1,metalness:.2}),i=new e.ShadowMaterial({color:0,transparent:!0,opacity:.75});for(let d=0;d<1;d++)x.wall[d]=new e.Mesh(a,r),x.wallShadow[d]=new e.Mesh(o,i),x.wall[d].position.set(0,5.4,-21),x.wallShadow[d].position.set(0,5.4,-20.9),x.wallShadow[d].receiveShadow=!0,grups[0].add(x.wall[d]),grups[0].add(x.wallShadow[d]);x.wall[1]=new e.Mesh(t,n),x.wall[1].position.set(0,18.5,-23),x.wall[1].rotation.x=-.5*Math.PI,grups[0].add(x.wall[1]);var s=new e.TextureLoader,l=new e.TextureLoader,p=new e.TextureLoader,$=new e.TextureLoader;s.load("img/wall/1/color1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(11.67,1);for(let t=0;t<1;t++)x.wall[t].material.map=a,x.wall[t].material.needsUpdate=!0}),l.load("img/wall/1/rough1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(11.67,1),x.wall[0].material.roughnessMap=a,x.wall[0].material.needsUpdate=!0}),p.load("img/wall/1/normal1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(11.67,1);for(let t=0;t<1;t++)x.wall[t].material.normalScale.set(5,5),x.wall[t].material.normalMap=a,x.wall[t].material.needsUpdate=!0}),$.load("img/opactop.png",function(a){a.wrapS=a.wrapT=e.MirroredRepeatWrapping,a.repeat.set(11.67/3.7,.96),x.wall[0].material.alphaMap=a,x.wall[0].material.needsUpdate=!0})}function addSidewalk(){x.sidewalk=[],x.sidewalkShadow=[];let a=[],t=[],o=[],r=[],n=[12,.3,2.46,30],i=[10526880,10066329,10526880,9803157],d=[-.5*Math.PI,-.25*Math.PI,0,-.5*Math.PI],s=[-8.6,-8.67,-10,-8.62],l=[10,16.08,16.19,-11],p=[.6,.58,.6,.77];for(let $=0;$<4;$++)a[$]=new e.PlaneGeometry(350,n[$]),t[$]=new e.PlaneGeometry(350,n[$]),o[$]=new e.MeshStandardMaterial({color:i[$],roughness:p[$],metalness:0}),r[$]=new e.ShadowMaterial({color:0,transparent:!0,opacity:.75}),x.sidewalk[$]=new e.Mesh(a[$],o[$]),x.sidewalkShadow[$]=new e.Mesh(t[$],r[$]),x.sidewalk[$].position.set(0,s[$]-.1,l[$]+.1),x.sidewalkShadow[$].position.set(0,s[$],l[$]+.1),x.sidewalk[$].rotation.x=d[$],x.sidewalkShadow[$].rotation.x=d[$],0==$&&(x.sidewalk[$].castShadow=!0),x.sidewalkShadow[$].receiveShadow=!0,0==$&&(x.sidewalk[$].rotation.z=Math.PI),grups[0].add(x.sidewalk[$]),grups[0].add(x.sidewalkShadow[$]);var u=new e.TextureLoader,m=new e.TextureLoader,h=new e.TextureLoader,w=new e.TextureLoader,c=new e.TextureLoader,g=new e.TextureLoader;u.load("img/asphalt/2/color1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(29.17,1),x.sidewalk[0].material.map=x.sidewalk[3].material.map=a,x.sidewalk[0].material.needsUpdate=x.sidewalk[3].material.needsUpdate=!0}),m.load("img/asphalt/2/rough0.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(29.17,1),x.sidewalk[0].material.roughnessMap=x.sidewalk[3].material.roughnessMap=a,x.sidewalk[0].material.needsUpdate=x.sidewalk[3].material.needsUpdate=!0}),h.load("img/asphalt/2/normal1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(29.17,1),x.sidewalk[0].material.normalMap=x.sidewalk[3].material.normalMap=a,x.sidewalk[0].material.needsUpdate=x.sidewalk[3].material.needsUpdate=!0}),w.load("img/asphalt/2/yellow1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(14.25,1),x.sidewalk[1].material.map=x.sidewalk[2].material.map=a,x.sidewalk[1].material.needsUpdate=x.sidewalk[2].material.needsUpdate=!0}),c.load("img/asphalt/2/rough12.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(14.25,1),x.sidewalk[1].material.roughnessMap=x.sidewalk[2].material.roughnessMap=a,x.sidewalk[1].material.needsUpdate=x.sidewalk[2].material.needsUpdate=!0}),g.load("img/asphalt/2/normal12.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,a.repeat.set(14.25,1),x.sidewalk[1].material.normalMap=x.sidewalk[2].material.normalMap=a,x.sidewalk[1].material.needsUpdate=x.sidewalk[2].material.needsUpdate=!0})}function addTrash(){let a=0;x.trash=[];let o=new t;o.load("obj/trash/2/trash.obj",function(t){t.traverse(function(e){e.isMesh&&(e.geometry.computeBoundingBox(),a+=1)});let o=[],r=[];r[0]=r[2]=16777215,r[1]=12303291;for(let n=0;n<a;n++)o[n]=new e.MeshStandardMaterial({color:13421772,roughness:.8,metalness:.65}),o[n].envMap=x.skybox,o[n].envMapIntensity=1,x.trash[n]=new e.Mesh(t.children[n].geometry,o[n]),x.trash[n].castShadow=!0,x.trash[n].receiveShadow=!0,x.trash[n].position.set(-28,-8.5,-1),x.trash[n].scale.set(.25,.25,.25),grups[0].add(x.trash[n]);let i=new e.TextureLoader,d=new e.TextureLoader,s=new e.TextureLoader,l=new e.TextureLoader;new e.TextureLoader,new e.TextureLoader,i.load("obj/trash/2/mat/color2.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.trash[0].material.map=a,x.trash[0].material.needsUpdate=!0}),d.load("obj/trash/2/mat/rough2.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.trash[0].material.roughnessMap=a,x.trash[0].material.needsUpdate=!0}),s.load("obj/trash/2/mat/normal2.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.trash[0].material.normalScale.set(2,2),x.trash[0].material.normalMap=a,x.trash[0].material.needsUpdate=!0}),l.load("obj/trash/2/mat/metal2.jpg",function(e){x.trash[0].material.metalnessMap=e,x.trash[0].material.needsUpdate=!0})})}function addHydrant(){let a=0;x.hydrant=[];let o=new t;o.load("obj/hydrant/1/hydrant.obj",function(t){t.traverse(function(e){e.isMesh&&(e.geometry.computeBoundingBox(),a+=1)});let o=[],r=[];r[0]=r[2]=16777215,r[1]=12303291;for(let n=0;n<a;n++)o[n]=new e.MeshStandardMaterial({color:13948116,roughness:.8,metalness:.2}),o[n].envMap=x.skybox,o[n].envMapIntensity=1,x.hydrant[n]=new e.Mesh(t.children[n].geometry,o[n]),x.hydrant[n].castShadow=!0,x.hydrant[n].receiveShadow=!0,x.hydrant[n].position.set(28,-5.44,-.64),x.hydrant[n].rotation.set(0,-(Math.PI/2),0),x.hydrant[n].scale.set(2.64,2.64,2.64),grups[0].add(x.hydrant[n]);let i=new e.TextureLoader,d=new e.TextureLoader,s=new e.TextureLoader,l=new e.TextureLoader;new e.TextureLoader,new e.TextureLoader,i.load("obj/hydrant/1/mat/color2.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.hydrant[0].material.map=a,x.hydrant[0].material.needsUpdate=!0}),d.load("obj/hydrant/1/mat/rough1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.hydrant[0].material.roughnessMap=a,x.hydrant[0].material.needsUpdate=!0}),s.load("obj/hydrant/1/mat/normal1.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.hydrant[0].material.normalScale.set(1.4,1.4),x.hydrant[0].material.normalMap=a,x.hydrant[0].material.needsUpdate=!0}),l.load("obj/hydrant/1/mat/metal1.jpg",function(e){x.hydrant[0].material.metalnessMap=e,x.hydrant[0].material.needsUpdate=!0})})}function addDrain(){let a=0;x.drain=[];let o=new t;o.load("obj/drain/1/drain.obj",function(t){t.traverse(function(e){e.isMesh&&(e.geometry.computeBoundingBox(),a+=1)});let o=[],r=[];r[0]=r[2]=16777215,r[1]=12303291;for(let n=0;n<a;n++)o[n]=new e.MeshStandardMaterial({color:13421772,roughness:1,metalness:.6}),o[n].envMap=x.skybox,o[n].envMapIntensity=.7,x.drain[n]=new e.Mesh(t.children[n].geometry,o[n]),x.drain[n].castShadow=!0,x.drain[n].receiveShadow=!0,x.drain[n].position.set(13,-9.92,18.4),x.drain[n].rotation.set(-.02,0,0),x.drain[n].scale.set(.35,.35,.35),grups[0].add(x.drain[n]);let i=new e.PlaneGeometry(3.94,3.08),d=new e.MeshBasicMaterial({color:3355443}),s=new e.Mesh(i,d);s.position.set(13,-9.98,18.4),s.rotation.x=-(Math.PI/2)-.02,grups[0].add(s);let l=new e.TextureLoader,p=new e.TextureLoader,$=new e.TextureLoader,u=new e.TextureLoader;new e.TextureLoader,new e.TextureLoader,l.load("obj/drain/1/mat/color2.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.drain[0].material.map=a,x.drain[0].material.needsUpdate=!0}),p.load("obj/drain/1/mat/rough2.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.drain[0].material.roughnessMap=a,x.drain[0].material.needsUpdate=!0}),$.load("obj/drain/1/mat/normal2.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.drain[0].material.normalMap=a,x.drain[0].material.needsUpdate=!0}),u.load("obj/drain/1/mat/metal2.jpg",function(e){x.drain[0].material.metalnessMap=e,x.drain[0].material.needsUpdate=!0})})}function addManhole(){let a=0;x.manhole=[];let o=new t;o.load("obj/manhole/1/manhole.obj",function(t){t.traverse(function(e){e.isMesh&&(e.geometry.computeBoundingBox(),a+=1)});let o=[],r=[];r[0]=r[2]=16777215,r[1]=12303291;for(let n=0;n<a;n++)o[n]=new e.MeshStandardMaterial({color:11184810,roughness:.6,metalness:.7}),o[n].envMap=x.skybox,o[n].envMapIntensity=.7,x.manhole[n]=new e.Mesh(t.children[n].geometry,o[n]),x.manhole[n].castShadow=!0,x.manhole[n].receiveShadow=!0,x.manhole[n].position.set(-10,-10.05,32),x.manhole[n].scale.set(4,4,4),grups[0].add(x.manhole[n]);let i=new e.TextureLoader,d=new e.TextureLoader,s=new e.TextureLoader,l=new e.TextureLoader;new e.TextureLoader,new e.TextureLoader,i.load("obj/manhole/1/mat/color2.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.manhole[0].material.map=a,x.manhole[0].material.needsUpdate=!0}),d.load("obj/manhole/1/mat/rough2.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.manhole[0].material.roughnessMap=a,x.manhole[0].material.needsUpdate=!0}),s.load("obj/manhole/1/mat/normal2.jpg",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.manhole[0].material.normalMap=a,x.manhole[0].material.needsUpdate=!0}),l.load("obj/manhole/1/mat/metal2.jpg",function(e){x.manhole[0].material.metalnessMap=e,x.manhole[0].material.needsUpdate=!0})})}function randomizeMatrix(a,t,o){let r=new e.Vector3,n=new e.Euler,i=new e.Quaternion,d=new e.Vector3;return r.x=[-35,-105,-175,35,105,175][o],r.y=-7.5,r.z=-5*Math.random()-40,n.x=-(Math.PI/2),n.y=0,n.z=2*Math.random()*Math.PI,i.setFromEuler(n),d.x=d.y=d.z=t+.005*Math.random(),a.compose(r,i,d)}function addTrees(){x.trees=[],x.materials2=[];let a=new t;a.load("obj/trees/2/tree1.obj",function(a){a.traverse(function(e){e.isMesh&&(e.geometry.computeVertexNormals(),e.geometry.computeBoundingBox())}),x.materials2[0]=new e.MeshStandardMaterial({color:16777215,roughness:.5,metalness:0,transparent:!0}),x.materials2[0].depthWrite=!1,x.materials2[0].side=e.DoubleSide;let t=a.children[0].geometry.attributes.position.array.length;x.trees=new e.BatchedMesh(6,t,2*t,x.materials2[0]),x.trees.frustumCulled=!0,x.trees.receiveShadow=!0;let o=x.trees.addGeometry(a.children[0].geometry),r=new e.Matrix4;for(let n=0;n<6;n++){let i=x.trees.addInstance(o);r=randomizeMatrix(r,.06,n),x.trees.setMatrixAt(i,r)}grups[0].add(x.trees);let d=new e.TextureLoader,s=(new e.TextureLoader,new e.TextureLoader);new e.TextureLoader,d.load("obj/trees/2/mat/color1.png",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.materials2[0].map=a,x.materials2[0].needsUpdate=!0}),s.load("obj/trees/2/mat/alpha1.png",function(a){a.wrapS=a.wrapT=e.RepeatWrapping,x.materials2[0].alphaMap=a,x.materials2[0].needsUpdate=!0}),animFBX()})}function fadeScene(){onWindowResize(),function e(){let a=parseFloat(ui.fader.style.opacity);(a-=.05)<0?(ui.fader.style.opacity=0,ui.fader.style.display="none",ui.fader.parentNode.removeChild(ui.fader),onWindowResize(),eL(ui.kontainer,0,"pointerdown",onPointerDown),eL(ui.kontainer,0,"pointermove",onPointerMove),animate(),theOptions(),cL(ui.loadr,0,"paus"),ui.loadr.style.display="none",ui.loadr.parentNode.removeChild(ui.loadr)):(ui.fader.style.opacity=a,requestAnimationFrame(e))}()}function theOptions(){isMobil?(eL(ui.onAud,0,"touchstart",audClick),eL(ui.offAud,0,"touchstart",audClick)):(eL(ui.onAud,0,"click",audClick),eL(ui.offAud,0,"click",audClick))}function audClick(e){e&&e.preventDefault(),x.sound?x.sound.isPlaying?(cL(ui.offAud,0,"noneIt2"),cL(ui.onAud,1,"noneIt2"),x.sound.pause()):(cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2"),x.sound.play()):addAud(),_.idleTimer=0}function onPointerDown(e){e&&e.preventDefault();let a={};e.clientX?(a.x=e.clientX/_.width*2-1,a.y=-(2*(e.clientY/_.height))+1):(a.x=e.x/_.width*2-1,a.y=-(2*(e.y/_.height))+1),_.ptrDown=!0,_.pointer.x=a.x,_.pointer.y=a.y,_.idleTimer=0}function onPointerMove(e){e&&e.preventDefault();let a={};e.clientX?(a.x=e.clientX/_.width*2-1,a.y=-(2*(e.clientY/_.height))+1):(a.x=e.x/_.width*2-1,a.y=-(2*(e.y/_.height))+1),_.pointer.x=a.x,_.pointer.y=a.y,_.idleTimer=0}function wheelE(e){e&&e.preventDefault(),_.idleTimer=0}function onWindowResize(){_.width=window.innerWidth,_.height=window.innerHeight,isMobil&&(_.width==_.prevW&&(_.width=_.prevH,_.height=_.prevW),_.prevW=_.width,_.prevH=_.height),_.widthH=_.width/2,_.heightH=_.height/2,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",camera.aspect=_.width/_.height,camera.updateProjectionMatrix(),renderer.setSize(_.width,_.height),x.xx=20,_.width>_.height?cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.022+"px":(cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.028+"px",isMobil&&(x.xx=40)),_.idleTimer=0}function animFog(){let e=x.batchedMesh[0].position.x,a=x.batchedMesh[1].position.x;e>-300?x.batchedMesh[0].position.x-=.1:x.batchedMesh[0].position.x=300,a>-300?x.batchedMesh[1].position.x-=.15:x.batchedMesh[1].position.x=300}function animate(){if(requestAnimationFrame(animate),_.idleTimer<120){clock.running||clock.start();let e=24e-5*Date.now(),a=.5*clock.getDelta();if(mixer.update(a),isMobil){let t=Math.sin(e);camera.position.x=t*x.xx;let o=19*t;camera.position.y=o>-6?o:-6,camera.rotation.x=-.3*t,x.camGrup.rotation.y=.3*Math.cos(e)}else{camera.position.x=_.pointer.x*x.xx;let r=19*_.pointer.y;camera.position.y=r>-6?r:-6,camera.rotation.x=-.3*_.pointer.y,x.camGrup.rotation.y=.2*Math.cos(e)}camera.position.z=1.7*camera.position.y+43,animFog(),x.trees.rotation.y=.02*Math.cos(1.3*e),x.trees.rotation.z=.014*Math.sin(e),_.idleTimer+=.01,render()}else clock.running&&clock.stop(),x.sound&&x.sound.isPlaying&&x.sound.pause();document.hasFocus()?_.fokus||(_.idleTimer=0,_.fokus=!0,x.sound&&!x.sound.isPlaying&&x.sound.play()):(_.idleTimer=120,_.fokus=!1,x.sound&&x.sound.isPlaying&&x.sound.pause())}function render(){camera.lookAt(x.target1.position),renderer.render(scene,camera)}function animFBX(){let a="teenb1/char1";a+=".fbx";let t=new o;t.load("obj/"+a,function(a){a.traverse(function(e){e.isMesh&&(e.geometry.computeBoundingBox(),e.castShadow=!0,e.receiveShadow=!0,("Hatsmesh"==e.geometry.name||"Shoesmesh"==e.geometry.name)&&(e.frustumCulled=!1))}),x.char1=a;let t=[],o="obj/teenb1/mat/";for(let r=0;r<7;r++)t[r]=new e.MeshStandardMaterial({color:16777215,roughness:.75,metalness:0}),x.char1.children[r].material=t[r];t[1].transparent=!0,t[1].opacity=0;let n=new e.TextureLoader,i=new e.TextureLoader,d=new e.TextureLoader,s=new e.TextureLoader,l=new e.TextureLoader;new e.TextureLoader;let p=new e.TextureLoader,$=new e.TextureLoader,u=new e.TextureLoader,m=new e.TextureLoader,h=new e.TextureLoader;new e.TextureLoader,n.load(o+"bottomd.jpg",function(e){t[2].map=e,t[2].needsUpdate=!0}),i.load(o+"bodyd.jpg",function(e){t[0].map=t[3].map=e,t[0].needsUpdate=t[3].needsUpdate=!0}),d.load(o+"hatd.jpg",function(e){t[4].map=e,t[4].needsUpdate=!0}),s.load(o+"shoesd.jpg",function(e){t[5].map=e,t[5].needsUpdate=!0}),l.load(o+"topd.jpg",function(e){t[6].map=e,t[6].needsUpdate=!0}),p.load(o+"bottomn.jpg",function(e){t[2].normalMap=e,t[2].needsUpdate=!0}),$.load(o+"bodyn.jpg",function(e){t[3].normalMap=e,t[3].needsUpdate=!0}),u.load(o+"hatn.jpg",function(e){t[4].normalMap=e,t[4].needsUpdate=!0}),m.load(o+"shoesn.jpg",function(e){t[5].roughness=.4,t[5].normalMap=e,t[5].needsUpdate=!0}),h.load(o+"topn.jpg",function(e){t[6].normalMap=e,t[6].needsUpdate=!0}),x.char1.scale.set(.1,.1,.1),x.char1.position.set(0,-8.48,-.8),grups[0].add(x.char1),anim8()})}function anim8(){x.actions=[];let a="teenb1/Sitting";a+=".fbx";let t=new o;t.load("obj/"+a,function(a){mixer=new e.AnimationMixer(x.char1),x.actions[0]=mixer.clipAction(a.animations[0]),x.actions[0].play(),fadeScene()})}function addAud(){if(!x.sound){let a="bsstp";a+=".mp3";let t=new e.AudioListener;camera.add(t),x.sound=new e.Audio(t);let o=new e.AudioLoader;o.load("aud/"+a,function(e){x.sound.setBuffer(e),x.sound.setLoop(!0),x.sound.setVolume(.9),x.sound.play(),cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2")})}} 

	