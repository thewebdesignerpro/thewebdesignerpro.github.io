/**
 * author Armstrong "Army" Chiu
 * URL: https://thewebdesignerpro.com/     
 */
 
import*as e from"three";import t from"three/addons/capabilities/WebGL.js";import{OBJLoader as i}from"three/addons/loaders/OBJLoader.js";let idleTO=120,florY=0,ceilY=140,camera,scene,renderer,clock,grups=[],isMobil=!1,mouseX=0,mouseY=-50,mixer,ui={},win={},x={};if(!1===t.isWebGLAvailable()){let n=t.getWebGLErrorMessage();document.body.appendChild(n)}else window.addEventListener?window.addEventListener("load",init,!1):window.attachEvent?window.attachEvent("onload",init):window.onload=init;function init(){ui.kontainer=document.getElementById("kontainer");let t=document.createElement("div");if(t.setAttribute("id","dummy"),document.body.appendChild(t),(isMobil="9000px"!=window.getComputedStyle(t,null).getPropertyValue("left"))&&(document.addEventListener("gesturechange",function(e){e.preventDefault()},!1),ui.kontainer.addEventListener("gesturechange",function(e){e.preventDefault()},!1)),t.parentNode.removeChild(t),win.width=window.innerWidth,win.height=window.innerHeight,document.body.style.width=win.width+"px",document.body.style.height=win.height+"px",ui.kontainer.style.width=win.width+"px",ui.kontainer.style.height=win.height+"px",ui.kontainer.style.opacity=0,ui.kontainer.style.backgroundColor="#b836cc",ui.kontainer.style.opacity=0,win.cr=[],win.ej=[],win.ej[0]=!1,win.ej[1]=.1,win.ej[2]=.005,(renderer=new e.WebGLRenderer({antialias:!0,alpha:!1})).setPixelRatio(window.devicePixelRatio),renderer.setSize(win.width,win.height),renderer.setClearColor(12072652,1),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=e.PCFSoftShadowMap,renderer.outputColorSpace=e.SRGBColorSpace,renderer.sortObjects=!1,ui.kontainer.appendChild(renderer.domElement),!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float"))throw alert("OES_texture_float not supported"),"missing webgl extension";if(!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float_linear"))throw alert("OES_texture_float_linear not supported"),"missing webgl extension";(scene=new e.Scene).fog=new e.FogExp2(12072652,.0037),(camera=new e.PerspectiveCamera(50,win.width/win.height,1,3e4)).position.set(0,20,140),scene.add(new e.AmbientLight(3158064)),x.spotLight=[],x.spotLight[0]=new e.SpotLight(16715969,8e6,5e3,Math.PI/2.7,1),x.spotLight[0].position.set(750,400,0),x.spotLight[0].castShadow=!0,x.spotLight[0].shadow.mapSize.width=512,x.spotLight[0].shadow.mapSize.height=512,x.spotLight[0].shadow.focus=.1,scene.add(x.spotLight[0]),x.spotLight[1]=new e.SpotLight(1166540,4e6,5e3,Math.PI/5,1),x.spotLight[1].position.set(-750,200,0),scene.add(x.spotLight[1]),x.spotLight[0].shadow.camera.near=x.spotLight[1].shadow.camera.near=1,x.spotLight[0].shadow.camera.far=x.spotLight[1].shadow.camera.far=800,onWindowResize(),window.removeEventListener("load",init,!1),window.addEventListener("resize",onWindowResize,!1),(clock=new e.Clock).autoStart=!1,grups[0]=new e.Group,grups[1]=new e.Group,addSky(),addHouse(),addCar(),win.mouse=new e.Vector2,win.entro=!0,win.idleTimer=0,win.fokus=!0,win.pointer=new e.Vector2}function entro(){ui.tempDiv=document.createElement("div"),ui.tempDiv.setAttribute("id","noAud"),ui.tempDiv.innerHTML="ENTER",ui.tempDiv.style.display="block",ui.tempDiv.style.position="absolute",ui.tempDiv.style.margin="auto",ui.tempDiv.style.top="40%",ui.tempDiv.style.bottom=ui.tempDiv.style.left=ui.tempDiv.style.right="0",ui.tempDiv.style.width="160px",ui.tempDiv.style.height="48px",ui.tempDiv.style.lineHeight="48px",ui.tempDiv.style.fontFamily="sans-serif",ui.tempDiv.style.fontSize="24px",ui.tempDiv.style.textAlign="center",ui.tempDiv.style.color="rgba(255, 255, 255, 0.5)",ui.tempDiv.style.backgroundColor="rgba(255, 255, 255, 0.15)",ui.tempDiv.style.border="2px solid rgba(255, 255, 255, 0.5)",ui.tempDiv.style.cursor="pointer",ui.kontainer.appendChild(ui.tempDiv)}function theOptions(){ui.swtchKam=document.getElementById("swtchKam"),ui.onAud=document.getElementById("onAud"),ui.offAud=document.getElementById("offAud"),isMobil?(ui.swtchKam.addEventListener("touchstart",swtchKamClick,!1),ui.onAud.addEventListener("touchstart",audClick,!1),ui.offAud.addEventListener("touchstart",audClick,!1)):(ui.swtchKam.addEventListener("click",swtchKamClick,!1),ui.onAud.addEventListener("click",audClick,!1),ui.offAud.addEventListener("click",audClick,!1))}function swtchKamClick(e){e.preventDefault(),camera.position.set(0,20,140),grups[1].rotation.y=0,win.ej[0]?win.ej[0]=!1:win.ej[0]=!0,win.idleTimer=0}function audClick(e){e.preventDefault(),x.sound?x.sound.isPlaying?(ui.offAud.classList.add("noneIt2"),ui.onAud.classList.remove("noneIt2"),x.sound.pause()):(ui.onAud.classList.add("noneIt2"),ui.offAud.classList.remove("noneIt2"),x.sound.play()):addAud(),win.idleTimer=0}function addSky(){let t=new e.CubeTextureLoader;t.setPath("img/vaporwave/map/test2/"),x.skybox=t.load(["posx.png","negx.png","posy.png","negy.png","posz.png","negz.png"]),scene.background=x.skybox,addFloor()}function addFloor(){x.floor=[],x.floorShadow=[];let t=new e.PlaneGeometry(1e4,1e4),i=new e.PlaneGeometry(1e3,1e3),n=new e.MeshLambertMaterial({color:15658734,transparent:!0,opacity:.44}),o=new e.ShadowMaterial({color:1118481,transparent:!0,opacity:.2});for(let a=0;a<1;a++)x.floor[a]=new e.Mesh(t,n),x.floorShadow[a]=new e.Mesh(i,o),x.floor[a].position.set(0,-.1,0),x.floorShadow[a].position.set(0,0,0),x.floor[a].rotation.x=-.5*Math.PI,x.floorShadow[a].rotation.x=-.5*Math.PI,x.floorShadow[a].receiveShadow=!0,scene.add(x.floor[a]),scene.add(x.floorShadow[a]);grups[1].add(camera),grups[1].position.z=0}function addHouse(){let t=0,n=[],o=[16777215,15658734,16777215],a=new i;a.load("obj/vaporw/house1.obj",function(i){i.traverse(function(e){e.isMesh&&(e.geometry.computeVertexNormals(),e.geometry.computeBoundingBox(),2==t&&(e.castShadow=!0),e.receiveShadow=!1,t+=1)}),x.house=i;for(let a=0;a<t;a++)2!=a?n[a]=new e.MeshBasicMaterial({color:o[a],transparent:!0,opacity:.7}):n[a]=new e.MeshStandardMaterial({color:o[a],roughness:.9,metalness:0}),x.house.children[a].material=n[a];x.house.children[0].material.envMap=x.skybox,x.house.children[1].material.envMap=x.skybox;let r=new e.ShadowMaterial({color:1118481,transparent:!0,opacity:.2});x.winShadow=new e.Mesh(i.children[1].geometry,r),x.winShadow.castShadow=!1,x.winShadow.receiveShadow=!0,x.houseShadow=new e.Mesh(i.children[2].geometry,r),x.houseShadow.castShadow=!1,x.houseShadow.receiveShadow=!0,x.house.scale.set(100,100,100),x.winShadow.scale.set(100,100,100),x.houseShadow.scale.set(100,100,100),x.house.position.set(0,0,0),x.house.rotation.set(0,Math.PI/2,0),x.winShadow.position.set(.1,.1,.1),x.winShadow.rotation.set(0,Math.PI/2,0),x.houseShadow.position.set(.1,.1,.1),x.houseShadow.rotation.set(0,Math.PI/2,0),grups[0].add(x.house),grups[0].add(x.winShadow),grups[0].add(x.houseShadow)}),addBlinds(),addAircon(),addTree(),addChair()}function addBlinds(){let t=new e.PlaneGeometry(102,15),i=new e.PlaneGeometry(35,13),n=new e.PlaneGeometry(53.5,14),o=new e.MeshBasicMaterial({color:16777215}),a=new e.MeshBasicMaterial({color:16777215}),r=new e.MeshBasicMaterial({color:16777215});x.blinds=new e.Mesh(t,o),x.blinds.position.set(-11.6,8.8,-4.6),x.blinds2=new e.Mesh(i,a),x.blinds2.position.set(27,27,20),x.blinds3=new e.Mesh(n,r),x.blinds3.position.set(10.3,27,-5.8),x.blinds3.rotation.set(0,-(Math.PI/2),0),grups[0].add(x.blinds),grups[0].add(x.blinds2),grups[0].add(x.blinds3);let s=new e.TextureLoader,d=new e.TextureLoader,l=new e.TextureLoader;s.load("img/vaporwave/blinds1.jpg",function(t){t.wrapS=t.wrapT=e.RepeatWrapping,t.repeat.set(5,1),x.blinds.material.map=t,x.blinds.material.needsUpdate=!0}),d.load("img/vaporwave/blinds1.jpg",function(t){t.wrapS=t.wrapT=e.RepeatWrapping,t.repeat.set(1.7,1),x.blinds2.material.map=t,x.blinds2.material.needsUpdate=!0}),l.load("img/vaporwave/blinds1.jpg",function(t){t.wrapS=t.wrapT=e.RepeatWrapping,t.repeat.set(3,1),x.blinds3.material.map=t,x.blinds3.material.needsUpdate=!0})}function addAircon(){let t=0,n,o=[16777215,15658734,16777215];x.aircon=[],x.acShadow=[];let a=new i;a.load("obj/aircon/aircon1.obj",function(i){i.traverse(function(e){e.isMesh&&(e.geometry.computeVertexNormals(),e.geometry.computeBoundingBox(),t+=1)}),n=new e.MeshStandardMaterial({color:o[0],roughness:.5,metalness:.1});let a=new e.ShadowMaterial({color:1118481,transparent:!0,opacity:.2});for(let r=0;r<4;r++)x.aircon[r]=new e.Mesh(i.children[0].geometry,n),x.acShadow[r]=new e.Mesh(i.children[0].geometry,a),x.aircon[r].castShadow=!0,x.aircon[r].receiveShadow=!1,x.acShadow[r].castShadow=!1,x.acShadow[r].receiveShadow=!0,grups[0].add(x.aircon[r]),grups[0].add(x.acShadow[r]);x.aircon[0].position.set(-40,1.7,.5),x.aircon[1].position.set(-15.5,1.7,.5),x.aircon[2].position.set(10,1.7,.5),x.aircon[3].position.set(4,19,-36.4),x.aircon[3].rotation.set(0,-(Math.PI/2),0),x.acShadow[0].position.set(-39.9,1.8,.6),x.acShadow[1].position.set(-15.4,1.8,.6),x.acShadow[2].position.set(10.1,1.8,.6),x.acShadow[3].position.set(3.9,19.1,-36.3),x.acShadow[3].rotation.set(0,-(Math.PI/2),0);let s=new e.TextureLoader,d=new e.TextureLoader;s.load("obj/aircon/mat/diffuse1.jpg",function(e){for(let t=0;t<4;t++)x.aircon[t].material.map=e,x.aircon[t].material.needsUpdate=!0}),d.load("obj/aircon/mat/normal1.jpg",function(e){for(let t=0;t<4;t++)x.aircon[t].material.normalMap=e,x.aircon[t].material.needsUpdate=!0})})}function addTree(){let t=0,n,o,a,r=[16777215,15658734,16777215];x.leaf=[],x.branch=[],x.trunk=[],x.leafShadow=[],x.branchShadow=[],x.trunkShadow=[];let s=new i;s.load("obj/palmtree/palmtree.obj",function(i){i.traverse(function(e){e.isMesh&&(e.geometry.computeVertexNormals(),e.geometry.computeBoundingBox(),t+=1)});let s=[Math.PI/2,0,-(Math.PI/3)],d=[-48,-8,32];n=new e.MeshStandardMaterial({color:r[0],roughness:.7,metalness:.1}),o=new e.MeshStandardMaterial({color:r[0],roughness:.3,transparent:!0,side:e.DoubleSide}),a=new e.MeshStandardMaterial({color:r[0],roughness:.5,metalness:.1}),o.depthWrite=!1;let l=new e.ShadowMaterial({color:1118481,transparent:!0,opacity:.3});for(let c=0;c<3;c++)x.leaf[c]=new e.Mesh(i.children[1].geometry,o),x.branch[c]=new e.Mesh(i.children[2].geometry,a),x.branchShadow[c]=new e.Mesh(i.children[2].geometry,l),x.trunk[c]=new e.Mesh(i.children[0].geometry,n),x.trunkShadow[c]=new e.Mesh(i.children[0].geometry,l),x.leaf[c].castShadow=x.branch[c].castShadow=x.trunk[c].castShadow=x.leaf[c].receiveShadow=!0,x.branch[c].receiveShadow=x.trunk[c].receiveShadow=!1,x.branchShadow[c].castShadow=x.trunkShadow[c].castShadow=!1,x.branchShadow[c].receiveShadow=x.trunkShadow[c].receiveShadow=!0,x.leaf[c].scale.set(.5,.5,.5),x.branch[c].scale.set(.5,.5,.5),x.trunk[c].scale.set(.5,.5,.5),x.branchShadow[c].scale.set(.5,.5,.5),x.trunkShadow[c].scale.set(.5,.5,.5),x.leaf[c].rotation.y=x.branch[c].rotation.y=x.trunk[c].rotation.y=x.branchShadow[c].rotation.y=x.trunkShadow[c].rotation.y=s[c],x.leaf[c].position.set(d[c],0,-60),x.branch[c].position.set(d[c],0,-60),x.trunk[c].position.set(d[c],0,-60),x.branchShadow[c].position.set(d[c]+.1,.1,-59.9),x.trunkShadow[c].position.set(d[c]+.1,.1,-59.9),grups[0].add(x.leaf[c]),grups[0].add(x.branch[c]),grups[0].add(x.trunk[c]),grups[0].add(x.branchShadow[c]),grups[0].add(x.trunkShadow[c]);let h=new e.TextureLoader,u=new e.TextureLoader,$=new e.TextureLoader,w=new e.TextureLoader,p=new e.TextureLoader,m=new e.TextureLoader;h.load("obj/palmtree/mat/barkd1.jpg",function(e){for(let t=0;t<3;t++)x.trunk[t].material.map=e,x.trunk[t].material.needsUpdate=!0}),u.load("obj/palmtree/mat/leafd1.jpg",function(e){for(let t=0;t<3;t++)x.leaf[t].material.map=e,x.leaf[t].material.needsUpdate=!0}),$.load("obj/palmtree/mat/branchd1.jpg",function(e){for(let t=0;t<3;t++)x.branch[t].material.map=e,x.branch[t].material.needsUpdate=!0}),w.load("obj/palmtree/mat/leafo1.jpg",function(e){for(let t=0;t<3;t++)x.leaf[t].material.alphaMap=e,x.leaf[t].material.needsUpdate=!0}),p.load("obj/palmtree/mat/leafn1.jpg",function(e){for(let t=0;t<3;t++)x.leaf[t].material.normalMap=e,x.leaf[t].material.needsUpdate=!0}),m.load("obj/palmtree/mat/barkn1.jpg",function(e){for(let t=0;t<3;t++)x.trunk[t].material.normalMap=e,x.trunk[t].material.needsUpdate=!0})})}function addChair(){let t=0,n,o=[16777215,15658734,16777215];x.chair=[],x.chairShadow=[];let a=new i;a.load("obj/vaporw/loungechair.obj",function(i){i.traverse(function(e){e.isMesh&&(e.geometry.computeBoundingBox(),t+=1)});let a=-(Math.PI/2),r=[-(Math.PI/2),-(Math.PI/2),Math.PI/2,Math.PI/2,0,0],s=[19,19,-53,-53,-24,-34],d=[1.5,1.5,1.5,1.5,19.2,19.2],l=[11,18,6,13,-27,-27];n=new e.MeshStandardMaterial({color:o[0],roughness:.4,metalness:0});let c=new e.ShadowMaterial({color:1118481,transparent:!0,opacity:.3});for(let h=0;h<6;h++)x.chair[h]=new e.Mesh(i.children[0].geometry,n),x.chairShadow[h]=new e.Mesh(i.children[0].geometry,c),x.chair[h].castShadow=!0,x.chair[h].receiveShadow=!1,x.chairShadow[h].castShadow=!1,x.chairShadow[h].receiveShadow=!0,x.chair[h].scale.set(7,7,7),x.chairShadow[h].scale.set(7,7,7),x.chair[h].rotation.x=x.chairShadow[h].rotation.x=a,x.chair[h].rotation.z=x.chairShadow[h].rotation.z=r[h],x.chair[h].position.set(s[h],0+d[h],l[h]),x.chairShadow[h].position.set(s[h]+.1,0+d[h]+.1,l[h]+.1),grups[0].add(x.chair[h]),grups[0].add(x.chairShadow[h])})}function addCar(){let t=0,n=[],o=[16777215],a=new i;a.load("obj/vaporw/car2.obj",function(i){i.traverse(function(e){e.isMesh&&(e.geometry.computeVertexNormals(),e.geometry.computeBoundingBox(),t+=1)});for(let a=0;a<t;a++)n[a]=new e.MeshStandardMaterial({color:o[a],roughness:.1,metalness:.1});x.car=new e.Mesh(i.children[0].geometry,n[0]),x.car.position.set(0,-.23,70),x.car.castShadow=!0,x.car.receiveShadow=!0,grups[0].add(x.car),grups[0].position.z=0,grups[0].rotation.y=Math.PI/4;new e.TextureLoader().load("obj/vaporw/mat/diffuse1.jpg",function(e){x.car.material.map=e,x.car.material.needsUpdate=!0})}),scene.add(grups[0]),scene.add(grups[1]),fadeScene()}function fadeScene(){!function e(){let t=parseFloat(ui.kontainer.style.opacity);(t+=.05)>1?(ui.kontainer.style.opacity=1,onWindowResize(),isMobil?(ui.kontainer.addEventListener("touchstart",onDocumentTouchStart,!1),ui.kontainer.addEventListener("touchmove",onDocumentTouchMove,!1)):(ui.kontainer.addEventListener("mousemove",onMouseMove,!1),ui.kontainer.addEventListener("click",kontainerClick,!1)),ui.kontainer.addEventListener("pointermove",onMouseMove,!1),ui.kontainer.addEventListener("wheel",wheelE,!1),animate(),theOptions()):(ui.kontainer.style.opacity=t,requestAnimationFrame(e))}()}function animWalk3(){grups[1].position.z;let e=grups[1].rotation.y;win.ej[0]&&((e>1.9||e<-.8)&&(win.ej[2]*=-1),grups[1].rotation.y=e+win.ej[2])}function onMouseMove(e){e&&e.preventDefault(),mouseX=e.clientX-win.widthH,mouseY=e.clientY-win.heightH,isMobil?(win.pointer.x=e.touches[0].pageX/win.width*2-1,win.pointer.y=-(2*(e.touches[0].pageY/win.height))+1):(win.pointer.x=e.clientX/win.width*2-1,win.pointer.y=-(2*(e.clientY/win.height))+1),mouseY-=50,win.idleTimer=0}function onMouseWheel(e){e.preventDefault(),win.idleTimer=0}function wheelE(e){e.preventDefault(),x.prevCamZ=camera.position.z,camera.position.z+=.1*e.deltaY,(camera.position.z<110||camera.position.z>200)&&(camera.position.z=x.prevCamZ),win.idleTimer=0}function onDocumentTouchStart(e){1===e.touches.length&&(mouseX=e.touches[0].pageX-win.widthH,mouseY=e.touches[0].pageY-win.heightH,win.pointer.x=e.touches[0].pageX/win.width*2-1,win.pointer.y=-(2*(e.touches[0].pageY/win.height))+1,win.idleTimer=0)}function onDocumentTouchMove(e){1===e.touches.length&&(mouseX=e.touches[0].pageX-win.widthH,mouseY=e.touches[0].pageY-win.heightH)}function onDocumentTouchEnd(e){1===e.touches.length&&(win.pointer.x=e.touches[0].pageX/win.width*2-1,win.pointer.y=-(2*(e.touches[0].pageY/win.height))+1,ui.kontainer.removeEventListener("touchmove",onDocumentTouchMove,!1),ui.kontainer.removeEventListener("touchend",onDocumentTouchEnd,!1),win.idleTimer=0)}function kontainerClick(e){e.preventDefault(),win.idleTimer=0}function onWindowResize(){if(win.width=window.innerWidth,win.height=window.innerHeight,isMobil){let e=document.documentElement.getBoundingClientRect(),t=document.documentElement.clientWidth,i=document.documentElement.clientHeight;if(e)win.width=e.width,win.height=e.height;else if(t)win.width=t,win.height=i;else{let n=win.width;win.width=win.height,win.height=n}}win.widthH=win.width/2,win.heightH=win.height/2,document.body.style.width=ui.kontainer.style.width=win.width+"px",document.body.style.height=ui.kontainer.style.height=win.height+"px",camera.aspect=win.width/win.height,camera.updateProjectionMatrix(),renderer.setSize(win.width,win.height),isMobil?(win.cr[1]=-.0006,win.cr[0]=4e-4):(win.cr[1]=-.0004,win.cr[0]=6e-4),win.width>win.height?win.ej[1]=.1:win.ej[1]=.2,win.idleTimer=0}function animate(){if(requestAnimationFrame(animate),win.idleTimer<120){if(clock.running||clock.start(),animWalk3(),isMobil){let e=15e-5*Date.now();win.ej[0]||(camera.position.x=70*Math.sin(3*e)),camera.position.y=20*Math.cos(e)+20,camera.position.z=40*Math.sin(e)+140}else if(win.ej[0]){let t=15e-5*Date.now();camera.position.y=20*Math.cos(t)+20,camera.position.z=40*Math.sin(t)+140}else camera.position.x=mouseX*win.ej[1],camera.position.y=-.04*mouseY+20;win.idleTimer+=.01,render()}else clock.running&&clock.stop(),x.sound&&x.sound.isPlaying&&x.sound.pause();document.hasFocus()?win.fokus||(win.idleTimer=0,win.fokus=!0,x.sound&&!x.sound.isPlaying&&x.sound.play()):(win.idleTimer=120,win.fokus=!1,x.sound&&x.sound.isPlaying&&x.sound.pause())}function render(){win.ej[0]?camera.lookAt(grups[0].position):camera.lookAt(scene.position),renderer.render(scene,camera)}function addAud(){if(!x.sound){let t="vprwv";t+=".mp3";let i=new e.AudioListener;camera.add(i),x.sound=new e.Audio(i);let n=new e.AudioLoader;n.load("aud/"+t,function(e){x.sound.setBuffer(e),x.sound.setLoop(!0),x.sound.setVolume(.5),x.sound.play(),ui.onAud.classList.add("noneIt2"),ui.offAud.classList.remove("noneIt2")})}}



	