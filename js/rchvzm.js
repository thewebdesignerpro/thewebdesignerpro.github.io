/**
 * author Armstrong "Army" Chiu
 * URL: https://thewebdesignerpro.com/     
 */
 
 
import*as e from"three";import t from"three/addons/capabilities/WebGL.js";import{OBJLoader as a}from"three/addons/loaders/OBJLoader.js";let idleTO=120,florY=-1,ceilY=140,camera,scene,renderer,clock,grups=[],isMobil=!1,mouseX=0,mouseY=-50,mixer,ui={},_={},x={};if(t.isWebGL2Available())window.addEventListener?window.addEventListener("load",init,!1):window.attachEvent?window.attachEvent("onload",init):window.onload=init;else{let r=t.getWebGL2ErrorMessage();kontainer.appendChild(r),kontainer.style.background="url('img/archvizl.jpg') center top no-repeat",kontainer.style.backgroundSize="cover",fader.style.opacity=0,fader.style.display="none",fader.parentNode.removeChild(fader),cL(loadr,0,"paus"),loadr.style.display="none",loadr.parentNode.removeChild(loadr)}function eL(e,t,a,r){0==t?e.addEventListener(a,r,!1):e.removeEventListener(a,r,!1)}function cL(e,t,a){0==t?e.classList.contains(a)||e.classList.add(a):e.classList.contains(a)&&e.classList.remove(a)}function init(){function t(e){return document.getElementById(e)}ui.kontainer=t("kontainer"),ui.onAud=t("onAud"),ui.offAud=t("offAud"),ui.loadr=t("loadr"),ui.fader=t("fader"),ui.fader.style.opacity=1;let a=document.createElement("div");if(a.setAttribute("id","dummy"),document.body.appendChild(a),(isMobil="9000px"!=window.getComputedStyle(a,null).getPropertyValue("left"))&&(document.addEventListener("gesturechange",function(e){e.preventDefault()},!1),ui.kontainer.addEventListener("gesturechange",function(e){e.preventDefault()},!1),_.prevW=_.prevH=0),a.parentNode.removeChild(a),_.width=window.innerWidth,_.height=window.innerHeight,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",ui.kontainer.style.backgroundColor="#eaeff2",_.ej=[],_.ej[0]=0,_.ej[1]=-1,_.ej[2]=Math.PI,_.ej[3]=0,_.ej[4]=0,_.ej[5]=50,x.xx=400,(renderer=new e.WebGLRenderer({antialias:!0,alpha:!1})).setPixelRatio(window.devicePixelRatio),renderer.setSize(_.width,_.height),renderer.setClearColor(15396850,1),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=e.PCFSoftShadowMap,renderer.outputColorSpace=e.LinearSRGBColorSpace,renderer.sortObjects=!1,ui.kontainer.appendChild(renderer.domElement),!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float"))throw alert("OES_texture_float not supported"),"missing webgl extension";if(!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float_linear"))throw alert("OES_texture_float_linear not supported"),"missing webgl extension";scene=new e.Scene,x.camGrup=new e.Group,grups[0]=new e.Group,(camera=new e.PerspectiveCamera(50,_.width/_.height,.5,2e4)).position.set(0,_.ej[5],450),x.camGrup.add(camera),scene.add(new e.AmbientLight(10395294)),x.spotLight=[],x.spotLight[0]=new e.SpotLight(16775921,8e7,5500,Math.PI/8,1),x.spotLight[0].position.set(-500,4e3,1e3),x.spotLight[0].castShadow=!0,x.spotLight[0].shadow.mapSize.width=1024,x.spotLight[0].shadow.mapSize.height=1024,x.spotLight[0].shadow.camera.near=1,x.spotLight[0].shadow.camera.far=5500,x.spotLight[0].shadow.camera.fov=50,x.spotLight[0].shadow.intensity=.8,scene.add(x.spotLight[0]),x.camGrup.position.set(0,0,_.ej[3]),scene.add(x.camGrup),eL(window,1,"load",init),eL(window,0,"resize",onWindowResize),(clock=new e.Clock).autoStart=!1,_.mouse=new e.Vector2,_.entro=!0,_.idleTimer=0,_.fokus=!0,_.pointer=new e.Vector2,_.ptrDown=!1,x.currGrup=0,x.target0=new e.Object3D,x.target0.position.set(0,_.ej[5]-10,x.camGrup.position.z),scene.add(x.target0),addSkybox(),onWindowResize()}function addSkybox(){let t=".jpg",a=new e.CubeTextureLoader;a.setPath("img/skybox/13/"),a.load(["left"+t,"right"+t,"top"+t,"bottom"+t,"back"+t,"front"+t],function(t){t.colorSpace=e.LinearSRGBColorSpace,x.skybox=t,scene.backgroundRotation.set(0,Math.PI/2,0),scene.background=x.skybox,addGrass()})}function addGrass(){let t=new e.PlaneGeometry(4e3,4e3),a=new e.MeshStandardMaterial({color:16777215,roughness:1,metalness:0});a.transparent=!0,x.grass=new e.Mesh(t,a),x.grass.position.set(0,-.2,0),x.grass.rotation.x=-(Math.PI/2),x.grass.receiveShadow=!0,scene.add(x.grass);let r="img/ground/10/",n=new e.TextureLoader,o=new e.TextureLoader,i=new e.TextureLoader,s=new e.TextureLoader,d=new e.TextureLoader,l=new e.TextureLoader,$=new e.TextureLoader,u=new e.TextureLoader;n.load("img/opac2.jpg",function(e){x.grass.material.alphaMap=e,x.grass.material.needsUpdate=!0}),o.load(r+"color1.jpg",function(t){t.wrapS=t.wrapT=e.RepeatWrapping,t.repeat.set(12,12),x.grass.material.map=t,x.grass.material.needsUpdate=!0}),i.load(r+"rough1.jpg",function(t){t.wrapS=t.wrapT=e.RepeatWrapping,t.repeat.set(12,12),x.grass.material.roughnessMap=t,x.grass.material.needsUpdate=!0}),s.load(r+"normal1.jpg",function(t){t.wrapS=t.wrapT=e.RepeatWrapping,t.repeat.set(12,12),x.grass.material.normalScale.set(4,4),x.grass.material.normalMap=t,x.grass.material.needsUpdate=!0});let c="img/concrete/0/",p=new e.PlaneGeometry(600,400),h=new e.MeshStandardMaterial({color:16775925,roughness:1,transparent:!0,opacity:1});x.concrete=new e.Mesh(p,h),x.concrete.rotation.set(-(Math.PI/2),0,Math.PI),x.concrete.receiveShadow=!0,grups[0].add(x.concrete),d.load(c+"color1.jpg",function(t){t.wrapS=t.wrapT=e.RepeatWrapping,t.repeat.set(7.5,5),x.concrete.material.map=t,x.concrete.material.needsUpdate=!0}),l.load(c+"rough1.jpg",function(t){t.wrapS=t.wrapT=e.RepeatWrapping,t.repeat.set(7.5,5),x.concrete.material.roughnessMap=t,x.concrete.material.needsUpdate=!0}),$.load(c+"normal1.jpg",function(t){t.wrapS=t.wrapT=e.RepeatWrapping,t.repeat.set(7.5,5),x.concrete.material.normalMap=t,x.concrete.material.needsUpdate=!0}),u.load(c+"edge2.jpg",function(e){x.concrete.material.alphaMap=e,x.concrete.material.needsUpdate=!0}),addHouse()}function addHouse(){let t=0,r=new a;r.load("obj/bldg/1/bldg.obj",function(a){a.traverse(function(e){e.isMesh&&(e.geometry.computeBoundingBox(),(0==t||2==t||5==t)&&(e.castShadow=!0),e.receiveShadow=!0,t+=1)}),x.house=a,x.house.position.set(0,-.2,0),x.house.rotation.set(0,Math.PI,0),x.house.scale.set(20,20,20);let r=[],n=[16777215,15856629,12500670,11446444,11446444,16777215],o=[0,.25,0,0,0,0];for(let i=0;i<t;i++)1==i?(r[i]=new e.MeshPhongMaterial({color:n[i],emissive:6186863}),r[i].transparent=!0,r[i].opacity=.88,r[i].reflectivity=.8,r[i].envMap=x.skybox):r[i]=new e.MeshStandardMaterial({color:n[i],roughness:1,metalness:o[i]}),(2==i||5==i)&&(r[i].roughness=.7,r[i].side=2,r[i].shadowSide=1),x.house.children[i].material=r[i];grups[0].add(x.house);let s=new e.PlaneGeometry(80,200),d=new e.MeshPhongMaterial({color:13290701,transparent:!0,opacity:.9});d.reflectivity=.8,d.envMap=x.skybox;let l=new e.Mesh(s,d);l.rotation.set(-(Math.PI/2),0,Math.PI),l.position.set(-150,155,-30),l.receiveShadow=!0,grups[0].add(l);let $=new e.PlaneGeometry(90,170),u=new e.Mesh($,d);u.rotation.set(-(Math.PI/2),0,Math.PI),u.position.set(-60,177,-20),u.receiveShadow=!0,grups[0].add(u),scene.add(grups[0]),x.spotLight[0].target=x.house;let c=new e.TextureLoader,p=new e.TextureLoader,h=new e.TextureLoader;c.load("img/wood/0/color1.jpg",function(t){t.wrapS=t.wrapT=e.RepeatWrapping,t.repeat.set(2,2),x.house.children[0].material.map=t,x.house.children[0].material.needsUpdate=!0}),p.load("img/wood/0/rough1.jpg",function(t){t.wrapS=t.wrapT=e.RepeatWrapping,t.repeat.set(2,2),x.house.children[0].material.roughnessMap=t,x.house.children[0].material.needsUpdate=!0}),h.load("img/wood/0/normal1.jpg",function(t){t.wrapS=t.wrapT=e.RepeatWrapping,t.repeat.set(2,2),x.house.children[0].material.normalMap=t,x.house.children[0].material.needsUpdate=!0}),addTrees()})}function randomizeMatrix(t){let a=new e.Vector3,r=new e.Euler,n=new e.Quaternion,o=new e.Vector3,i=2500*Math.random()-1250,s=2500*Math.random()-1250;return i>-400&&i<400&&s>-400&&s<400&&(s=-800*Math.random()-400),a.x=i,a.y=-19,a.z=s,r.y=2*Math.random()*Math.PI,n.setFromEuler(r),o.x=o.y=o.z=2.6+Math.random(),t.compose(a,n,o)}function addTrees(){let t=0;x.materials2=[],x.leaves=[],x.trunk=[];let r=new a;r.load("obj/trees/11/tree.obj",function(a){a.traverse(function(e){e.isMesh&&(e.geometry.computeBoundingBox(),t+=1)}),x.materials2[0]=new e.MeshStandardMaterial({color:16777215,roughness:.5,alphaTest:.5}),x.materials2[0].side=2,x.materials2[0].shadowSide=e.BackSide,x.materials2[1]=new e.MeshStandardMaterial({color:16777215,roughness:1});for(let r=0;r<1;r++){let n=a.children[0].geometry.attributes.position.array.length,o=a.children[1].geometry.attributes.position.array.length;x.leaves[r]=new e.BatchedMesh(320,n,2*n,x.materials2[0]),x.leaves[r].frustumCulled=!0,x.leaves[r].castShadow=!0,x.trunk[r]=new e.BatchedMesh(320,o,2*o,x.materials2[1]),x.trunk[r].frustumCulled=!0,x.trunk[r].castShadow=x.trunk[r].receiveShadow=!0;let i=x.leaves[r].addGeometry(a.children[0].geometry),s=x.trunk[r].addGeometry(a.children[1].geometry),d=new e.Matrix4;for(let l=0;l<320;l++){let $=x.leaves[r].addInstance(i),u=x.trunk[r].addInstance(s);d=randomizeMatrix(d),x.leaves[r].setMatrixAt($,d),x.trunk[r].setMatrixAt(u,d)}grups[0].add(x.leaves[r]),grups[0].add(x.trunk[r]),x.leaves[r].visible=x.trunk[r].visible=!1}let c=new e.TextureLoader,p=new e.TextureLoader,h=new e.TextureLoader,f=new e.TextureLoader,m=new e.TextureLoader,g=new e.TextureLoader,w="obj/trees/11/mat/";c.load(w+"color1.jpg",function(e){x.materials2[0].map=e,x.materials2[0].needsUpdate=!0;for(let t=0;t<1;t++)x.trunk[t].visible=!0}),p.load(w+"alfa1.jpg",function(e){x.materials2[0].alphaMap=e,x.materials2[0].needsUpdate=!0;for(let t=0;t<1;t++)x.leaves[t].visible=!0}),h.load(w+"normal1.jpg",function(e){x.materials2[0].normalMap=e,x.materials2[0].needsUpdate=!0;for(let t=0;t<1;t++)x.leaves[t].visible=!0}),f.load(w+"color2.jpg",function(e){x.materials2[1].map=e,x.materials2[1].needsUpdate=!0;for(let t=0;t<1;t++)x.trunk[t].visible=!0}),m.load(w+"rough2.jpg",function(e){x.materials2[1].roughnessMap=e,x.materials2[1].needsUpdate=!0;for(let t=0;t<1;t++)x.leaves[t].visible=!0}),g.load(w+"normal2.jpg",function(e){x.materials2[0].normalMap=e,x.materials2[0].needsUpdate=!0;for(let t=0;t<1;t++)x.leaves[t].visible=!0}),addCar()})}function addCar(){let t=0,r=new a;r.load("obj/car/4/car.obj",function(a){a.traverse(function(e){e.isMesh&&(e.geometry.computeBoundingBox(),e.castShadow=!0,e.receiveShadow=!0,t+=1)}),x.car=a;let r=[];for(let n=0;n<t;n++)r[n]=new e.MeshStandardMaterial({color:16777215,roughness:.25,metalness:.25}),x.car.children[n].material=r[n];x.car.scale.set(30,30,30),x.car.position.set(140,0,20),x.car.rotation.set(-(Math.PI/2),0,Math.PI),grups[0].add(x.car);let o=new e.TextureLoader;o.load("obj/car/4/mat/color1.jpg",function(e){x.car.children[0].material.map=x.car.children[0].material.metalnessMap=e,x.car.children[0].material.needsUpdate=!0}),fadeScene()})}function fadeScene(){onWindowResize(),function t(){let a=parseFloat(ui.fader.style.opacity);(a-=.05)<0?(ui.fader.style.opacity=0,ui.fader.style.display="none",ui.fader.parentNode.removeChild(ui.fader),onWindowResize(),eL(ui.kontainer,0,"pointerdown",onPointerDown),eL(ui.kontainer,0,"pointermove",onPointerMove),x.camV3=new e.Vector3,animate(),theOptions(),cL(ui.loadr,0,"paus"),ui.loadr.style.display="none",ui.loadr.parentNode.removeChild(ui.loadr),x.fogIdx=0,x.fogInc=1):(ui.fader.style.opacity=a,requestAnimationFrame(t))}()}function theOptions(){isMobil?(eL(ui.onAud,0,"touchstart",audClick),eL(ui.offAud,0,"touchstart",audClick)):(eL(ui.onAud,0,"click",audClick),eL(ui.offAud,0,"click",audClick))}function audClick(e){e&&e.preventDefault(),x.sound?x.sound.isPlaying?(cL(ui.offAud,0,"noneIt2"),cL(ui.onAud,1,"noneIt2"),x.sound.pause()):(cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2"),x.sound.play()):addAud(),_.idleTimer=0}function onPointerDown(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-(2*(e.clientY/_.height))+1):(t.x=e.x/_.width*2-1,t.y=-(2*(e.y/_.height))+1),_.ptrDown=!0,_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function onPointerMove(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-(2*(e.clientY/_.height))+1):(t.x=e.x/_.width*2-1,t.y=-(2*(e.y/_.height))+1),_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function wheelE(e){e&&e.preventDefault(),_.idleTimer=0}function onWindowResize(){_.width=window.innerWidth,_.height=window.innerHeight,isMobil&&(_.width==_.prevW&&(_.width=_.prevH,_.height=_.prevW),_.prevW=_.width,_.prevH=_.height),_.widthH=_.width/2,_.heightH=_.height/2,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",camera.aspect=_.width/_.height,camera.updateProjectionMatrix(),renderer.setSize(_.width,_.height),x.xx=400,_.width>_.height?(cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.022+"px",camera.position.z=450,isMobil&&(x.xx=800)):(cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.028+"px",camera.position.z=600,isMobil&&(x.xx=1100)),_.idleTimer=0}function animate(){if(requestAnimationFrame(animate),_.idleTimer<120){clock.running||clock.start();let e=.001*Date.now();x.camGrup.rotation.y=Math.sin(.1*e)*Math.PI/3,isMobil?(camera.position.x=150*Math.sin(.1*e),camera.position.y=160*Math.sin(.15*e)+175):(camera.position.x=150*_.pointer.x,camera.position.y=160*_.pointer.y+175),_.idleTimer+=.01,render()}else clock.running&&clock.stop(),x.sound&&x.sound.isPlaying&&x.sound.pause();document.hasFocus()?_.fokus||(_.idleTimer=0,_.fokus=!0,x.sound&&!x.sound.isPlaying&&x.sound.play()):(_.idleTimer=120,_.fokus=!1,x.sound&&x.sound.isPlaying&&x.sound.pause())}function render(){camera.lookAt(x.target0.position),renderer.render(scene,camera)}function addAud(){if(!x.sound){let t="rchvz";t+=".mp3";let a=new e.AudioListener;camera.add(a),x.sound=new e.Audio(a);let r=new e.AudioLoader;r.load("aud/"+t,function(e){x.sound.setBuffer(e),x.sound.setLoop(!0),x.sound.setVolume(.9),x.sound.play(),cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2")})}}
	