/**
 * author Armstrong "Army" Chiu
 * URL: https://thewebdesignerpro.com/     
 */
 
 
import*as THREE from"three";import WebGL from"three/addons/capabilities/WebGL.js";import{reflector,uv,texture,color}from"three/tsl";import{OBJLoader}from"three/addons/loaders/OBJLoader.js";import*as BufferGeometryUtils from"three/addons/utils/BufferGeometryUtils.js";const idleTO=120,florY=0,ceilY=140;let camera,scene,renderer,clock;const grups=[];let mixer,isMobil=!1,mouseX=0,mouseY=-50;const ui={},_={},x={};let postProcessing,volumetricMesh,pointLight,isAvailable="undefined"!=typeof navigator&&void 0!==navigator.gpu;if(WebGL.isWebGL2Available()&&isAvailable)window.addEventListener?window.addEventListener("load",init,!1):window.attachEvent?window.attachEvent("onload",init):window.onload=init;else{const e='Your browser does not support <a href="https://gpuweb.github.io/gpuweb/" style="color:blue">WebGPU</a> yet';kontainer.appendChild(e),kontainer.style.background="url('img/nightdrivel.jpg') center top no-repeat",kontainer.style.backgroundSize="cover",fader.style.opacity=0,fader.style.display="none",fader.parentNode.removeChild(fader),cL(loadr,0,"paus"),loadr.style.display="none",loadr.parentNode.removeChild(loadr)}function eL(e,t,r,o){0==t?e.addEventListener(r,o,!1):e.removeEventListener(r,o,!1)}function cL(e,t,r){0==t?e.classList.contains(r)||e.classList.add(r):e.classList.contains(r)&&e.classList.remove(r)}function init(){function e(e){return document.getElementById(e)}ui.kontainer=e("kontainer"),ui.swtchKam=e("swtchKam"),ui.onAud=e("onAud"),ui.offAud=e("offAud"),ui.swtchKam.style.visibility="hidden",ui.loadr=e("loadr"),ui.fader=e("fader"),ui.fader.style.opacity=1;let t=document.createElement("div");t.setAttribute("id","dummy"),document.body.appendChild(t),isMobil="9000px"!=window.getComputedStyle(t,null).getPropertyValue("left"),isMobil&&(document.addEventListener("gesturechange",(function(e){e.preventDefault()}),!1),ui.kontainer.addEventListener("gesturechange",(function(e){e.preventDefault()}),!1),_.prevW=_.prevH=0),t.parentNode.removeChild(t),_.width=window.innerWidth,_.height=window.innerHeight,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",ui.kontainer.style.backgroundColor="#000000";_.ej=[],_.ej[0]=0,_.ej[1]=-5,_.ej[2]=Math.PI,_.ej[3]=2e3,_.ej[4]=0,_.ej[5]=127,x.zz=450,scene=new THREE.Scene,scene.fog=new THREE.FogExp2(0,6e-4),x.camGrup=new THREE.Group,grups[0]=new THREE.Group,grups[1]=new THREE.Group,scene.add(grups[0]),scene.add(grups[1]),camera=new THREE.PerspectiveCamera(50,_.width/_.height,1,1e4),camera.position.set(100,_.ej[5],-20),x.camGrup.add(camera),x.camGrup.position.set(0,0,2e3),scene.add(x.camGrup),scene.add(new THREE.AmbientLight(11184810)),clock=new THREE.Clock,clock.autoStart=!1,_.mouse=new THREE.Vector2,_.entro=!0,_.idleTimer=0,_.fokus=!0,_.pointer=new THREE.Vector2,_.ptrDown=!1,renderer=new THREE.WebGPURenderer({antialias:!0}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(_.width,_.height),renderer.setClearColor(0,1),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,renderer.outputColorSpace=THREE.LinearSRGBColorSpace,renderer.sortObjects=!1,ui.kontainer.appendChild(renderer.domElement);const r=new THREE.DirectionalLight(16777215,2.6);r.castShadow=!0,r.shadow.camera.far=3200,r.shadow.camera.left=-1400,r.shadow.camera.bottom=-1400,r.shadow.camera.right=1400,r.shadow.camera.top=1400,r.position.set(0,1e3,-1e3),r.shadow.intensity=.8,scene.add(r),eL(window,1,"load",init),eL(window,0,"resize",onWindowResize),x.currGrup=0,x.target0=new THREE.Object3D,x.target0.position.set(100,_.ej[5],1880),scene.add(x.target0),x.rotCam=!1,x.inCar=!0,addSkybox(),addClouds(),addGround(),addTrees(),onWindowResize()}function addSkybox(){const e=".png",t=new THREE.CubeTextureLoader;t.setPath("img/skybox/2/"),t.load(["posx"+e,"negx"+e,"posy"+e,"negy"+e,"negz"+e,"posz"+e],(function(e){x.skybox=e,addRoads()}))}function addClouds(){const e=new THREE.SphereGeometry(3500,32,16,0,2*Math.PI,0,Math.PI/2),t=new THREE.MeshBasicMaterial({color:16777215,side:THREE.BackSide,fog:!1}),r=new THREE.Mesh(e,t);r.position.y=-1,r.rotation.y=Math.PI-.5,x.camGrup.add(r);let o=new THREE.TextureLoader;new THREE.TextureLoader;o.load("img/skybox/0/mway3b.jpg",(function(e){r.material.map=e,r.material.needsUpdate=!0}))}function addRoads(){x.road=[];const e=[1e3,-1e3],t=[],r=new THREE.PlaneGeometry(1e3,2e3);for(let o=0;o<2;o++)t[o]=new THREE.MeshStandardMaterial({color:16777215,roughness:1,metalness:0}),t[o].transparent=!0,t[o].opacity=.9,t[o].wireframe=!0,x.road[o]=new THREE.Mesh(r,t[o]),x.road[o].position.set(0,florY,e[o]),x.road[o].rotation.x=Math.PI/-2,x.road[o].receiveShadow=!0,scene.add(x.road[o]);const o=new THREE.TextureLoader,a=new THREE.TextureLoader,n=new THREE.TextureLoader,i="img/road/0/";o.load(i+"color0123.jpg",(function(e){x.road[0].material.map=x.road[1].material.map=e,x.road[0].material.needsUpdate=x.road[1].material.needsUpdate=!0,x.road[0].material.wireframe=x.road[1].material.wireframe=!1})),a.load(i+"rough0123.jpg",(function(e){x.road[0].material.roughnessMap=x.road[0].material.alphaMap=x.road[1].material.roughnessMap=x.road[1].material.alphaMap=e,x.road[0].material.needsUpdate=x.road[1].material.needsUpdate=!0})),n.load(i+"normal0123.jpg",(function(e){x.road[0].material.normalScale.set(4,4),x.road[1].material.normalScale.set(4,4),x.road[0].material.normalMap=x.road[1].material.normalMap=e,x.road[0].material.needsUpdate=x.road[1].material.needsUpdate=!0,addWetGround()})),grups[0].position.z=1e3,grups[1].position.z=-1e3}function addWetGround(){(new THREE.TextureLoader).load("img/road/0/normal0123b.jpg",(function(e){const t=reflector(),r=texture(e,uv().mul(1)).xy.mul(2).sub(1).mul(.1);t.uvNode=t.uvNode.add(r);const o=color(16777215).mul(.04).add(t),a=new THREE.PlaneGeometry(1e3,2e3);x.mirror01=new THREE.Mesh(a,new THREE.MeshPhongNodeMaterial({colorNode:o})),x.mirror01.position.set(0,-.1,1e3),x.mirror01.rotation.x=Math.PI/-2,x.mirror01.add(t.target),scene.add(x.mirror01);const n=reflector();n.uvNode=n.uvNode.add(r);const i=color(16777215).mul(.04).add(n),d=new THREE.PlaneGeometry(1e3,2e3);x.mirror23=new THREE.Mesh(d,new THREE.MeshPhongNodeMaterial({colorNode:i})),x.mirror23.position.set(0,-.1,-1e3),x.mirror23.rotation.x=Math.PI/-2,x.mirror23.add(n.target),scene.add(x.mirror23),addCar()}))}function addGround(){x.ground=[];let e=new THREE.PlaneGeometry(4e3,4e3,160,160),t=new THREE.MeshStandardMaterial({color:13948116,roughness:1,metalness:0});t.wireframe=!0;for(let r=0;r<1;r++)x.ground[r]=new THREE.Mesh(e,t),x.ground[r].position.set(0,-48,0),x.ground[r].rotation.x=-.5*Math.PI,x.ground[r].receiveShadow=!0,scene.add(x.ground[r]);var r=new THREE.TextureLoader,o=new THREE.TextureLoader,a=new THREE.TextureLoader,n=new THREE.TextureLoader,i="img/ground/3/";r.load(i+"color1.jpg",(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.repeat.set(4,4);for(let t=0;t<1;t++)x.ground[t].material.map=e,x.ground[t].material.needsUpdate=!0,x.ground[t].material.wireframe=!1})),o.load("img/snowground2.jpg",(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.repeat.set(1,2);for(let t=0;t<1;t++)x.ground[t].material.displacementScale=120,x.ground[t].material.displacementMap=e,x.ground[t].material.needsUpdate=!0})),a.load(i+"normal1b.jpg",(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.repeat.set(4,4);for(let t=0;t<1;t++)x.ground[t].material.normalScale.set(.5,.5),x.ground[t].material.normalMap=e,x.ground[t].material.needsUpdate=!0})),n.load(i+"rough1.jpg",(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.repeat.set(4,4);for(let t=0;t<1;t++)x.ground[t].material.roughnessMap=e,x.ground[t].material.needsUpdate=!0}))}function randomizeMatrix(e){const t=new THREE.Vector3,r=new THREE.Euler,o=new THREE.Quaternion,a=new THREE.Vector3;let n=2400*Math.random()-1200;return n>-550&&n<550&&(n=n<0?-130*Math.random()-550:130*Math.random()+550),t.x=n,t.y=florY,t.z=1990*Math.random()-995,r.x=Math.PI/-2,r.z=2*Math.random()*Math.PI,o.setFromEuler(r),a.x=a.y=a.z=.3+.1*Math.random(),e.compose(t,o,a)}function addTrees(){x.trees=[];(new OBJLoader).load("obj/trees/2/tree1.obj",(function(e){e.traverse((function(e){e.isMesh&&e.geometry.computeBoundingBox()}));const t=new THREE.MeshStandardMaterial({color:16777215,roughness:.8,alphaTest:.5});t.wireframe=!0;const r=e.children[0].geometry.attributes.position.array.length;x.trees[0]=new THREE.BatchedMesh(25,r,2*r,t),x.trees[0].frustumCulled=!0,x.trees[0].castShadow=!0,x.trees[0].receiveShadow=!0,x.trees[1]=new THREE.BatchedMesh(25,r,2*r,t),x.trees[1].frustumCulled=!0,x.trees[1].castShadow=!0,x.trees[1].receiveShadow=!0;const o=x.trees[0].addGeometry(e.children[0].geometry),a=x.trees[1].addGeometry(e.children[0].geometry);let n=new THREE.Matrix4;for(let e=0;e<25;e++){const e=x.trees[0].addInstance(o),t=x.trees[1].addInstance(a);n=randomizeMatrix(n),x.trees[0].setMatrixAt(e,n),x.trees[1].setMatrixAt(t,n)}grups[0].add(x.trees[0]),grups[1].add(x.trees[1]);let i=new THREE.TextureLoader,d=new THREE.TextureLoader;i.load("obj/trees/2/mat/color1.png",(function(e){t.map=e,t.needsUpdate=!0,t.wireframe=!1})),d.load("obj/trees/2/mat/alpha1.png",(function(e){t.alphaMap=e,t.needsUpdate=!0}))}))}function addCar(){let e=0;x.car=[];(new OBJLoader).load("obj/car/9/car.obj",(function(t){t.traverse((function(t){t.isMesh&&(0!=e&&1!=e&&2!=e&&4!=e||(t.geometry=BufferGeometryUtils.toCreasedNormals(t.geometry,40/180*Math.PI)),t.geometry.computeBoundingBox(),e+=1)})),x.car[0]=t;const r=[],o="obj/car/9/mat/";for(let t=0;t<e;t++)r[t]=new THREE.MeshStandardMaterial({color:16777215,roughness:.82,metalness:.1}),r[t].wireframe=!0,x.car[0].children[t].material=r[t],0!=t&&1!=t&&2!=t||(r[t].roughness=0,r[t].envMapIntensity=.55,r[t].envMapRotation.set(0,.5,0),r[t].envMap=x.skybox);x.car[0].scale.set(100,100,100),x.car[0].position.set(132.5,75,-50),x.car[0].rotateY(Math.PI/-2),x.camGrup.add(x.car[0]);const a=new THREE.TextureLoader,n=new THREE.TextureLoader,i=new THREE.TextureLoader,d=new THREE.TextureLoader,s=new THREE.TextureLoader,l=new THREE.TextureLoader,c=new THREE.TextureLoader,u=new THREE.TextureLoader;a.load(o+"color2.jpg",(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.repeat.set(20,20);for(let t=0;t<8;t++)1!=t&&(r[t].map=e,r[t].needsUpdate=!0,r[t].wireframe=!1)})),n.load(o+"color1.jpg",(function(e){r[1].map=e,r[1].needsUpdate=!0,r[1].wireframe=!1})),x.meter=[];const m=[92.3,107.5,97.9,101.9],p=[101.7,101.7,106.7,106.7],h=[-86,-86,-87.2,-87.2],w=[],E=new THREE.PlaneGeometry(10,10),f=new THREE.PlaneGeometry(3,3),g=new THREE.PlaneGeometry(14,6.6);for(let e=0;e<2;e++)w[e]=new THREE.MeshBasicMaterial({color:16777215,alphaTest:.5}),w[e].wireframe=!0,x.meter[e]=new THREE.Mesh(E,w[e]),x.meter[e].position.set(m[e],p[e],h[e]),x.meter[e].rotateX(-.36),x.camGrup.add(x.meter[e]);for(let e=2;e<4;e++)w[e]=new THREE.MeshBasicMaterial({color:16777215,alphaTest:.5}),w[e].wireframe=!0,x.meter[e]=new THREE.Mesh(f,w[e]),x.meter[e].position.set(m[e],p[e],h[e]),x.meter[e].rotateX(-.36),x.camGrup.add(x.meter[e]);const T=new THREE.MeshBasicMaterial({color:15658734,transparent:!0});T.wireframe=!0,x.radioScr=new THREE.Mesh(g,T),x.radioScr.position.set(130,90.8,-79.8),x.radioScr.rotateX(-.27),x.radioScr.rotateZ(-.065),x.camGrup.add(x.radioScr),i.load(o+"alfa0.jpg",(function(e){for(let t=0;t<2;t++)w[t].alphaMap=e,w[t].needsUpdate=!0})),d.load(o+"meter0.jpg",(function(e){w[0].map=e,w[0].needsUpdate=!0,w[0].wireframe=!1})),s.load(o+"meter1.jpg",(function(e){w[1].map=e,w[1].needsUpdate=!0,w[1].wireframe=!1})),l.load(o+"meter2.jpg",(function(e){w[2].map=e,w[2].needsUpdate=!0,w[2].wireframe=!1})),c.load(o+"meter3.jpg",(function(e){w[3].map=e,w[3].needsUpdate=!0,w[3].wireframe=!1})),u.load(o+"radioscr.jpg",(function(e){T.map=e,T.needsUpdate=!0,T.wireframe=!1})),addMirrors()}))}function addMirrors(){let e=0;x.mirrors=[];(new OBJLoader).load("obj/car/9/mirrors.obj",(function(t){t.traverse((function(t){t.isMesh&&(0==e&&(t.geometry=BufferGeometryUtils.toCreasedNormals(t.geometry,40/180*Math.PI)),t.geometry.computeBoundingBox(),e+=1)})),x.mirrors3=new THREE.Mesh(t.children[0].geometry,new THREE.MeshPhongMaterial({color:11579568})),x.mirrors3.scale.set(100,100,100),x.mirrors3.position.set(132.5,75,-50),x.mirrors3.rotateY(Math.PI/-2),x.camGrup.add(x.mirrors3);const r=reflector(),o=reflector(),a=reflector(),n=color(16777215).mul(.5).add(r),i=color(16777215).mul(.4).add(o),d=color(16777215).mul(.4).add(a),s=(new THREE.Shape).moveTo(40,40).lineTo(40,160).absarc(60,160,20,Math.PI,0,!0).lineTo(80,40).absarc(60,40,20,2*Math.PI,Math.PI,!0),l=new THREE.ShapeGeometry(s);x.mirrors[0]=new THREE.Mesh(l,new THREE.MeshPhongNodeMaterial({colorNode:n})),x.mirrors[0].scale.set(.1,.106,.1),x.mirrors[0].position.set(141.9,123.5,-71.5),x.mirrors[0].rotateY(-.275),x.mirrors[0].rotateZ(Math.PI/2),x.mirrors[0].add(r.target),x.camGrup.add(x.mirrors[0]);const c=new THREE.Shape;!function(e,t,r,o,a,n){e.moveTo(t,r+n),e.lineTo(t,r+a-n),e.quadraticCurveTo(t,r+a,t+n,r+a),e.lineTo(t+o-n,r+a),e.quadraticCurveTo(t+o,r+a,t+o,r+a-n),e.lineTo(t+o,r+n),e.quadraticCurveTo(t+o,r,t+o-n,r),e.lineTo(t+n,r),e.quadraticCurveTo(t,r,t,r+n)}(c,0,0,78,45,20);const u=new THREE.ShapeGeometry(c);x.mirrors[1]=new THREE.Mesh(u,new THREE.MeshPhongNodeMaterial({colorNode:i})),x.mirrors[1].scale.set(.2,.2,.2),x.mirrors[1].position.set(47.5,109.5,-73.5),x.mirrors[1].rotateY(.28),x.mirrors[1].rotateX(-.1),x.mirrors[1].add(o.target),x.camGrup.add(x.mirrors[1]),x.mirrors[2]=new THREE.Mesh(u,new THREE.MeshPhongNodeMaterial({colorNode:d})),x.mirrors[2].scale.set(.2,.2,.2),x.mirrors[2].position.set(202,109.5,-77.7),x.mirrors[2].rotateY(-.29),x.mirrors[2].rotateX(-.1),x.mirrors[2].add(a.target),x.camGrup.add(x.mirrors[2]),addWheel()}))}function addWheel(){let e=0;x.wheel=[];(new OBJLoader).load("obj/car/9/wheel.obj",(function(t){t.traverse((function(t){t.isMesh&&(0==e&&(t.geometry=BufferGeometryUtils.toCreasedNormals(t.geometry,40/180*Math.PI)),t.geometry.computeBoundingBox(),e+=1)}));const r=t.children[0].geometry,o=new THREE.MeshStandardMaterial({color:16777215,roughness:.2,metalness:0});o.wireframe=!0;for(let e=0;e<1;e++)x.wheel[e]=new THREE.Mesh(r,o),x.wheel[e].scale.set(100,100,100),x.wheel[e].position.set(99.9,99.7,-67),x.wheel[e].rotateY(Math.PI/-2),x.wheel[e].rotateZ(.5),x.camGrup.add(x.wheel[e]);(new THREE.TextureLoader).load("obj/car/9/mat/color2.jpg",(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping,e.repeat.set(20,20),o.map=e,o.needsUpdate=!0,o.wireframe=!1,addLights()}))}))}function addLights(){x.spotLight=[],x.target=[];const e=[80,185];for(let t=0;t<2;t++)x.spotLight[t]=new THREE.SpotLight(16773586,8e6,970,Math.PI/10,1),x.spotLight[t].position.set(e[t],70,-250),x.camGrup.add(x.spotLight[t]),x.target[t]=new THREE.Object3D,x.target[t].position.set(x.spotLight[t].position.x,x.spotLight[t].position.y,x.spotLight[t].position.z-100),x.camGrup.add(x.target[t]),x.spotLight[t].target=x.target[t];fadeScene()}function fadeScene(){onWindowResize(),function e(){let t=parseFloat(ui.fader.style.opacity);(t-=.1)<0?(ui.fader.style.opacity=0,ui.fader.style.display="none",ui.fader.parentNode.removeChild(ui.fader),onWindowResize(),eL(ui.kontainer,0,"pointerdown",onPointerDown),eL(ui.kontainer,0,"pointermove",onPointerMove),eL(ui.kontainer,0,"click",kontainerClick),eL(ui.kontainer,0,"wheel",wheelE),x.camV3=new THREE.Vector3,theOptions(),cL(ui.loadr,0,"paus"),ui.loadr.style.display="none",ui.loadr.parentNode.removeChild(ui.loadr),renderer.setAnimationLoop(animate)):(ui.fader.style.opacity=t,requestAnimationFrame(e))}()}function theOptions(){ui.swtchKam.style.visibility="visible",isMobil?(eL(ui.swtchKam,0,"touchstart",swtchKamClick),eL(ui.onAud,0,"touchstart",audClick),eL(ui.offAud,0,"touchstart",audClick)):(eL(ui.swtchKam,0,"click",swtchKamClick),eL(ui.onAud,0,"click",audClick),eL(ui.offAud,0,"click",audClick))}function swtchKamClick(e){e&&e.preventDefault(),x.inCar=!x.inCar,x.car[0].visible=x.wheel[0].visible=x.mirrors3.visible=x.mirrors[0].visible=x.mirrors[1].visible=x.mirrors[2].visible=x.inCar,x.meter[0].visible=x.meter[1].visible=x.meter[2].visible=x.meter[3].visible=x.radioScr.visible=x.inCar;let t=-250;x.inCar?(camera.position.y=x.target0.position.y=127,_.ej[1]=-5):(t=-42,camera.position.y=x.target0.position.y=70,_.ej[1]=-1);for(let e=0;e<2;e++)x.spotLight[e].position.z=t;x.rotCam=!x.rotCam,_.idleTimer=0}function audClick(e){e&&e.preventDefault(),x.sound?x.sound.isPlaying?(cL(ui.offAud,0,"noneIt2"),cL(ui.onAud,1,"noneIt2"),x.sound.pause()):(cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2"),x.sound.play()):addAud(),_.idleTimer=0}function onPointerDown(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-e.clientY/_.height*2+1):(t.x=e.x/_.width*2-1,t.y=-e.y/_.height*2+1),_.ptrDown=!0,_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function onPointerMove(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-e.clientY/_.height*2+1):(t.x=e.x/_.width*2-1,t.y=-e.y/_.height*2+1),_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function kontainerClick(e){e&&e.preventDefault(),_.idleTimer=0}function wheelE(e){e&&e.preventDefault(),_.idleTimer=0}function onWindowResize(){_.width=window.innerWidth,_.height=window.innerHeight,isMobil&&(_.width==_.prevW&&(_.width=_.prevH,_.height=_.prevW),_.prevW=_.width,_.prevH=_.height),_.widthH=_.width/2,_.heightH=_.height/2,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",camera.aspect=_.width/_.height,camera.updateProjectionMatrix(),renderer.setSize(_.width,_.height),x.zz=450,_.width>_.height?(cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.022+"px",x.zz=450):(cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.028+"px",x.zz=600),_.idleTimer=0}function animWalk(){let e=x.camGrup.position.z,t=x.target0.position.z;e>_.ej[0]?(x.camGrup.position.z=e+_.ej[1],x.target0.position.z=t+_.ej[1]):(x.camGrup.position.z=_.ej[3],x.target0.position.z=_.ej[3]-120,x.currGrup=0==x.currGrup?1:0)}function animate(){if(_.idleTimer<idleTO){clock.running||clock.start();const e=.001*Date.now();camera.lookAt(x.target0.position),camera.rotation.z=.001*Math.sin(2*e),camera.position.y+=.02*Math.sin(3*e),x.wheel[0].rotateX(.001*Math.sin(5*e)),isMobil?(camera.rotation.x=Math.sin(.3*e)*Math.PI/10,camera.rotation.y=Math.cos(.4*e)*Math.PI/7):(camera.rotation.x=_.pointer.y*Math.PI/10,camera.rotation.y=_.pointer.x*Math.PI/-7),x.radioScr.material.opacity=.3*Math.random()+.7,animWalk(),_.idleTimer+=.01,render()}else clock.running&&clock.stop(),x.sound&&x.sound.isPlaying&&x.sound.pause();document.hasFocus()?_.fokus||(_.idleTimer=0,_.fokus=!0,x.sound&&(x.sound.isPlaying||x.sound.play())):(_.idleTimer=idleTO,_.fokus=!1,x.sound&&x.sound.isPlaying&&x.sound.pause())}function render(){renderer.render(scene,camera)}function animFBX(){let e="teenb1/char1";e+=".fbx";(new FBXLoader).load("obj/teenb1/char1.fbx",(function(e){e.traverse((function(e){e.isMesh&&(e.geometry.computeBoundingBox(),e.castShadow=!0,e.receiveShadow=!0,"Hatsmesh"!=e.geometry.name&&"Shoesmesh"!=e.geometry.name||(e.frustumCulled=!1))})),x.char1=e;let t=[],r="obj/teenb1/mat/",o="jpg";for(let e=0;e<7;e++)t[e]=new THREE.MeshStandardMaterial({color:16777215,roughness:.6,metalness:0}),x.char1.children[e].material=t[e];t[1].transparent=!0,t[1].opacity=0;let a=new THREE.TextureLoader,n=new THREE.TextureLoader,i=new THREE.TextureLoader,d=new THREE.TextureLoader,s=new THREE.TextureLoader,l=(new THREE.TextureLoader,new THREE.TextureLoader),c=new THREE.TextureLoader,u=new THREE.TextureLoader,m=new THREE.TextureLoader,p=new THREE.TextureLoader;new THREE.TextureLoader;a.load(r+"bottomd."+o,(function(e){t[2].map=e,t[2].needsUpdate=!0})),n.load(r+"bodyd."+o,(function(e){t[0].map=t[3].map=e,t[0].needsUpdate=t[3].needsUpdate=!0})),i.load(r+"hatd."+o,(function(e){t[4].map=e,t[4].needsUpdate=!0})),d.load(r+"shoesd."+o,(function(e){t[5].map=e,t[5].needsUpdate=!0})),s.load(r+"topd."+o,(function(e){t[6].map=e,t[6].needsUpdate=!0})),l.load(r+"bottomn."+o,(function(e){t[2].normalMap=e,t[2].needsUpdate=!0})),c.load(r+"bodyn."+o,(function(e){t[3].normalMap=e,t[3].needsUpdate=!0})),u.load(r+"hatn."+o,(function(e){t[4].normalMap=e,t[4].needsUpdate=!0})),m.load(r+"shoesn."+o,(function(e){t[5].roughness=.4,t[5].normalMap=e,t[5].needsUpdate=!0})),p.load(r+"topn."+o,(function(e){t[6].normalMap=e,t[6].needsUpdate=!0}));x.char1.scale.set(.8,.8,.8),x.char1.position.set(0,-1.2,-300),x.char1.rotation.set(0,Math.PI,0),x.camGrup.add(x.char1),anim8()}))}function anim8(){x.actions=[];let e="teenb1/walkswag";e+=".fbx";(new FBXLoader).load("obj/teenb1/walkswag.fbx",(function(e){mixer=new THREE.AnimationMixer(x.char1),x.actions[0]=mixer.clipAction(e.animations[0]),x.actions[0].play(),mixer.update(0),fadeScene()}))}function addAud(){if(!x.sound){let e="nghtdrv";e+=".mp3";const t=new THREE.AudioListener;camera.add(t),x.sound=new THREE.Audio(t);(new THREE.AudioLoader).load("aud/"+e,(function(e){x.sound.setBuffer(e),x.sound.setLoop(!0),x.sound.setVolume(.8),x.sound.play(),cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2")}))}}
	