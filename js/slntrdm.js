/**
 * author Armstrong "Army" Chiu
 * URL: https://thewebdesignerpro.com/     
 */
 
 
import*as THREE from"three";import WebGL from"three/addons/capabilities/WebGL.js";import{OBJLoader}from"three/addons/loaders/OBJLoader.js";import{FBXLoader}from"three/addons/loaders/FBXLoader.js";import{Water}from"three/addons/objects/Water.js";const idleTO=120,florY=0,ceilY=140;let camera,scene,renderer,clock;const grups=[];let mixer,isMobil=!1,mouseX=0,mouseY=-50;const ui={},_={},x={};if(WebGL.isWebGL2Available())window.addEventListener?window.addEventListener("load",init,!1):window.attachEvent?window.attachEvent("onload",init):window.onload=init;else{const e=WebGL.getWebGL2ErrorMessage();kontainer.appendChild(e),kontainer.style.background="url('img/silentroadl.jpg') center top no-repeat",kontainer.style.backgroundSize="cover",fader.style.opacity=0,fader.style.display="none",fader.parentNode.removeChild(fader),cL(loadr,0,"paus"),loadr.style.display="none",loadr.parentNode.removeChild(loadr)}function eL(e,t,o,n){0==t?e.addEventListener(o,n,!1):e.removeEventListener(o,n,!1)}function cL(e,t,o){0==t?e.classList.contains(o)||e.classList.add(o):e.classList.contains(o)&&e.classList.remove(o)}function init(){function e(e){return document.getElementById(e)}ui.kontainer=e("kontainer"),ui.swtchKam=e("swtchKam"),ui.onAud=e("onAud"),ui.offAud=e("offAud"),ui.swtchKam.style.visibility="hidden",ui.loadr=e("loadr"),ui.fader=e("fader"),ui.fader.style.opacity=1;let t=document.createElement("div");t.setAttribute("id","dummy"),document.body.appendChild(t),isMobil="9000px"!=window.getComputedStyle(t,null).getPropertyValue("left"),isMobil&&(document.addEventListener("gesturechange",(function(e){e.preventDefault()}),!1),ui.kontainer.addEventListener("gesturechange",(function(e){e.preventDefault()}),!1),_.prevW=_.prevH=0),t.parentNode.removeChild(t),_.width=window.innerWidth,_.height=window.innerHeight,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",ui.kontainer.style.backgroundColor="#000000";if(_.ej=[],_.ej[0]=0,_.ej[1]=-2,_.ej[2]=Math.PI,_.ej[3]=0,_.ej[4]=0,_.ej[5]=5,renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!1}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(_.width,_.height),renderer.setClearColor(0,1),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,renderer.outputColorSpace=THREE.LinearSRGBColorSpace,renderer.sortObjects=!1,ui.kontainer.appendChild(renderer.domElement),!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float"))throw alert("OES_texture_float not supported"),"missing webgl extension";if(!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float_linear"))throw alert("OES_texture_float_linear not supported"),"missing webgl extension";scene=new THREE.Scene,x.camGrup=new THREE.Group,grups[0]=new THREE.Group,x.zz=32,camera=new THREE.PerspectiveCamera(50,_.width/_.height,1,5e3),camera.position.set(0,_.ej[5],x.zz),x.camGrup.add(camera),x.camTarget=new THREE.Object3D,x.camTarget.position.set(0,0,0),x.camGrup.add(x.camTarget),scene.add(new THREE.AmbientLight(11053224)),x.spotLcone=[],x.spotLight=[],x.spotLight[0]=new THREE.SpotLight(16777215,2800,80,Math.PI/8,1),x.spotLight[0].position.set(0,35,0),x.spotLight[0].shadow.camera.near=1,x.spotLight[0].shadow.camera.far=80,x.spotLight[0].shadow.camera.fov=40,scene.add(x.spotLight[0]),scene.add(x.camGrup),eL(window,1,"load",init),eL(window,0,"resize",onWindowResize),x.rotCam=!1,clock=new THREE.Clock,clock.autoStart=!1,_.mouse=new THREE.Vector2,_.entro=!0,_.idleTimer=0,_.fokus=!0,_.pointer=new THREE.Vector2,_.ptrDown=!1,x.currGrup=0,x.target0=new THREE.Object3D,x.target0.position.set(0,-4,0),scene.add(x.target0),x.spotLight[0].target=x.target0,addSkybox(),onWindowResize()}function addSkybox(){const e=".png",t=new THREE.CubeTextureLoader;t.setPath("img/skybox/5/"),t.load(["posx"+e,"negx"+e,"posy"+e,"negy"+e,"posz"+e,"negz"+e],(function(e){x.skybox=e,scene.background=x.skybox,addStreet(),addCar(),addPhone()}))}function addStreet(){let e=0;x.street=[];(new OBJLoader).load("obj/stage/3/street.obj",(function(t){t.traverse((function(t){t.isMesh&&(t.geometry.computeBoundingBox(),e+=1)}));const o=[],n="obj/stage/3/mat/";for(let n=0;n<e;n++)o[n]=new THREE.MeshStandardMaterial({color:16777215,roughness:.9,metalness:.9}),o[n].wireframe=!0,x.street[n]=new THREE.Mesh(t.children[n].geometry,o[n]),x.street[n].scale.set(1.1,1.1,1.1),x.street[n].position.set(0,-5.5,0),0==n?o[n].alphaTest=.5:(o[n].emissive.setHex(16777215),o[n].transparent=!0),x.street[n].castShadow=!0,x.street[n].receiveShadow=!0,grups[0].add(x.street[n]);const a=new THREE.TextureLoader,i=new THREE.TextureLoader,r=new THREE.TextureLoader,d=new THREE.TextureLoader,s=new THREE.TextureLoader,c=new THREE.TextureLoader,u=new THREE.TextureLoader,l=new THREE.TextureLoader,p=new THREE.TextureLoader,h=new THREE.TextureLoader,m=new THREE.TextureLoader,w=new THREE.TextureLoader;a.load(n+"color0.jpg",(function(e){o[1].map=e,o[1].needsUpdate=!0,o[1].wireframe=!1,addSea()})),i.load(n+"normal0.jpg",(function(e){o[1].normalMap=e,o[1].needsUpdate=!0})),r.load(n+"rough0.jpg",(function(e){o[1].roughnessMap=e,o[1].needsUpdate=!0})),d.load(n+"metal0b.jpg",(function(e){o[1].metalnessMap=e,o[1].needsUpdate=!0})),s.load(n+"emissive0.jpg",(function(e){o[1].emissiveMap=e,o[1].needsUpdate=!0})),c.load(n+"color1.jpg",(function(e){o[0].map=e,o[0].needsUpdate=!0,o[0].wireframe=!1})),u.load(n+"normal1.jpg",(function(e){o[0].normalMap=e,o[0].needsUpdate=!0})),l.load(n+"rough1.jpg",(function(e){o[0].roughnessMap=e,o[0].needsUpdate=!0})),p.load(n+"metal1.jpg",(function(e){o[0].metalnessMap=e,o[0].needsUpdate=!0})),h.load(n+"alfa1.jpg",(function(e){o[0].alphaMap=e,o[0].needsUpdate=!0})),w.load(n+"alfa0.jpg",(function(e){o[1].alphaMap=e,o[1].needsUpdate=!0})),x.spotLight[1]=new THREE.SpotLight(16775909,2e3,30,Math.PI/3.5,1),x.spotLight[1].position.set(4.97,9.5,-1.75),x.spotLight[1].castShadow=!0,x.spotLight[1].shadow.camera.near=1,x.spotLight[1].shadow.camera.far=30,x.spotLight[1].shadow.camera.fov=40,grups[0].add(x.spotLight[1]),x.target1=new THREE.Object3D,x.target1.position.set(4.97,-10,-1.75),grups[0].add(x.target1),x.spotLight[1].target=x.target1;const g=new THREE.PlaneGeometry(17.8,14),f=new THREE.MeshBasicMaterial({color:16775909,transparent:!0,opacity:.4,side:2});f.depthWrite=!1;const E=[0,Math.PI/2,Math.PI/4,Math.PI/-4,Math.PI/6,Math.PI/-6,Math.PI/8,Math.PI/-8];for(let e=0;e<1;e++)x.spotLcone[e]=new THREE.Mesh(g,f),x.spotLcone[e].position.set(5,2.2,-1.77),x.spotLcone[e].rotateY(E[e]),x.spotLcone[e].visible=!1,scene.add(x.spotLcone[e]);m.load("img/spotLconeA.png",(function(e){f.alphaMap=e,f.needsUpdate=!0;for(let e=0;e<1;e++)x.spotLcone[e].visible=!0})),scene.add(grups[0]),x.target2=new THREE.Object3D,x.target2.position.set(camera.position.x,2.2,camera.position.z),scene.add(x.target2)}))}function addCar(){let e=0;(new OBJLoader).load("obj/car/3/car.obj",(function(t){t.traverse((function(t){t.isMesh&&(t.geometry.computeBoundingBox(),t.castShadow=!0,t.receiveShadow=!0,e+=1)})),x.car=t;const o=[],n="obj/car/3/mat/";for(let t=0;t<e;t++)o[t]=new THREE.MeshStandardMaterial({color:16777215,roughness:.8,metalness:.9}),o[t].wireframe=!0,o[t].envMapIntensity=1,o[t].envMap=x.skybox,x.car.children[t].material=o[t];x.car.scale.set(1.3,1.3,1.3),x.car.position.set(-3,-5.54,0),x.car.rotation.set(0,Math.PI/-2,0),grups[0].add(x.car);const a=new THREE.TextureLoader,i=new THREE.TextureLoader,r=new THREE.TextureLoader,d=new THREE.TextureLoader;a.load(n+"color0.jpg",(function(e){o[0].map=e,o[0].needsUpdate=!0,o[0].wireframe=!1})),i.load(n+"normal0.jpg",(function(e){o[0].normalMap=e,o[0].needsUpdate=!0})),r.load(n+"rough0.jpg",(function(e){o[0].roughnessMap=e,o[0].needsUpdate=!0})),d.load(n+"metal0.jpg",(function(e){o[0].metalnessMap=e,o[0].needsUpdate=!0}))}))}function addPhone(){let e=0;x.phone=[];(new OBJLoader).load("obj/street/1/phone2.obj",(function(t){t.traverse((function(t){t.isMesh&&(t.geometry.computeBoundingBox(),e+=1)}));const o=[],n="obj/street/1/mat/";for(let n=0;n<e;n++)o[n]=new THREE.MeshStandardMaterial({color:11184810,roughness:.7,metalness:.9}),o[n].wireframe=!0,o[n].envMapIntensity=1.3,o[n].envMap=x.skybox,x.phone[n]=new THREE.Mesh(t.children[n].geometry,o[n]),x.phone[n].scale.set(.351,.351,.351),x.phone[n].position.set(-2,-5.06,-11),x.phone[n].rotation.set(0,.35,0),x.phone[n].receiveShadow=!0,x.phone[n].castShadow=!0,grups[0].add(x.phone[n]);const a=new THREE.TextureLoader,i=new THREE.TextureLoader,r=new THREE.TextureLoader,d=new THREE.TextureLoader;a.load(n+"color1.jpg",(function(e){o[0].map=e,o[0].needsUpdate=!0,o[0].wireframe=!1})),i.load(n+"normal1.jpg",(function(e){o[0].normalMap=e,o[0].needsUpdate=!0})),r.load(n+"rough1.jpg",(function(e){o[0].roughnessMap=e,o[0].needsUpdate=!0})),d.load(n+"metal1.jpg",(function(e){o[0].metalnessMap=e,o[0].needsUpdate=!0}))}))}function addSea(){const e=new THREE.PlaneGeometry(16,14);x.sea=new Water(e,{textureWidth:768,textureHeight:768,waterNormals:(new THREE.TextureLoader).load("img/water/waternormals.jpg",(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping})),sunDirection:new THREE.Vector3,sunColor:16777215,waterColor:4539717,distortionScale:5,fog:void 0!==scene.fog}),x.sea.position.set(1.9,-5.9,.4),x.sea.rotation.x=-Math.PI/2,grups[0].add(x.sea);x.sea.material.uniforms.size.value=.1,animFBX()}function fadeScene(){onWindowResize(),function e(){let t=parseFloat(ui.fader.style.opacity);(t-=.05)<0?(ui.fader.style.opacity=0,ui.fader.style.display="none",ui.fader.parentNode.removeChild(ui.fader),onWindowResize(),eL(ui.kontainer,0,"pointerdown",onPointerDown),eL(ui.kontainer,0,"pointermove",onPointerMove),animate(),theOptions(),cL(ui.loadr,0,"paus"),ui.loadr.style.display="none",ui.loadr.parentNode.removeChild(ui.loadr)):(ui.fader.style.opacity=t,requestAnimationFrame(e))}()}function theOptions(){ui.swtchKam.style.visibility="visible",isMobil?(eL(ui.swtchKam,0,"touchstart",swtchKamClick),eL(ui.onAud,0,"touchstart",audClick),eL(ui.offAud,0,"touchstart",audClick)):(eL(ui.swtchKam,0,"click",swtchKamClick),eL(ui.onAud,0,"click",audClick),eL(ui.offAud,0,"click",audClick))}function swtchKamClick(e){e&&e.preventDefault(),x.rotCam?camera.rotation.set(0,0,0):camera.rotation.set(0,Math.PI/20,0),camera.position.set(0,_.ej[5],40),x.camGrup.rotation.set(0,0,0),x.rotCam=!x.rotCam,_.idleTimer=0}function audClick(e){e&&e.preventDefault(),x.sound?x.sound.isPlaying?(cL(ui.offAud,0,"noneIt2"),cL(ui.onAud,1,"noneIt2"),x.sound.pause()):(cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2"),x.sound.play()):addAud(),_.idleTimer=0}function onPointerDown(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-e.clientY/_.height*2+1):(t.x=e.x/_.width*2-1,t.y=-e.y/_.height*2+1),_.ptrDown=!0,_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function onPointerMove(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-e.clientY/_.height*2+1):(t.x=e.x/_.width*2-1,t.y=-e.y/_.height*2+1),_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function wheelE(e){e&&e.preventDefault(),_.idleTimer=0}function onWindowResize(){_.width=window.innerWidth,_.height=window.innerHeight,isMobil&&(_.width==_.prevW&&(_.width=_.prevH,_.height=_.prevW),_.prevW=_.width,_.prevH=_.height),_.widthH=_.width/2,_.heightH=_.height/2,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",camera.aspect=_.width/_.height,camera.updateProjectionMatrix(),renderer.setSize(_.width,_.height),_.width>_.height?(cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.022+"px",x.zz=32):(cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.028+"px",x.zz=42),camera.position.z=x.zz,_.idleTimer=0}function animate(){if(requestAnimationFrame(animate),_.idleTimer<idleTO){clock.running||clock.start();const e=3e-4*Date.now(),t=.3*clock.getDelta();mixer.update(t);const o=e/2;if(x.rotCam){const t=-.008%Math.PI;camera.position.y=6*Math.sin(e)-1,camera.position.z=x.zz-Math.abs(4*Math.sin(e)),x.camGrup.rotateY(t)}else if(isMobil){const t=Math.sin(e/3)*Math.PI;camera.position.y=12*Math.sin(o)+7,camera.position.z=x.zz-Math.abs(5*Math.sin(o)),x.camGrup.rotation.y=t}else{_.pointer.y,Math.PI,_.pointer.x,Math.PI;const e=.005*_.pointer.x%Math.PI;camera.position.y=12*_.pointer.y+7,camera.position.z=x.zz-Math.abs(5*_.pointer.y),x.camGrup.rotateY(e)}_.idleTimer+=.01,render()}else clock.running&&clock.stop(),x.sound&&x.sound.isPlaying&&x.sound.pause();document.hasFocus()?_.fokus||(_.idleTimer=0,_.fokus=!0,x.sound&&(x.sound.isPlaying||x.sound.play())):(_.idleTimer=idleTO,_.fokus=!1,x.sound&&x.sound.isPlaying&&x.sound.pause())}function render(){x.rotCam||camera.lookAt(x.camTarget.position),camera.getWorldPosition(x.target2.position),x.target2.position.y=2.2,x.spotLcone[0].lookAt(x.target2.position),renderer.render(scene,camera)}function animFBX(){let e="teenb1/char1";e+=".fbx";(new FBXLoader).load("obj/teenb1/char1.fbx",(function(e){e.traverse((function(e){e.isMesh&&(e.geometry.computeBoundingBox(),e.castShadow=!0,e.receiveShadow=!0,"Hatsmesh"!=e.geometry.name&&"Shoesmesh"!=e.geometry.name||(e.frustumCulled=!1))})),x.char1=e;let t=[],o="obj/teenb1/mat/",n="jpg";for(let e=0;e<7;e++)t[e]=new THREE.MeshStandardMaterial({color:16777215,roughness:.6,metalness:0}),x.char1.children[e].material=t[e];t[1].transparent=!0,t[1].opacity=0;let a=new THREE.TextureLoader,i=new THREE.TextureLoader,r=new THREE.TextureLoader,d=new THREE.TextureLoader,s=new THREE.TextureLoader,c=(new THREE.TextureLoader,new THREE.TextureLoader),u=new THREE.TextureLoader,l=new THREE.TextureLoader,p=new THREE.TextureLoader,h=new THREE.TextureLoader;new THREE.TextureLoader;a.load(o+"bottomd."+n,(function(e){t[2].map=e,t[2].needsUpdate=!0})),i.load(o+"bodyd."+n,(function(e){t[0].map=t[3].map=e,t[0].needsUpdate=t[3].needsUpdate=!0})),r.load(o+"hatd."+n,(function(e){t[4].map=e,t[4].needsUpdate=!0})),d.load(o+"shoesd."+n,(function(e){t[5].map=e,t[5].needsUpdate=!0})),s.load(o+"topd."+n,(function(e){t[6].map=e,t[6].needsUpdate=!0})),c.load(o+"bottomn."+n,(function(e){t[2].normalMap=e,t[2].needsUpdate=!0})),u.load(o+"bodyn."+n,(function(e){t[3].normalMap=e,t[3].needsUpdate=!0})),l.load(o+"hatn."+n,(function(e){t[4].normalMap=e,t[4].needsUpdate=!0})),p.load(o+"shoesn."+n,(function(e){t[5].roughness=.4,t[5].normalMap=e,t[5].needsUpdate=!0})),h.load(o+"topn."+n,(function(e){t[6].normalMap=e,t[6].needsUpdate=!0}));const m=.03325;x.char1.scale.set(m,m,m),x.char1.position.set(7.7,-5.5,-2.2),x.char1.rotation.set(0,.5,0),grups[0].add(x.char1),anim8()}))}function anim8(){x.actions=[];let e="teenb1/lookingaround";e+=".fbx";(new FBXLoader).load("obj/teenb1/lookingaround.fbx",(function(e){mixer=new THREE.AnimationMixer(x.char1),x.actions[0]=mixer.clipAction(e.animations[0]),x.actions[0].play(),mixer.update(0),fadeScene()}))}function addAud(){if(!x.sound){let e="shintro";e+=".mp3";const t=new THREE.AudioListener;camera.add(t),x.sound=new THREE.Audio(t);(new THREE.AudioLoader).load("aud/"+e,(function(e){x.sound.setBuffer(e),x.sound.setLoop(!0),x.sound.setVolume(.7),x.sound.play(),cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2")}))}}
	