/**
 * author Armstrong "Army" Chiu
 * URL: https://thewebdesignerpro.com/     
 */
 
import*as e from"three";import i from"three/addons/capabilities/WebGL.js";import{OBJLoader as t}from"three/addons/loaders/OBJLoader.js";import{FBXLoader as n}from"three/addons/loaders/FBXLoader.js";let idleTO=120,florY=-100,ceilY=140,camera,scene,renderer,clock,grups=[],isMobil=!1,mouseX=0,mouseY=-50,mixer,ui={},win={},x={};if(!1===i.isWebGLAvailable()){let o=i.getWebGLErrorMessage();document.body.appendChild(o)}else window.addEventListener?window.addEventListener("load",init,!1):window.attachEvent?window.attachEvent("onload",init):window.onload=init;function init(){ui.kontainer=document.getElementById("kontainer");let i=document.createElement("div");if(i.setAttribute("id","dummy"),document.body.appendChild(i),(isMobil="9000px"!=window.getComputedStyle(i,null).getPropertyValue("left"))&&(document.addEventListener("gesturechange",function(e){e.preventDefault()},!1),ui.kontainer.addEventListener("gesturechange",function(e){e.preventDefault()},!1)),i.parentNode.removeChild(i),win.width=window.innerWidth,win.height=window.innerHeight,document.body.style.width=win.width+"px",document.body.style.height=win.height+"px",ui.kontainer.style.width=win.width+"px",ui.kontainer.style.height=win.height+"px",ui.kontainer.style.opacity=0,ui.kontainer.style.backgroundColor="#0x000000",win.cr=[],win.ej=[],win.ej[0]=1e3,win.ej[1]=0,win.ej[2]=0,win.ej[3]=0,win.ej[4]=0,win.ej[5]=70,(renderer=new e.WebGLRenderer({antialias:!0,alpha:!1})).setPixelRatio(window.devicePixelRatio),renderer.setSize(win.width,win.height),renderer.setClearColor(0,1),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=e.PCFSoftShadowMap,renderer.outputColorSpace=e.SRGBColorSpace,renderer.sortObjects=!1,ui.kontainer.appendChild(renderer.domElement),!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float"))throw alert("OES_texture_float not supported"),"missing webgl extension";if(!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float_linear"))throw alert("OES_texture_float_linear not supported"),"missing webgl extension";(scene=new e.Scene).fog=new e.FogExp2(0,.001),(camera=new e.PerspectiveCamera(50,win.width/win.height,1,1e4)).position.set(0,-win.ej[5],1350),scene.add(camera),scene.add(new e.AmbientLight(2105376)),x.spotLight=[],x.spotLight[0]=new e.SpotLight(16777215,35e5,5e3,Math.PI/8,1),x.spotLight[0].position.set(-1500,160,1e3),x.spotLight[0].shadow.mapSize.width=1024,x.spotLight[0].shadow.mapSize.height=1024,scene.add(x.spotLight[0]),x.spotLight[1]=new e.SpotLight(16777215,1e5,470,Math.PI/2.5,1),x.spotLight[1].position.set(0,196,0),x.spotLight[2]=new e.SpotLight(16777215,1e5,470,Math.PI/2.5,1),x.spotLight[2].position.set(0,196,0),x.spotLight[0].castShadow=x.spotLight[1].castShadow=x.spotLight[2].castShadow=!0,x.spotLight[0].shadow.camera.near=x.spotLight[1].shadow.camera.near=x.spotLight[2].shadow.camera.near=10,x.spotLight[0].shadow.camera.far=x.spotLight[1].shadow.camera.far=x.spotLight[2].shadow.camera.far=5e3,x.spotLight[0].shadow.camera.fov=x.spotLight[1].shadow.camera.fov=x.spotLight[2].shadow.camera.fov=50,onWindowResize(),window.removeEventListener("load",init,!1),window.addEventListener("resize",onWindowResize,!1),(clock=new e.Clock).autoStart=!1,grups[0]=new e.Group,addFloor(),addWormhole(),animFBX(),win.mouse=new e.Vector2,win.entro=!0,win.idleTimer=0,win.fokus=!0,win.pointer=new e.Vector2}function theOptions(){ui.swtchKam=document.getElementById("swtchKam"),ui.onAud=document.getElementById("onAud"),ui.offAud=document.getElementById("offAud"),ui.swtchKam.style.visibility="hidden",isMobil?(ui.swtchKam.addEventListener("touchstart",swtchKamClick2,!1),ui.onAud.addEventListener("touchstart",audClick,!1),ui.offAud.addEventListener("touchstart",audClick,!1)):(ui.swtchKam.addEventListener("click",swtchKamClick2,!1),ui.onAud.addEventListener("click",audClick,!1),ui.offAud.addEventListener("click",audClick,!1))}function swtchKamClick2(e){e&&e.preventDefault(),0!=win.ej[2]?(win.ej[0]=0,win.ej[1]=-1,win.ej[2]=0,win.ej[3]=1e3):(win.ej[0]=1e3,win.ej[1]=1,win.ej[2]=Math.PI,win.ej[3]=0),x.char1.rotation.y=win.ej[2],win.idleTimer=0}function audClick(e){e.preventDefault(),x.sound?x.sound.isPlaying?(ui.offAud.classList.add("noneIt2"),ui.onAud.classList.remove("noneIt2"),x.sound.pause()):(ui.onAud.classList.add("noneIt2"),ui.offAud.classList.remove("noneIt2"),x.sound.play()):addAud(),win.idleTimer=0}function addFloor(){x.floor=[];let i=new e.PlaneGeometry(1e3,1001,96,96),t=new e.MeshStandardMaterial({color:13487565,roughness:.3,metalness:.1});for(let n=0;n<3;n++){let o=-1e3+1e3*n;x.floor[n]=new e.Mesh(i,t),x.floor[n].position.set(0,-100,o),x.floor[n].rotation.x=-.5*Math.PI,x.floor[n].castShadow=!0,x.floor[n].receiveShadow=!0,grups[0].add(x.floor[n])}var a=new e.TextureLoader,r=new e.TextureLoader,s=new e.TextureLoader;new e.TextureLoader,a.load("img/spacew/terr1.jpg",function(i){i.wrapS=i.wrapT=e.RepeatWrapping;for(let t=0;t<3;t++)x.floor[t].material.map=i,x.floor[t].material.displacementScale=60,x.floor[t].material.displacementBias=-5,x.floor[t].material.displacementMap=i,x.floor[t].material.needsUpdate=!0}),r.load("img/spacew/terr1r.jpg",function(i){i.wrapS=i.wrapT=e.RepeatWrapping,i.repeat.set(2,2);for(let t=0;t<3;t++)x.floor[t].material.roughnessMap=i,x.floor[t].material.needsUpdate=!0}),s.load("img/spacew/terr1b.jpg",function(i){i.wrapS=i.wrapT=e.RepeatWrapping,i.repeat.set(2,2);for(let t=0;t<3;t++)x.floor[t].material.bumpScale=25,x.floor[t].material.bumpMap=i,x.floor[t].material.needsUpdate=!0}),scene.add(grups[0])}function addWormhole(){let i=new t;i.load("obj/spacew/wh1.obj",function(i){i.traverse(function(e){e.isMesh&&e.geometry.computeBoundingBox()}),x.wormhole=i,x.wormhole.position.set(0,400,0),x.wormhole.rotation.set(Math.PI/3,0,0),x.wormhole.scale.set(550,550,550);let t=new e.MeshBasicMaterial({color:13416372,transparent:!0,fog:!1});x.wormhole.children[0].material=t,x.wormhole.visible=!1;let n=new e.TextureLoader,o=new e.TextureLoader;n.load("obj/spacew/mat/wormholec.jpg",function(e){x.wormhole.children[0].material.map=e,x.wormhole.children[0].material.lightMap=e,x.wormhole.children[0].material.needsUpdate=!0,x.wormhole.visible=!0}),o.load("obj/spacew/mat/wormholea.png",function(e){x.wormhole.children[0].material.alphaMap=e,x.wormhole.children[0].material.needsUpdate=!0}),scene.add(x.wormhole)}),addStars()}function addStars(){let i=new e.BufferGeometry,t=[];for(let n=0;n<800;n++){let o=11e3*Math.random()-5500,a=3750*Math.random()-450,r=-1500*Math.random()-1500;t.push(o,a,r)}i.setAttribute("position",new e.Float32BufferAttribute(t,3));var s=new e.PointsMaterial({color:16777215,size:20,sizeAttenuation:!0,transparent:!0,depthWrite:!1,depthTest:!0,fog:!1});x.bitwin=new e.Points(i,s),scene.add(x.bitwin),new e.TextureLoader().load("img/spacew/bitwin1.png",function(e){x.bitwin.material.map=e,x.bitwin.material.needsUpdate=!0})}function fadeScene(){onWindowResize(),function e(){let i=parseFloat(ui.kontainer.style.opacity);(i+=.1)>1?(ui.kontainer.style.opacity=1,onWindowResize(),isMobil?(ui.kontainer.addEventListener("touchstart",onDocumentTouchStart,!1),ui.kontainer.addEventListener("touchmove",onDocumentTouchMove,!1)):(ui.kontainer.addEventListener("mousemove",onMouseMove,!1),ui.kontainer.addEventListener("click",kontainerClick,!1)),ui.kontainer.addEventListener("pointermove",onMouseMove,!1),ui.kontainer.addEventListener("wheel",wheelE,!1),animate(),theIntro(),theOptions()):(ui.kontainer.style.opacity=i,requestAnimationFrame(e))}()}function animWalk(){let e=grups[0].position.z,i=x.wormhole.rotation.y;e==win.ej[0]?grups[0].position.z=win.ej[3]:grups[0].position.z=e+win.ej[1],x.wormhole.rotation.y=i<6.28?i+.004:0}function onMouseMove(e){e&&e.preventDefault(),mouseX=e.clientX-win.widthH,mouseY=e.clientY-win.heightH,isMobil?(win.pointer.x=e.touches[0].pageX/win.width*2-1,win.pointer.y=-(2*(e.touches[0].pageY/win.height))+1):(win.pointer.x=e.clientX/win.width*2-1,win.pointer.y=-(2*(e.clientY/win.height))+1),mouseY-=50,win.idleTimer=0}function onMouseWheel(e){e.preventDefault(),win.idleTimer=0}function wheelE(e){e.preventDefault(),win.idleTimer=0}function onDocumentTouchStart(e){1===e.touches.length&&(mouseX=e.touches[0].pageX-win.widthH,mouseY=e.touches[0].pageY-win.heightH,win.pointer.x=e.touches[0].pageX/win.width*2-1,win.pointer.y=-(2*(e.touches[0].pageY/win.height))+1,win.idleTimer=0)}function onDocumentTouchMove(e){1===e.touches.length&&(mouseX=e.touches[0].pageX-win.widthH,mouseY=e.touches[0].pageY-win.heightH)}function onDocumentTouchEnd(e){1===e.touches.length&&(win.pointer.x=e.touches[0].pageX/win.width*2-1,win.pointer.y=-(2*(e.touches[0].pageY/win.height))+1,ui.kontainer.removeEventListener("touchmove",onDocumentTouchMove,!1),ui.kontainer.removeEventListener("touchend",onDocumentTouchEnd,!1),win.idleTimer=0)}function kontainerClick(e){e.preventDefault(),win.idleTimer=0}function onWindowResize(){if(win.width=window.innerWidth,win.height=window.innerHeight,isMobil){let e=document.documentElement.getBoundingClientRect(),i=document.documentElement.clientWidth,t=document.documentElement.clientHeight;if(e)win.width=e.width,win.height=e.height;else if(i)win.width=i,win.height=t;else{let n=win.width;win.width=win.height,win.height=n}}win.widthH=win.width/2,win.heightH=win.height/2,document.body.style.width=ui.kontainer.style.width=win.width+"px",document.body.style.height=ui.kontainer.style.height=win.height+"px",camera.aspect=win.width/win.height,camera.updateProjectionMatrix(),renderer.setSize(win.width,win.height),isMobil?(win.cr[1]=-.0006,win.cr[0]=4e-4):(win.cr[1]=-.00024,win.cr[0]=48e-5),win.width>win.height?cntnt.style.fontSize=cntnt2.style.fontSize=(win.width+win.height)/2*.022+"px":cntnt.style.fontSize=cntnt2.style.fontSize=(win.width+win.height)/2*.028+"px",win.idleTimer=0}function animate(){if(requestAnimationFrame(animate),win.idleTimer<120){clock.running||clock.start();let e=.004*Date.now();mixer.update(win.ej[4]),animWalk(),camera.position.x=3.5*Math.cos(1*e)*win.ej[1],camera.position.y=5*Math.sin(2*e)*win.ej[1]-win.ej[5],win.idleTimer+=.01,render()}else clock.running&&clock.stop(),x.sound&&x.sound.isPlaying&&x.sound.pause();document.hasFocus()?win.fokus||(win.idleTimer=0,win.fokus=!0,x.sound&&!x.sound.isPlaying&&x.sound.play()):(win.idleTimer=120,win.fokus=!1,x.sound&&x.sound.isPlaying&&x.sound.pause())}function render(){camera.rotation.y=(mouseX-camera.position.x)*win.cr[1],camera.rotation.x=(-mouseY-camera.position.y)*win.cr[0],renderer.render(scene,camera)}function animFBX(){let i="spacew/astro1";i+=".fbx";let t=new n;t.load("obj/"+i,function(i){i.traverse(function(e){e.isMesh&&(e.geometry.computeBoundingBox(),e.castShadow=!0,e.receiveShadow=!0)}),x.char1=i;let t=[],n="obj/spacew/mat/",o=[16777215,16777215,12303291,12303291,10066329,10592673,10592673,16775402,11184827,3355443,13417335,13417335,3355443,3355443,13417335,13417335,3355443,14540253,11184827];for(let a=0;a<2;a++)0==a?t[a]=new e.MeshStandardMaterial({color:o[a],roughness:0,metalness:.65}):t[a]=new e.MeshStandardMaterial({color:o[a],roughness:.4,metalness:.2});x.char1.children[0].material=new e.MeshStandardMaterial({color:16777215,roughness:.8,metalness:.2});let r=new e.TextureLoader,s=new e.TextureLoader;r.load(n+"astrod.jpg",function(e){x.char1.children[0].material.map=e,x.char1.children[0].material.needsUpdate=!0}),s.load(n+"astror.jpg",function(e){x.char1.children[0].material.roughnessMap=e,x.char1.children[0].material.needsUpdate=!0}),x.char1.scale.set(35,35,35),x.char1.position.set(0,-100,1150),x.char1.rotation.set(0,Math.PI,0),scene.add(x.char1),x.spotLight[0].target=x.char1,anim8()})}function anim8(){x.actions=[];let i="spacew/jog1";i+=".fbx";let t=new n;t.load("obj/"+i,function(i){mixer=new e.AnimationMixer(x.char1),x.actions[0]=mixer.clipAction(i.animations[0]),anim8B()})}function anim8B(){let i="spacew/getup1";i+=".fbx";let t=new n;t.load("obj/"+i,function(i){x.actions[1]=mixer.clipAction(i.animations[0]),x.actions[1].play(),x.actions[1].setLoop(e.LoopOnce),fadeScene()})}function theIntro(){win.inCtr=0,function e(){let i=parseInt(win.inCtr);(i+=1)>470||(win.ej[5]-=.0854,200==i&&(win.ej[4]=.0116),400==i&&x.actions[0].play(),410==i&&(swtchKamClick2(),ui.swtchKam.style.visibility="visible",win.ej[5]=35),460==i&&x.actions[1].stop(),win.inCtr=i,requestAnimationFrame(e))}()}function addAud(){if(!x.sound){let i="csmcglw";i+=".mp3";let t=new e.AudioListener;camera.add(t),x.sound=new e.Audio(t);let n=new e.AudioLoader;n.load("aud/"+i,function(e){x.sound.setBuffer(e),x.sound.setLoop(!0),x.sound.setVolume(.8),x.sound.play(),ui.onAud.classList.add("noneIt2"),ui.offAud.classList.remove("noneIt2")})}}


	