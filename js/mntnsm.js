/**
 * author Armstrong "Army" Chiu
 * URL: https://thewebdesignerpro.com/     
 */
 
 
import*as THREE from"three";import WebGL from"three/addons/capabilities/WebGL.js";import{OBJLoader}from"three/addons/loaders/OBJLoader.js";import{Water}from"three/addons/objects/Water.js";import{Lensflare,LensflareElement}from"three/addons/objects/Lensflare.js";const idleTO=120,florY=-1,ceilY=140;let camera,scene,renderer,clock;const grups=[];let mixer,isMobil=!1,mouseX=0,mouseY=-50;const ui={},_={},x={};let controls;if(WebGL.isWebGL2Available())window.addEventListener?window.addEventListener("load",init,!1):window.attachEvent?window.attachEvent("onload",init):window.onload=init;else{const e=WebGL.getWebGL2ErrorMessage();kontainer.appendChild(e),kontainer.style.background="url('img/mountainsl.jpg') center top no-repeat",kontainer.style.backgroundSize="cover",fader.style.opacity=0,fader.style.display="none",fader.parentNode.removeChild(fader),cL(loadr,0,"paus"),loadr.style.display="none",loadr.parentNode.removeChild(loadr)}function eL(e,t,n,o){0==t?e.addEventListener(n,o,!1):e.removeEventListener(n,o,!1)}function cL(e,t,n){0==t?e.classList.contains(n)||e.classList.add(n):e.classList.contains(n)&&e.classList.remove(n)}function init(){function e(e){return document.getElementById(e)}ui.kontainer=e("kontainer"),ui.swtchKam=e("swtchKam"),ui.onAud=e("onAud"),ui.offAud=e("offAud"),ui.swtchKam.style.visibility="hidden",ui.loadr=e("loadr"),ui.fader=e("fader"),ui.fader.style.opacity=1;let t=document.createElement("div");t.setAttribute("id","dummy"),document.body.appendChild(t),isMobil="9000px"!=window.getComputedStyle(t,null).getPropertyValue("left"),isMobil&&(document.addEventListener("gesturechange",(function(e){e.preventDefault()}),!1),ui.kontainer.addEventListener("gesturechange",(function(e){e.preventDefault()}),!1),_.prevW=_.prevH=0),t.parentNode.removeChild(t),_.width=window.innerWidth,_.height=window.innerHeight,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",ui.kontainer.style.backgroundColor="#eaeff2";if(_.ej=[],_.ej[0]=0,_.ej[1]=-1,_.ej[2]=Math.PI,_.ej[3]=0,_.ej[4]=0,_.ej[5]=100,x.zz=450,renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!1}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(_.width,_.height),renderer.setClearColor(15396850,1),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.PCFSoftShadowMap,renderer.toneMapping=THREE.ACESFilmicToneMapping,renderer.outputColorSpace=THREE.LinearSRGBColorSpace,ui.kontainer.appendChild(renderer.domElement),!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float"))throw alert("OES_texture_float not supported"),"missing webgl extension";if(!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float_linear"))throw alert("OES_texture_float_linear not supported"),"missing webgl extension";scene=new THREE.Scene,x.camGrup=new THREE.Group,grups[0]=new THREE.Group,grups[1]=new THREE.Group,camera=new THREE.PerspectiveCamera(50,_.width/_.height,.5,2e4),camera.position.set(0,_.ej[5],220),x.camGrup.add(camera),scene.add(new THREE.AmbientLight(13487565)),x.spotLight=[],x.spotLight[0]=new THREE.SpotLight(16775133,5e6,7e3,Math.PI/8,1),x.spotLight[0].position.set(-3200,2e3,2900),x.spotLight[0].shadow.camera.near=1,x.spotLight[0].shadow.camera.far=7e3,x.spotLight[0].shadow.camera.fov=50,scene.add(x.spotLight[0]),scene.add(x.camGrup),eL(window,1,"load",init),eL(window,0,"resize",onWindowResize),clock=new THREE.Clock,clock.autoStart=!1,_.mouse=new THREE.Vector2,_.entro=!0,_.idleTimer=0,_.fokus=!0,_.pointer=new THREE.Vector2,_.ptrDown=!1,x.currGrup=0,x.target0=new THREE.Object3D,x.target0.position.set(0,_.ej[5],0),scene.add(x.target0),x.target1=new THREE.Object3D,x.target1.position.set(0,0,500),scene.add(x.target1),x.spotLight[0].target=x.target1,x.rotCam=!1,addSkybox(),addSun(),onWindowResize()}function addSkybox(){const e=".jpg",t=new THREE.CubeTextureLoader;t.setPath("img/skybox/7/"),t.load(["posx2"+e,"negx2"+e,"posy"+e,"negy"+e,"posz2"+e,"negz2"+e],(function(e){x.skybox=e,scene.background=x.skybox,addMountain()}))}function addSun(){let e=new THREE.TextureLoader;const t=(new THREE.TextureLoader).load("img/sun/flare3.jpg",(function(e){}));e.load("img/sun/color1.jpg",(function(e){const n=new Lensflare;n.addElement(new LensflareElement(e,700,0,x.spotLight[0].color)),n.addElement(new LensflareElement(t,60,.4)),n.addElement(new LensflareElement(t,90,.5)),n.addElement(new LensflareElement(t,140,.6)),n.addElement(new LensflareElement(t,90,.7)),x.spotLight[0].add(n)}))}function addMountain(){let e=0;x.mountain=[];(new OBJLoader).load("obj/mountain/0/deci40.obj",(function(t){t.traverse((function(t){t.isMesh&&(t.geometry.computeBoundingBox(),e+=1)}));const n="obj/mountain/0/mat/",o=t.children[0].geometry,i=new THREE.MeshBasicMaterial({color:16777215});i.transparent=!0,i.wireframe=!0;for(let t=0;t<e;t++)x.mountain[t]=new THREE.Mesh(o,i),x.mountain[t].scale.set(14,14,14),x.mountain[t].rotation.set(Math.PI/-2,0,0),grups[0].add(x.mountain[t]);scene.add(grups[0]);const a=new THREE.TextureLoader,r=new THREE.TextureLoader;a.load(n+"color1.jpg",(function(e){i.map=e,i.needsUpdate=!0,i.wireframe=!1})),r.load(n+"alfa2.jpg",(function(e){i.alphaMap=e,i.needsUpdate=!0}));const d=new THREE.PlaneGeometry(1720,1720),s=new THREE.MeshBasicMaterial({color:11059424});s.alphaTest=.5,s.wireframe=!0;const l=new THREE.Mesh(d,s);l.position.set(222,15.5,-196.7),l.rotation.set(Math.PI/-2,0,0),grups[0].add(l);(new THREE.TextureLoader).load(n+"alfa3b.jpg",(function(e){s.alphaMap=e,s.needsUpdate=!0,s.wireframe=!1})),addSea()}))}function addSea(){const e=new THREE.PlaneGeometry(800,1067);x.sea=new Water(e,{textureWidth:600,textureHeight:800,waterNormals:(new THREE.TextureLoader).load("img/water/waternormals.jpg",(function(e){e.wrapS=e.wrapT=THREE.RepeatWrapping})),sunDirection:new THREE.Vector3,sunColor:16777215,waterColor:0,distortionScale:13,fog:void 0!==scene.fog}),x.sea.position.set(220,15,-210),x.sea.rotation.x=-Math.PI/2,x.sea.rotation.z=-.08,scene.add(x.sea);x.sea.material.uniforms.size.value=.04,addPath()}function addPath(){const e=new THREE.CatmullRomCurve3([new THREE.Vector3(-316.5808140702278,256.4744522790937,-324.91650768606974),new THREE.Vector3(67.45237648150055,471.1285811278058,-1129.5967237462055),new THREE.Vector3(862.1581789974574,585.9987960223925,-291.33382028178585),new THREE.Vector3(1073.5003155909974,616.1989419474692,1204.873524919489),new THREE.Vector3(-423.4966040412753,459.3841182725514,1337.1044679724512),new THREE.Vector3(-1340.4623153573584,667.9456156944927,890.1854662853599)]);e.curveType="centripetal",e.closed=!0,x.points=e.getPoints(2e3),x.camFlight=0,x.ptsLength=x.points.length,fadeScene()}function fadeScene(){onWindowResize(),function e(){let t=parseFloat(ui.fader.style.opacity);(t-=.05)<0?(ui.fader.style.opacity=0,ui.fader.style.display="none",ui.fader.parentNode.removeChild(ui.fader),onWindowResize(),eL(ui.kontainer,0,"pointerdown",onPointerDown),eL(ui.kontainer,0,"pointermove",onPointerMove),x.camV3=new THREE.Vector3,animate(),theOptions(),cL(ui.loadr,0,"paus"),ui.loadr.style.display="none",ui.loadr.parentNode.removeChild(ui.loadr),x.fogIdx=0,x.fogInc=1):(ui.fader.style.opacity=t,requestAnimationFrame(e))}()}function theOptions(){ui.swtchKam.style.visibility="visible",isMobil?(eL(ui.swtchKam,0,"touchstart",swtchKamClick),eL(ui.onAud,0,"touchstart",audClick),eL(ui.offAud,0,"touchstart",audClick)):(eL(ui.swtchKam,0,"click",swtchKamClick),eL(ui.onAud,0,"click",audClick),eL(ui.offAud,0,"click",audClick))}function swtchKamClick(e){e&&e.preventDefault(),x.rotCam=!x.rotCam,x.camGrup.rotation.set(0,0,0),camera.position.x=0,_.idleTimer=0}function audClick(e){e&&e.preventDefault(),x.sound?x.sound.isPlaying?(cL(ui.offAud,0,"noneIt2"),cL(ui.onAud,1,"noneIt2"),x.sound.pause()):(cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2"),x.sound.play()):addAud(),_.idleTimer=0}function onPointerDown(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-e.clientY/_.height*2+1):(t.x=e.x/_.width*2-1,t.y=-e.y/_.height*2+1),_.ptrDown=!0,_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function onPointerMove(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-e.clientY/_.height*2+1):(t.x=e.x/_.width*2-1,t.y=-e.y/_.height*2+1),_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function wheelE(e){e&&e.preventDefault(),_.idleTimer=0}function onWindowResize(){_.width=window.innerWidth,_.height=window.innerHeight,isMobil&&(_.width==_.prevW&&(_.width=_.prevH,_.height=_.prevW),_.prevW=_.width,_.prevH=_.height),_.widthH=_.width/2,_.heightH=_.height/2,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",camera.aspect=_.width/_.height,camera.updateProjectionMatrix(),renderer.setSize(_.width,_.height),x.zz=450,_.width>_.height?(cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.022+"px",x.zz=450):(cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.028+"px",x.zz=600),_.idleTimer=0}function animate(){if(requestAnimationFrame(animate),_.idleTimer<idleTO){clock.running||clock.start();const e=.001*Date.now();if(x.rotCam)if(x.camFlight>=0){if(x.camFlight%1==0){const e=Math.round(x.camFlight);camera.position.set(x.points[e].x,x.points[e].y,x.points[e].z),e-1>=0&&camera.lookAt(x.points[e-1])}x.camFlight-=.5}else x.camFlight=x.ptsLength-1;else isMobil?(x.camGrup.rotation.y=Math.sin(.08*e)*Math.PI,camera.position.y=500*(Math.cos(.1*e)+.88)+100,camera.position.z=830*(Math.cos(.1*e)+1)+220):(x.camGrup.rotation.y=Math.sin(_.pointer.x)*Math.PI,camera.position.y=500*(_.pointer.y+1)+40,camera.position.z=830*(_.pointer.y+1)+220),camera.lookAt(x.target0.position);x.sea.material.uniforms.time.value-=.001,_.idleTimer+=.01,render()}else clock.running&&clock.stop(),x.sound&&x.sound.isPlaying&&x.sound.pause();document.hasFocus()?_.fokus||(_.idleTimer=0,_.fokus=!0,x.sound&&(x.sound.isPlaying||x.sound.play())):(_.idleTimer=idleTO,_.fokus=!1,x.sound&&x.sound.isPlaying&&x.sound.pause())}function render(){renderer.render(scene,camera)}function addAud(){if(!x.sound){let e="mntns";e+=".mp3";const t=new THREE.AudioListener;camera.add(t),x.sound=new THREE.Audio(t);(new THREE.AudioLoader).load("aud/"+e,(function(e){x.sound.setBuffer(e),x.sound.setLoop(!0),x.sound.setVolume(.9),x.sound.play(),cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2")}))}}
	