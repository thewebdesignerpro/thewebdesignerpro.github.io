/**
 * author Armstrong "Army" Chiu
 * URL: https://thewebdesignerpro.com/     
 */
 
 
import*as e from"three";import t from"three/addons/capabilities/WebGL.js";import{OBJLoader as i}from"three/addons/loaders/OBJLoader.js";let idleTO=120,florY=-10,ceilY=140,camera,scene,renderer,clock,grups=[],isMobil=!1,mouseX=0,mouseY=-50,mixer,ui={},_={},x={};if(t.isWebGL2Available())window.addEventListener?window.addEventListener("load",init,!1):window.attachEvent?window.attachEvent("onload",init):window.onload=init;else{let a=t.getWebGL2ErrorMessage();kontainer.appendChild(a),kontainer.style.background="url('img/spacesiml.jpg') center top no-repeat",kontainer.style.backgroundSize="cover",fader.style.opacity=0,fader.style.display="none",fader.parentNode.removeChild(fader),cL(loadr,0,"paus"),loadr.style.display="none",loadr.parentNode.removeChild(loadr)}function eL(e,t,i,a){0==t?e.addEventListener(i,a,!1):e.removeEventListener(i,a,!1)}function cL(e,t,i){0==t?e.classList.contains(i)||e.classList.add(i):e.classList.contains(i)&&e.classList.remove(i)}function init(){function t(e){return document.getElementById(e)}ui.kontainer=t("kontainer"),ui.onAud=t("onAud"),ui.offAud=t("offAud"),ui.loadr=t("loadr"),ui.fader=t("fader"),ui.fader.style.opacity=1;let i=document.createElement("div");if(i.setAttribute("id","dummy"),document.body.appendChild(i),(isMobil="9000px"!=window.getComputedStyle(i,null).getPropertyValue("left"))&&(document.addEventListener("gesturechange",function(e){e.preventDefault()},!1),ui.kontainer.addEventListener("gesturechange",function(e){e.preventDefault()},!1),_.prevW=_.prevH=0),i.parentNode.removeChild(i),_.width=window.innerWidth,_.height=window.innerHeight,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",ui.kontainer.style.backgroundColor="#000000",_.ej=[],_.ej[0]=0,_.ej[1]=-1,_.ej[2]=Math.PI,_.ej[3]=7233,_.ej[4]=0,_.ej[5]=0,x.xx=400,(renderer=new e.WebGLRenderer({antialias:!0,alpha:!1})).setPixelRatio(window.devicePixelRatio),renderer.setSize(_.width,_.height),renderer.setClearColor(0,1),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=e.PCFSoftShadowMap,renderer.outputColorSpace=e.LinearSRGBColorSpace,renderer.sortObjects=!1,ui.kontainer.appendChild(renderer.domElement),!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float"))throw alert("OES_texture_float not supported"),"missing webgl extension";if(!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float_linear"))throw alert("OES_texture_float_linear not supported"),"missing webgl extension";scene=new e.Scene,x.camGrup=new e.Group,grups[0]=new e.Group,grups[1]=new e.Group,(camera=new e.PerspectiveCamera(50,_.width/_.height,.5,2e4)).position.set(0,_.ej[5],-100),x.camGrup.add(camera),scene.add(new e.AmbientLight(6184542)),x.spotLight=[],x.spotLight[0]=new e.SpotLight(16777215,22e6,7e3,Math.PI/32,1),x.spotLight[0].position.set(0,3e3,7133),x.spotLight[0].castShadow=!0,x.spotLight[0].shadow.mapSize.width=256,x.spotLight[0].shadow.mapSize.height=256,x.spotLight[0].shadow.camera.near=1,x.spotLight[0].shadow.camera.far=7e3,x.spotLight[0].shadow.camera.fov=50,x.spotLight[0].shadow.intensity=.8,scene.add(x.spotLight[0]);let a=new e.DirectionalLight(16777215,3);a.castShadow=!0,a.shadow.camera.far=7500,a.shadow.camera.left=-7500,a.shadow.camera.bottom=-7500,a.shadow.camera.right=7500,a.shadow.camera.top=7500,a.position.set(0,1e3,0),a.shadow.intensity=.9,x.camGrup.position.set(0,0,_.ej[3]),scene.add(x.camGrup),eL(window,1,"load",init),eL(window,0,"resize",onWindowResize),(clock=new e.Clock).autoStart=!1,_.mouse=new e.Vector2,_.entro=!0,_.idleTimer=0,_.fokus=!0,_.pointer=new e.Vector2,_.ptrDown=!1,x.currGrup=0,x.target0=new e.Object3D,x.target0.position.set(0,_.ej[5]/2,x.camGrup.position.z-300),scene.add(x.target0),addSkybox(),onWindowResize()}function addSkybox(){let t=".png",i=new e.CubeTextureLoader;i.setPath("img/skybox/5/"),i.load(["posx"+t,"negx"+t,"posy"+t,"negy"+t,"posz"+t,"negz"+t],function(e){x.skybox=e,scene.background=x.skybox,addStarfields()})}function addStarfields(){let t=[];x.starField=[],x.starMater=[];let i=[0,Math.PI/4];t[0]=new e.CylinderGeometry(10,500,15e3,24,1,!0),t[1]=new e.CylinderGeometry(30,1500,15e3,24,1,!0);for(let a=0;a<2;a++)x.starMater[a]=new e.MeshBasicMaterial({color:16777215,side:1}),x.starMater[a].transparent=!0,x.starMater[a].alphaTest=.5,x.starField[a]=new e.Mesh(t[a],x.starMater[a]),x.starField[a].rotation.set(-Math.PI/2,i[a],0),scene.add(x.starField[a]);let n=new e.TextureLoader,o=new e.TextureLoader;n.load("img/starz.jpg",function(t){t.wrapS=t.wrapT=e.RepeatWrapping,t.repeat.set(8,2),x.starMater[0].map=x.starMater[0].alphaMap=t,x.starMater[0].needsUpdate=!0}),o.load("img/starz.jpg",function(t){t.wrapS=t.wrapT=e.RepeatWrapping,t.repeat.set(16,4),x.starMater[1].map=x.starMater[1].alphaMap=t,x.starMater[1].needsUpdate=!0}),addCockpit()}function addCockpit(){let t=0,a=new i;a.load("obj/ship/0/cckpt.obj",function(i){i.traverse(function(e){e.isMesh&&(e.geometry.computeBoundingBox(),(0==t||2==t||6==t||8==t)&&(e.castShadow=!0,e.receiveShadow=!0),6==t&&e.position.set(0,-40,55),3==t&&e.position.set(0,-90,77.7),t+=1)}),x.cockpit=i;let a=[],n="obj/ship/0/mat/";for(let o=0;o<t;o++)3==o||5==o||9==o?a[o]=new e.MeshBasicMaterial({color:16777215}):a[o]=new e.MeshStandardMaterial({color:16777215,roughness:.9,metalness:0}),x.cockpit.children[o].material=a[o],(0==o||2==o||6==o||8==o)&&(a[o].metalness=1,a[o].emissive.set(16777215)),(1==o||4==o||7==o)&&(a[o].transparent=!0,a[o].opacity=.5,a[o].side=2,a[o].metalness=1,a[o].envMap=x.skybox),(3==o||5==o||9==o)&&(a[o].transparent=!0);grups[0].position.set(0,-50,7100),grups[0].rotation.set(-(Math.PI/2),0,Math.PI),grups[0].add(x.cockpit),scene.add(grups[0]),x.spotLight[0].target=x.cockpit;let r=new e.TextureLoader,d=new e.TextureLoader,s=new e.TextureLoader,c=new e.TextureLoader,l=new e.TextureLoader,p=new e.TextureLoader,$=new e.TextureLoader,u=new e.TextureLoader,h=new e.TextureLoader,f=new e.TextureLoader,m=new e.TextureLoader;c.load(n+"color2.jpg",function(e){let t=[1,4,7];for(let i=0;i<3;i++)x.cockpit.children[t[i]].material.map=e,x.cockpit.children[t[i]].material.needsUpdate=!0}),l.load(n+"rough2.jpg",function(e){let t=[1,4,7];for(let i=0;i<3;i++)x.cockpit.children[t[i]].material.roughnessMap=e,x.cockpit.children[t[i]].material.needsUpdate=!0}),p.load(n+"metal2.jpg",function(e){let t=[1,4,7];for(let i=0;i<3;i++)x.cockpit.children[t[i]].material.metalnessMap=e,x.cockpit.children[t[i]].material.needsUpdate=!0}),$.load(n+"color1.jpg",function(e){let t=[0,2,6,8];for(let i=0;i<4;i++)x.cockpit.children[t[i]].material.map=e,x.cockpit.children[t[i]].material.needsUpdate=!0}),u.load(n+"normal1.jpg",function(e){let t=[0,2,6,8];for(let i=0;i<4;i++)x.cockpit.children[t[i]].material.normalMap=e,x.cockpit.children[t[i]].material.needsUpdate=!0}),h.load(n+"rough1.jpg",function(e){let t=[0,2,6,8];for(let i=0;i<4;i++)x.cockpit.children[t[i]].material.roughnessMap=e,x.cockpit.children[t[i]].material.needsUpdate=!0}),f.load(n+"metal1.jpg",function(e){let t=[0,2,6,8];for(let i=0;i<4;i++)x.cockpit.children[t[i]].material.metalnessMap=e,x.cockpit.children[t[i]].material.needsUpdate=!0}),m.load(n+"emissive1.jpg",function(e){let t=[0,2,6,8];for(let i=0;i<4;i++)x.cockpit.children[t[i]].material.emissiveMap=e,x.cockpit.children[t[i]].material.needsUpdate=!0}),r.load(n+"screen1a.jpg",function(e){x.cockpit.children[3].material.map=e,x.cockpit.children[3].material.needsUpdate=!0}),d.load(n+"screen2a.jpg",function(e){x.cockpit.children[5].material.map=e,x.cockpit.children[5].material.needsUpdate=!0}),s.load(n+"screen3a.jpg",function(e){x.cockpit.children[9].material.map=e,x.cockpit.children[9].material.needsUpdate=!0}),fadeScene()})}function fadeScene(){onWindowResize(),function t(){let i=parseFloat(ui.fader.style.opacity);(i-=.05)<0?(ui.fader.style.opacity=0,ui.fader.style.display="none",ui.fader.parentNode.removeChild(ui.fader),onWindowResize(),eL(ui.kontainer,0,"pointerdown",onPointerDown),eL(ui.kontainer,0,"pointermove",onPointerMove),x.camV3=new e.Vector3,animate(),theOptions(),cL(ui.loadr,0,"paus"),ui.loadr.style.display="none",ui.loadr.parentNode.removeChild(ui.loadr),x.fogIdx=0,x.fogInc=1):(ui.fader.style.opacity=i,requestAnimationFrame(t))}()}function theOptions(){isMobil?(eL(ui.onAud,0,"touchstart",audClick),eL(ui.offAud,0,"touchstart",audClick)):(eL(ui.onAud,0,"click",audClick),eL(ui.offAud,0,"click",audClick))}function audClick(e){e&&e.preventDefault(),x.sound?x.sound.isPlaying?(cL(ui.offAud,0,"noneIt2"),cL(ui.onAud,1,"noneIt2"),x.sound.pause()):(cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2"),x.sound.play()):addAud(),_.idleTimer=0}function onPointerDown(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-(2*(e.clientY/_.height))+1):(t.x=e.x/_.width*2-1,t.y=-(2*(e.y/_.height))+1),_.ptrDown=!0,_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function onPointerMove(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-(2*(e.clientY/_.height))+1):(t.x=e.x/_.width*2-1,t.y=-(2*(e.y/_.height))+1),_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function wheelE(e){e&&e.preventDefault(),_.idleTimer=0}function onWindowResize(){_.width=window.innerWidth,_.height=window.innerHeight,isMobil&&(_.width==_.prevW&&(_.width=_.prevH,_.height=_.prevW),_.prevW=_.width,_.prevH=_.height),_.widthH=_.width/2,_.heightH=_.height/2,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",camera.aspect=_.width/_.height,camera.updateProjectionMatrix(),renderer.setSize(_.width,_.height),x.xx=400,_.width>_.height?(cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.022+"px",isMobil&&(x.xx=800)):(cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.028+"px",isMobil&&(x.xx=1100)),_.idleTimer=0}function animate(){if(requestAnimationFrame(animate),_.idleTimer<120){clock.running||clock.start();let e=.001*Date.now();isMobil?(camera.position.x=120*Math.sin(.15*e),camera.position.y=70*Math.sin(.3*e)+30):(camera.position.x=300*_.pointer.x,camera.position.y=300*_.pointer.y);let t=x.starMater[0].map.offset.y+.001;t>=1&&(t=0),x.starMater[0].map.offset.y=t,x.starMater[1].map.offset.y=t,x.cockpit.rotation.y=.005*Math.cos(6*e),x.cockpit.children[6].rotation.y=.01*Math.sin(10*e),camera.position.y>150||camera.position.y<-50||camera.position.x>100||camera.position.x<-100?x.cockpit.children[3].material.transparent=x.cockpit.children[5].material.transparent=x.cockpit.children[9].material.transparent=!1:(x.cockpit.children[3].material.transparent=x.cockpit.children[5].material.transparent=x.cockpit.children[9].material.transparent=!0,x.cockpit.children[3].material.opacity=.5*Math.random()+.5,x.cockpit.children[5].material.opacity=.5*Math.random()+.5,x.cockpit.children[9].material.opacity=.5*Math.random()+.5),_.idleTimer+=.01,render()}else clock.running&&clock.stop(),x.sound&&x.sound.isPlaying&&x.sound.pause();document.hasFocus()?_.fokus||(_.idleTimer=0,_.fokus=!0,x.sound&&!x.sound.isPlaying&&x.sound.play()):(_.idleTimer=120,_.fokus=!1,x.sound&&x.sound.isPlaying&&x.sound.pause())}function render(){camera.lookAt(x.target0.position),renderer.render(scene,camera)}function addAud(){if(!x.sound){let t="cckpt";t+=".mp3";let i=new e.AudioListener;camera.add(i),x.sound=new e.Audio(i);let a=new e.AudioLoader;a.load("aud/"+t,function(e){x.sound.setBuffer(e),x.sound.setLoop(!0),x.sound.setVolume(.9),x.sound.play(),cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2")})}}
	