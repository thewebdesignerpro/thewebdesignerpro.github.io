/**
 * author Armstrong "Army" Chiu
 * URL: https://thewebdesignerpro.com/     
 */
 
import*as e from"three";import t from"three/addons/capabilities/WebGL.js";import{OBJLoader as a}from"three/addons/loaders/OBJLoader.js";import{FBXLoader as o}from"three/addons/loaders/FBXLoader.js";import{Water as n}from"three/addons/objects/Water.js";let idleTO=120,florY=-10,ceilY=140,camera,scene,renderer,clock,grups=[],isMobil=!1,mouseX=0,mouseY=-50,mixer,ui={},_={},x={};if(t.isWebGL2Available())window.addEventListener?window.addEventListener("load",init,!1):window.attachEvent?window.attachEvent("onload",init):window.onload=init;else{let i=t.getWebGL2ErrorMessage();kontainer.appendChild(i),kontainer.style.background="url('img/autumnl.jpg') center top no-repeat",kontainer.style.backgroundSize="cover",fader.style.opacity=0,fader.style.display="none",fader.parentNode.removeChild(fader),cL(loadr,0,"paus"),loadr.style.display="none",loadr.parentNode.removeChild(loadr)}function eL(e,t,a,o){0==t?e.addEventListener(a,o,!1):e.removeEventListener(a,o,!1)}function cL(e,t,a){0==t?e.classList.contains(a)||e.classList.add(a):e.classList.contains(a)&&e.classList.remove(a)}function init(){function t(e){return document.getElementById(e)}ui.kontainer=t("kontainer"),ui.onAud=t("onAud"),ui.offAud=t("offAud"),ui.loadr=t("loadr"),ui.fader=t("fader"),ui.fader.style.opacity=1;let a=document.createElement("div");if(a.setAttribute("id","dummy"),document.body.appendChild(a),(isMobil="9000px"!=window.getComputedStyle(a,null).getPropertyValue("left"))&&(document.addEventListener("gesturechange",function(e){e.preventDefault()},!1),ui.kontainer.addEventListener("gesturechange",function(e){e.preventDefault()},!1),_.prevW=_.prevH=0),a.parentNode.removeChild(a),_.width=window.innerWidth,_.height=window.innerHeight,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",ui.kontainer.style.backgroundColor="#808895",_.ej=[],_.ej[0]=0,_.ej[1]=-2,_.ej[2]=Math.PI,_.ej[3]=0,_.ej[4]=0,_.ej[5]=0,x.xx=160,(renderer=new e.WebGLRenderer({antialias:!0,alpha:!1})).setPixelRatio(window.devicePixelRatio),renderer.setSize(_.width,_.height),renderer.setClearColor(8423573,1),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=e.PCFSoftShadowMap,renderer.outputColorSpace=e.LinearSRGBColorSpace,renderer.sortObjects=!1,ui.kontainer.appendChild(renderer.domElement),!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float"))throw alert("OES_texture_float not supported"),"missing webgl extension";if(!1===renderer.capabilities.isWebGL2&&!renderer.extensions.get("OES_texture_float_linear"))throw alert("OES_texture_float_linear not supported"),"missing webgl extension";scene=new e.Scene,x.camGrup=new e.Group,grups[0]=new e.Group,grups[1]=new e.Group,(camera=new e.PerspectiveCamera(50,_.width/_.height,.5,2e4)).position.set(0,60,900),x.camGrup.add(camera),scene.add(new e.AmbientLight(8947848)),x.spotLight=[],x.spotLight[0]=new e.SpotLight(16770474,5e7,7e3,Math.PI/8,1),x.spotLight[0].position.set(-3e3,200,0),x.spotLight[0].castShadow=!0,x.spotLight[0].shadow.camera.near=1,x.spotLight[0].shadow.camera.far=7e3,x.spotLight[0].shadow.camera.fov=50,x.spotLight[0].shadow.intensity=.9,scene.add(x.spotLight[0]),x.spotLight[1]=new e.SpotLight(16772812,1500,28,Math.PI/5.8,1),x.spotLight[1].position.set(0,10.65,0),x.spotLight[1].castShadow=!0,x.spotLight[1].shadow.mapSize.width=64,x.spotLight[1].shadow.mapSize.height=64,x.spotLight[1].shadow.camera.near=1,x.spotLight[1].shadow.camera.far=28,x.spotLight[1].shadow.camera.fov=40,x.spotLight[1].shadow.intensity=.5,scene.add(x.camGrup),eL(window,1,"load",init),eL(window,0,"resize",onWindowResize),(clock=new e.Clock).autoStart=!1,_.mouse=new e.Vector2,_.entro=!0,_.idleTimer=0,_.fokus=!0,_.pointer=new e.Vector2,_.ptrDown=!1,x.currGrup=0,x.targetO=new e.Object3D,x.target1=new e.Object3D,x.target1.position.set(0,80,x.camGrup.position.z),scene.add(x.target1),addSkybox(),onWindowResize()}function addSkybox(){let t=".jpg",a=new e.CubeTextureLoader;a.setPath("img/skybox/6/"),a.load(["posx"+t,"negx"+t,"posy"+t,"negy"+t,"posz"+t,"negz"+t],function(t){t.colorSpace=e.LinearSRGBColorSpace,x.skybox=t,scene.backgroundRotation.set(0,-(Math.PI/2)+.64,0),scene.background=x.skybox,addSea()})}function addSea(){let t=new e.PlaneGeometry(12e3,12e3);x.sea=new n(t,{textureWidth:1280,textureHeight:1280,waterNormals:new e.TextureLoader().load("img/water/waternormals.jpg",function(t){t.wrapS=t.wrapT=e.RepeatWrapping}),sunDirection:new e.Vector3,sunColor:16777215,waterColor:13104,distortionScale:10,fog:void 0!==scene.fog}),x.sea.rotation.x=-Math.PI/2,scene.add(x.sea);let a=x.sea.material.uniforms;a.size.value=.011,addTree()}function randomizeMatrix(t,a){let o=new e.Vector3,n=new e.Euler,i=new e.Quaternion,r=new e.Vector3;return o.x=x.dummy[a].position.x=1700*Math.random()+700,o.y=x.dummy[a].position.y=.5,o.z=x.dummy[a].position.z=200*Math.random()-120,n.x=x.dummy[a].rotation.x=Math.random()*(2*Math.PI),n.y=x.dummy[a].rotation.y=Math.random()*(2*Math.PI),n.z=x.dummy[a].rotation.z=Math.random()*(2*Math.PI),i.setFromEuler(n),r.x=r.y=r.z=1,t.compose(o,i,r)}function addLeaves(){let t=new e.Matrix4;x.dummy=[];let a=new e.TextureLoader,o=new e.TextureLoader,n=new e.TextureLoader,i=new e.PlaneGeometry(6,10,3,5);x.mater=new e.MeshStandardMaterial({color:14540253,emissive:5263440,transparent:!0,side:e.DoubleSide}),x.mater.depthWrite=!1,x.Leaf=new e.InstancedMesh(i,x.mater,10),x.Leaf.instanceMatrix.setUsage(e.DynamicDrawUsage),grups[0].add(x.Leaf);for(let r=0;r<10;r++)x.dummy[r]=new e.Object3D,randomizeMatrix(t,r),x.Leaf.setMatrixAt(r,t);a.load("obj/trees/5/mat/leafc2.png",function(e){x.mater.map=e,x.mater.needsUpdate=!0}),o.load("obj/trees/5/mat/leafa.png",function(e){x.mater.alphaMap=e,x.mater.needsUpdate=!0}),n.load("obj/trees/5/mat/leafd.png",function(e){x.mater.displacementScale=4,x.mater.displacementMap=e,x.mater.needsUpdate=!0})}function addTree(){let t=0;x.tree=[];let o=new a;o.load("obj/trees/5/tree2.obj",function(a){a.traverse(function(e){e.isMesh&&(e.geometry.computeBoundingBox(),t+=1)});let o=[],n=[];n[0]=16772846,n[2]=15658734,n[1]=12303291;let i=[];i[0]=.5,i[1]=.73,i[2]=.83;for(let r=0;r<t;r++)o[r]=new e.MeshStandardMaterial({color:n[r],roughness:i[r],metalness:0}),0==r&&(o[r].transparent=!0,o[r].depthWrite=!1),x.tree[r]=new e.Mesh(a.children[r].geometry,o[r]),x.tree[r].castShadow=!0,r>0&&(x.tree[r].receiveShadow=!0),x.tree[r].position.set(0,-60,0),x.tree[r].rotation.set(0,Math.PI,0),x.tree[r].scale.set(1,1,1),grups[0].add(x.tree[r]),x.tree[r].visible=!1;scene.add(grups[0]);let d=new e.TextureLoader,s=new e.TextureLoader,l=new e.TextureLoader,u=new e.TextureLoader,$=new e.TextureLoader,p=new e.TextureLoader,m=new e.TextureLoader,c=new e.TextureLoader,h=new e.TextureLoader,f=new e.TextureLoader;d.load("obj/trees/5/mat/color0e.jpg",function(e){x.tree[0].material.map=e,x.tree[0].material.needsUpdate=!0,x.tree[0].visible=!0,animFBX()}),s.load("obj/trees/5/mat/alpha0.jpg",function(e){x.tree[0].material.alphaMap=e,x.tree[0].material.needsUpdate=!0}),l.load("obj/trees/5/mat/normal0.jpg",function(e){x.tree[0].material.normalMap=e,x.tree[0].material.needsUpdate=!0}),u.load("obj/trees/5/mat/color1.jpg",function(e){x.tree[1].material.map=e,x.tree[1].material.needsUpdate=!0,x.tree[1].visible=!0}),$.load("obj/trees/5/mat/rough1.jpg",function(e){x.tree[1].material.roughnessMap=e,x.tree[1].material.needsUpdate=!0}),p.load("obj/trees/5/mat/normal1.jpg",function(e){x.tree[1].material.normalScale.set(2,2),x.tree[1].material.normalMap=e,x.tree[1].material.needsUpdate=!0}),m.load("obj/trees/5/mat/color2.jpg",function(e){x.tree[2].material.map=e,x.tree[2].material.needsUpdate=!0,x.tree[2].visible=!0}),c.load("obj/trees/5/mat/rough2.jpg",function(e){x.tree[2].material.roughnessMap=e,x.tree[2].material.needsUpdate=!0}),h.load("obj/trees/5/mat/normal2.jpg",function(e){x.tree[2].material.normalMap=e,x.tree[2].material.needsUpdate=!0}),addLeaves();let g=new e.PlaneGeometry(1e3,400),w=new e.MeshBasicMaterial({color:1118481,transparent:!0,opacity:.3});w.depthWrite=!1,x.treeShadow=new e.Mesh(g,w),x.treeShadow.position.set(563,2,-35),x.treeShadow.rotation.set(Math.PI/2,0,0),grups[0].add(x.treeShadow),f.load("obj/trees/5/mat/shadow.jpg",function(e){x.treeShadow.material.alphaMap=e,x.treeShadow.material.needsUpdate=!0})})}function fadeScene(){onWindowResize(),function e(){let t=parseFloat(ui.fader.style.opacity);(t-=.05)<0?(ui.fader.style.opacity=0,ui.fader.style.display="none",ui.fader.parentNode.removeChild(ui.fader),onWindowResize(),eL(ui.kontainer,0,"pointerdown",onPointerDown),eL(ui.kontainer,0,"pointermove",onPointerMove),animate(),theOptions(),cL(ui.loadr,0,"paus"),ui.loadr.style.display="none",ui.loadr.parentNode.removeChild(ui.loadr)):(ui.fader.style.opacity=t,requestAnimationFrame(e))}()}function theOptions(){isMobil?(eL(ui.onAud,0,"touchstart",audClick),eL(ui.offAud,0,"touchstart",audClick)):(eL(ui.onAud,0,"click",audClick),eL(ui.offAud,0,"click",audClick))}function audClick(e){e&&e.preventDefault(),x.sound?x.sound.isPlaying?(cL(ui.offAud,0,"noneIt2"),cL(ui.onAud,1,"noneIt2"),x.sound.pause()):(cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2"),x.sound.play()):addAud(),_.idleTimer=0}function onPointerDown(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-(2*(e.clientY/_.height))+1):(t.x=e.x/_.width*2-1,t.y=-(2*(e.y/_.height))+1),_.ptrDown=!0,_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function onPointerMove(e){e&&e.preventDefault();let t={};e.clientX?(t.x=e.clientX/_.width*2-1,t.y=-(2*(e.clientY/_.height))+1):(t.x=e.x/_.width*2-1,t.y=-(2*(e.y/_.height))+1),_.pointer.x=t.x,_.pointer.y=t.y,_.idleTimer=0}function wheelE(e){e&&e.preventDefault(),_.idleTimer=0}function onWindowResize(){_.width=window.innerWidth,_.height=window.innerHeight,isMobil&&(_.width==_.prevW&&(_.width=_.prevH,_.height=_.prevW),_.prevW=_.width,_.prevH=_.height),_.widthH=_.width/2,_.heightH=_.height/2,document.body.style.width=ui.kontainer.style.width=_.width+"px",document.body.style.height=ui.kontainer.style.height=_.height+"px",camera.aspect=_.width/_.height,camera.updateProjectionMatrix(),renderer.setSize(_.width,_.height),x.xx=160,_.width>_.height?cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.022+"px":(cntnt.style.fontSize=cntnt2.style.fontSize=(_.width+_.height)/2*.028+"px",isMobil&&(x.xx=300)),_.idleTimer=0}function animFog(){let e=x.batchedMesh[0].position.x,t=x.batchedMesh[1].position.x;e>-300?x.batchedMesh[0].position.x-=.1:x.batchedMesh[0].position.x=300,t>-300?x.batchedMesh[1].position.x-=.15:x.batchedMesh[1].position.x=300}function animate(){if(requestAnimationFrame(animate),_.idleTimer<120){clock.running||clock.start();let e=5e-5*Date.now();if(isMobil){let t=Math.sin(e);camera.position.x=t*x.xx;let a=500*Math.abs(t);camera.position.y=a>30?a:30,x.camGrup.rotation.y=2.4*Math.sin(e)}else{let o=600*_.pointer.y;camera.position.y=o>30?o:30,camera.position.z=900-.65*camera.position.y,x.camGrup.rotation.y=2.6*Math.sin(e)}for(let n=0;n<10;n++){let i=x.dummy[n].rotation.x,r=x.dummy[n].rotation.y,d=x.dummy[n].rotation.z,s=x.dummy[n].position.x+.7,l=x.dummy[n].position.y-1,u=x.dummy[n].position.z;l=l>.3?x.dummy[n].position.y-1:.3,s<2400?s=x.dummy[n].position.x+.7:(s=400*Math.random()-60,l=50*Math.random()+350,u=200*Math.random()-120),x.dummy[n].position.set(s,l,u),l>.3?x.dummy[n].rotation.set(i+.03*Math.random(),r+.03*Math.random(),d+.03*Math.random()):x.dummy[n].rotation.x=Math.PI/2,x.dummy[n].updateMatrix(),x.Leaf.setMatrixAt(n,x.dummy[n].matrix),x.Leaf.instanceMatrix.needsUpdate=!0,x.Leaf.computeBoundingSphere()}let $=.01*Math.sin(10*e);x.tree[0].rotation.set($,$+Math.PI,$),x.sea.material.uniforms.time.value-=.002,_.idleTimer+=.01,render()}else clock.running&&clock.stop(),x.sound&&x.sound.isPlaying&&x.sound.pause();document.hasFocus()?_.fokus||(_.idleTimer=0,_.fokus=!0,x.sound&&!x.sound.isPlaying&&x.sound.play()):(_.idleTimer=120,_.fokus=!1,x.sound&&x.sound.isPlaying&&x.sound.pause())}function render(){camera.lookAt(x.target1.position),renderer.render(scene,camera)}function animFBX(){let t="teenb1/char1";t+=".fbx";let a=new o;a.load("obj/"+t,function(t){t.traverse(function(e){e.isMesh&&(e.geometry.computeBoundingBox(),e.castShadow=!0,e.receiveShadow=!0,("Hatsmesh"==e.geometry.name||"Shoesmesh"==e.geometry.name)&&(e.frustumCulled=!1))}),x.char1=t;let a=[],o="obj/teenb1/mat/";for(let n=0;n<7;n++)a[n]=new e.MeshStandardMaterial({color:16777215,roughness:.75,metalness:0}),x.char1.children[n].material=a[n];a[1].transparent=!0,a[1].opacity=0;let i=new e.TextureLoader,r=new e.TextureLoader,d=new e.TextureLoader,s=new e.TextureLoader,l=new e.TextureLoader;new e.TextureLoader;let u=new e.TextureLoader,$=new e.TextureLoader,p=new e.TextureLoader,m=new e.TextureLoader,c=new e.TextureLoader;new e.TextureLoader,i.load(o+"bottomd.jpg",function(e){a[2].map=e,a[2].needsUpdate=!0}),r.load(o+"bodyd.jpg",function(e){a[0].map=a[3].map=e,a[0].needsUpdate=a[3].needsUpdate=!0}),d.load(o+"hatd.jpg",function(e){a[4].map=e,a[4].needsUpdate=!0}),s.load(o+"shoesd.jpg",function(e){a[5].map=e,a[5].needsUpdate=!0}),l.load(o+"topd.jpg",function(e){a[6].map=e,a[6].needsUpdate=!0}),u.load(o+"bottomn.jpg",function(e){a[2].normalMap=e,a[2].needsUpdate=!0}),$.load(o+"bodyn.jpg",function(e){a[3].normalMap=e,a[3].needsUpdate=!0}),p.load(o+"hatn.jpg",function(e){a[4].normalMap=e,a[4].needsUpdate=!0}),m.load(o+"shoesn.jpg",function(e){a[5].roughness=.4,a[5].normalMap=e,a[5].needsUpdate=!0}),c.load(o+"topn.jpg",function(e){a[6].normalMap=e,a[6].needsUpdate=!0}),x.char1.scale.set(1,1,1),x.char1.position.set(48.7,100,-20),x.char1.rotation.y=-(Math.PI/2),grups[1].add(x.char1),scene.add(grups[1]),anim8()})}function anim8(){x.actions=[];let t="teenb1/SitRecline";t+=".fbx";let a=new o;a.load("obj/"+t,function(t){mixer=new e.AnimationMixer(x.char1),x.actions[0]=mixer.clipAction(t.animations[0]),x.actions[0].play(),mixer.update(0),fadeScene()})}function addAud(){if(!x.sound){let t="atmn";t+=".mp3";let a=new e.AudioListener;camera.add(a),x.sound=new e.Audio(a);let o=new e.AudioLoader;o.load("aud/"+t,function(e){x.sound.setBuffer(e),x.sound.setLoop(!0),x.sound.setVolume(1),x.sound.play(),cL(ui.onAud,0,"noneIt2"),cL(ui.offAud,1,"noneIt2")})}} 
